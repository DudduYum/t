{"code":"!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"/\",n(n.s=109)}([function(t,e){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(t){\"object\"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i;t.exports=function t(e,n,r){function o(a,h){if(!n[a]){if(!e[a]){var c=\"function\"==typeof i&&i;if(!h&&c)return i(a,!0);if(s)return s(a,!0);throw new Error(\"Cannot find module '\"+a+\"'\")}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var s=\"function\"==typeof i&&i,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){e.exports={name:\"cannon\",version:\"0.6.2\",description:\"A lightweight 3D physics engine written in JavaScript.\",homepage:\"https://github.com/schteppe/cannon.js\",author:\"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)\",keywords:[\"cannon.js\",\"cannon\",\"physics\",\"engine\",\"3d\"],main:\"./build/cannon.js\",engines:{node:\"*\"},repository:{type:\"git\",url:\"https://github.com/schteppe/cannon.js.git\"},bugs:{url:\"https://github.com/schteppe/cannon.js/issues\"},licenses:[{type:\"MIT\"}],devDependencies:{jshint:\"latest\",\"uglify-js\":\"latest\",nodeunit:\"^0.9.0\",grunt:\"~0.4.0\",\"grunt-contrib-jshint\":\"~0.1.1\",\"grunt-contrib-nodeunit\":\"^0.4.1\",\"grunt-contrib-concat\":\"~0.1.3\",\"grunt-contrib-uglify\":\"^0.5.1\",\"grunt-browserify\":\"^2.1.4\",\"grunt-contrib-yuidoc\":\"^0.5.2\",browserify:\"*\"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t(\"../package.json\").version,AABB:t(\"./collision/AABB\"),ArrayCollisionMatrix:t(\"./collision/ArrayCollisionMatrix\"),Body:t(\"./objects/Body\"),Box:t(\"./shapes/Box\"),Broadphase:t(\"./collision/Broadphase\"),Constraint:t(\"./constraints/Constraint\"),ContactEquation:t(\"./equations/ContactEquation\"),Narrowphase:t(\"./world/Narrowphase\"),ConeTwistConstraint:t(\"./constraints/ConeTwistConstraint\"),ContactMaterial:t(\"./material/ContactMaterial\"),ConvexPolyhedron:t(\"./shapes/ConvexPolyhedron\"),Cylinder:t(\"./shapes/Cylinder\"),DistanceConstraint:t(\"./constraints/DistanceConstraint\"),Equation:t(\"./equations/Equation\"),EventTarget:t(\"./utils/EventTarget\"),FrictionEquation:t(\"./equations/FrictionEquation\"),GSSolver:t(\"./solver/GSSolver\"),GridBroadphase:t(\"./collision/GridBroadphase\"),Heightfield:t(\"./shapes/Heightfield\"),HingeConstraint:t(\"./constraints/HingeConstraint\"),LockConstraint:t(\"./constraints/LockConstraint\"),Mat3:t(\"./math/Mat3\"),Material:t(\"./material/Material\"),NaiveBroadphase:t(\"./collision/NaiveBroadphase\"),ObjectCollisionMatrix:t(\"./collision/ObjectCollisionMatrix\"),Pool:t(\"./utils/Pool\"),Particle:t(\"./shapes/Particle\"),Plane:t(\"./shapes/Plane\"),PointToPointConstraint:t(\"./constraints/PointToPointConstraint\"),Quaternion:t(\"./math/Quaternion\"),Ray:t(\"./collision/Ray\"),RaycastVehicle:t(\"./objects/RaycastVehicle\"),RaycastResult:t(\"./collision/RaycastResult\"),RigidVehicle:t(\"./objects/RigidVehicle\"),RotationalEquation:t(\"./equations/RotationalEquation\"),RotationalMotorEquation:t(\"./equations/RotationalMotorEquation\"),SAPBroadphase:t(\"./collision/SAPBroadphase\"),SPHSystem:t(\"./objects/SPHSystem\"),Shape:t(\"./shapes/Shape\"),Solver:t(\"./solver/Solver\"),Sphere:t(\"./shapes/Sphere\"),SplitSolver:t(\"./solver/SplitSolver\"),Spring:t(\"./objects/Spring\"),Trimesh:t(\"./shapes/Trimesh\"),Vec3:t(\"./math/Vec3\"),Vec3Pool:t(\"./utils/Vec3Pool\"),World:t(\"./world/World\")}},{\"../package.json\":1,\"./collision/AABB\":3,\"./collision/ArrayCollisionMatrix\":4,\"./collision/Broadphase\":5,\"./collision/GridBroadphase\":6,\"./collision/NaiveBroadphase\":7,\"./collision/ObjectCollisionMatrix\":8,\"./collision/Ray\":9,\"./collision/RaycastResult\":10,\"./collision/SAPBroadphase\":11,\"./constraints/ConeTwistConstraint\":12,\"./constraints/Constraint\":13,\"./constraints/DistanceConstraint\":14,\"./constraints/HingeConstraint\":15,\"./constraints/LockConstraint\":16,\"./constraints/PointToPointConstraint\":17,\"./equations/ContactEquation\":19,\"./equations/Equation\":20,\"./equations/FrictionEquation\":21,\"./equations/RotationalEquation\":22,\"./equations/RotationalMotorEquation\":23,\"./material/ContactMaterial\":24,\"./material/Material\":25,\"./math/Mat3\":27,\"./math/Quaternion\":28,\"./math/Vec3\":30,\"./objects/Body\":31,\"./objects/RaycastVehicle\":32,\"./objects/RigidVehicle\":33,\"./objects/SPHSystem\":34,\"./objects/Spring\":35,\"./shapes/Box\":37,\"./shapes/ConvexPolyhedron\":38,\"./shapes/Cylinder\":39,\"./shapes/Heightfield\":40,\"./shapes/Particle\":41,\"./shapes/Plane\":42,\"./shapes/Shape\":43,\"./shapes/Sphere\":44,\"./shapes/Trimesh\":45,\"./solver/GSSolver\":46,\"./solver/Solver\":47,\"./solver/SplitSolver\":48,\"./utils/EventTarget\":49,\"./utils/Pool\":51,\"./utils/Vec3Pool\":54,\"./world/Narrowphase\":55,\"./world/World\":56}],3:[function(t,e,n){var i=t(\"../math/Vec3\");function r(t){t=t||{},this.lowerBound=new i,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new i,t.upperBound&&this.upperBound.copy(t.upperBound)}t(\"../utils/Utils\"),e.exports=r;var o=new i;r.prototype.setFromPoints=function(t,e,n,i){var r=this.lowerBound,s=this.upperBound,a=n;r.copy(t[0]),a&&a.vmult(r,r),s.copy(r);for(var h=1;h<t.length;h++){var c=t[h];a&&(a.vmult(c,o),c=o),c.x>s.x&&(s.x=c.x),c.x<r.x&&(r.x=c.x),c.y>s.y&&(s.y=c.y),c.y<r.y&&(r.y=c.y),c.z>s.z&&(s.z=c.z),c.z<r.z&&(r.z=c.z)}return e&&(e.vadd(r,r),e.vadd(s,s)),i&&(r.x-=i,r.y-=i,r.z-=i,s.x+=i,s.y+=i,s.z+=i),this},r.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},r.prototype.clone=function(){return(new r).copy(this)},r.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);var e=t.lowerBound.y;this.lowerBound.y>e&&(this.lowerBound.y=e);var n=t.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);var e=t.lowerBound.z;this.lowerBound.z>e&&(this.lowerBound.z=e);var n=t.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},r.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return(i.x<=n.x&&n.x<=r.x||e.x<=r.x&&r.x<=n.x)&&(i.y<=n.y&&n.y<=r.y||e.y<=r.y&&r.y<=n.y)&&(i.z<=n.z&&n.z<=r.z||e.z<=r.z&&r.z<=n.z)},r.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,i=t.lowerBound,r=t.upperBound;return e.x<=i.x&&n.x>=r.x&&e.y<=i.y&&n.y>=r.y&&e.z<=i.z&&n.z>=r.z},r.prototype.getCorners=function(t,e,n,i,r,o,s,a){var h=this.lowerBound,c=this.upperBound;t.copy(h),e.set(c.x,h.y,h.z),n.set(c.x,c.y,h.z),i.set(h.x,c.y,c.z),r.set(c.x,h.y,h.z),o.set(h.x,c.y,h.z),s.set(h.x,h.y,c.z),a.copy(c)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];r.prototype.toLocalFrame=function(t,e){var n=s,i=n[0],r=n[1],o=n[2],a=n[3],h=n[4],c=n[5],l=n[6],u=n[7];this.getCorners(i,r,o,a,h,c,l,u);for(var p=0;8!==p;p++){var f=n[p];t.pointToLocal(f,f)}return e.setFromPoints(n)},r.prototype.toWorldFrame=function(t,e){var n=s,i=n[0],r=n[1],o=n[2],a=n[3],h=n[4],c=n[5],l=n[6],u=n[7];this.getCorners(i,r,o,a,h,c,l,u);for(var p=0;8!==p;p++){var f=n[p];t.pointToWorld(f,f)}return e.setFromPoints(n)}},{\"../math/Vec3\":30,\"../utils/Utils\":53}],4:[function(t,e,n){function i(){this.matrix=[]}e.exports=i,i.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}return this.matrix[(t*(t+1)>>1)+e-1]},i.prototype.set=function(t,e,n){if(t=t.index,(e=e.index)>t){var i=e;e=t,t=i}this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},i.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},i.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var i=t(\"../objects/Body\"),r=t(\"../math/Vec3\"),o=t(\"../math/Quaternion\");function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t(\"../shapes/Shape\"),t(\"../shapes/Plane\"),e.exports=s,s.prototype.collisionPairs=function(t,e,n){throw new Error(\"collisionPairs not implemented for this BroadPhase class!\")};var a=i.STATIC|i.KINEMATIC;s.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==i.SLEEPING||0==(e.type&a)&&e.sleepState!==i.SLEEPING)},s.prototype.intersectionTest=function(t,e,n,i){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,i):this.doBoundingSphereBroadphase(t,e,n,i)};var h=new r;new r,new o,new r,s.prototype.doBoundingSphereBroadphase=function(t,e,n,i){var r=h;e.position.vsub(t.position,r);var o=Math.pow(t.boundingRadius+e.boundingRadius,2),s=r.norm2();s<o&&(n.push(t),i.push(e))},s.prototype.doBoundingBoxBroadphase=function(t,e,n,i){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),i.push(e))};var c={keys:[]},l=[],u=[];s.prototype.makePairsUnique=function(t,e){for(var n=c,i=l,r=u,o=t.length,s=0;s!==o;s++)i[s]=t[s],r[s]=e[s];t.length=0,e.length=0;for(var s=0;s!==o;s++){var a=i[s].id,h=r[s].id,p=a<h?a+\",\"+h:h+\",\"+a;n[p]=s,n.keys.push(p)}for(var s=0;s!==n.keys.length;s++){var p=n.keys.pop(),f=n[p];t.push(i[f]),e.push(r[f]),delete n[p]}},s.prototype.setWorld=function(t){};var p=new r;s.boundingSphereCheck=function(t,e){var n=p;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},s.prototype.aabbQuery=function(t,e,n){return console.warn(\".aabbQuery is not implemented in this Broadphase subclass.\"),[]}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Plane\":42,\"../shapes/Shape\":43}],6:[function(t,e,n){e.exports=s;var i=t(\"./Broadphase\"),r=t(\"../math/Vec3\"),o=t(\"../shapes/Shape\");function s(t,e,n,o,s){i.apply(this),this.nx=n||10,this.ny=o||10,this.nz=s||10,this.aabbMin=t||new r(100,100,100),this.aabbMax=e||new r(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(a<=0)throw\"GridBroadphase: Each dimension's n must be >0\";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var h=0;h<a;h++)this.bins[h]=[],this.binLengths[h]=0}s.prototype=new i,s.prototype.constructor=s;var a=new r;new r,s.prototype.collisionPairs=function(t,e,n){for(var i=t.numObjects(),r=t.bodies,s=this.aabbMax,h=this.aabbMin,c=this.nx,l=this.ny,u=this.nz,p=l*u,f=u,d=1,y=s.x,v=s.y,m=s.z,g=h.x,b=h.y,w=h.z,x=c/(y-g),E=l/(v-b),C=u/(m-w),S=(y-g)/c,T=(v-b)/l,A=(m-w)/u,B=.5*Math.sqrt(S*S+T*T+A*A),R=o.types,_=R.SPHERE,P=R.PLANE,F=(R.BOX,R.COMPOUND,R.CONVEXPOLYHEDRON,this.bins),I=this.binLengths,k=this.bins.length,M=0;M!==k;M++)I[M]=0;var j=Math.ceil,h=Math.min,s=Math.max;function N(t,e,n,i,r,o,s){var a=(t-g)*x|0,h=(e-b)*E|0,y=(n-w)*C|0,v=j((i-g)*x),m=j((r-b)*E),S=j((o-w)*C);a<0?a=0:a>=c&&(a=c-1),h<0?h=0:h>=l&&(h=l-1),y<0?y=0:y>=u&&(y=u-1),v<0?v=0:v>=c&&(v=c-1),m<0?m=0:m>=l&&(m=l-1),S<0?S=0:S>=u&&(S=u-1),h*=f,y*=d,v*=p,m*=f,S*=d;for(var T=a*=p;T<=v;T+=p)for(var A=h;A<=m;A+=f)for(var B=y;B<=S;B+=d){var R=T+A+B;F[R][I[R]++]=s}}for(var M=0;M!==i;M++){var O=r[M],L=O.shape;switch(L.type){case _:var q=O.position.x,z=O.position.y,U=O.position.z,D=L.radius;N(q-D,z-D,U-D,q+D,z+D,U+D,O);break;case P:L.worldNormalNeedsUpdate&&L.computeWorldNormal(O.quaternion);var W=L.worldNormal,V=g+.5*S-O.position.x,Y=b+.5*T-O.position.y,H=w+.5*A-O.position.z,X=a;X.set(V,Y,H);for(var $=0,G=0;$!==c;$++,G+=p,X.y=Y,X.x+=S)for(var Q=0,Z=0;Q!==l;Q++,Z+=f,X.z=H,X.y+=T)for(var K=0,J=0;K!==u;K++,J+=d,X.z+=A)if(X.dot(W)<B){var tt=G+Z+J;F[tt][I[tt]++]=O}break;default:O.aabbNeedsUpdate&&O.computeAABB(),N(O.aabb.lowerBound.x,O.aabb.lowerBound.y,O.aabb.lowerBound.z,O.aabb.upperBound.x,O.aabb.upperBound.y,O.aabb.upperBound.z,O)}}for(var M=0;M!==k;M++){var et=I[M];if(et>1)for(var nt=F[M],$=0;$!==et;$++)for(var O=nt[$],Q=0;Q!==$;Q++){var it=nt[Q];this.needBroadphaseCollision(O,it)&&this.intersectionTest(O,it,e,n)}}this.makePairsUnique(e,n)}},{\"../math/Vec3\":30,\"../shapes/Shape\":43,\"./Broadphase\":5}],7:[function(t,e,n){e.exports=o;var i=t(\"./Broadphase\"),r=t(\"./AABB\");function o(){i.apply(this)}o.prototype=new i,o.prototype.constructor=o,o.prototype.collisionPairs=function(t,e,n){var i,r,o,s,a=t.bodies,h=a.length;for(i=0;i!==h;i++)for(r=0;r!==i;r++)o=a[i],s=a[r],this.needBroadphaseCollision(o,s)&&this.intersectionTest(o,s,e,n)},new r,o.prototype.aabbQuery=function(t,e,n){n=n||[];for(var i=0;i<t.bodies.length;i++){var r=t.bodies[i];r.aabbNeedsUpdate&&r.computeAABB(),r.aabb.overlaps(e)&&n.push(r)}return n}},{\"./AABB\":3,\"./Broadphase\":5}],8:[function(t,e,n){function i(){this.matrix={}}e.exports=i,i.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}return t+\"-\"+e in this.matrix},i.prototype.set=function(t,e,n){if(t=t.id,(e=e.id)>t){var i=e;e=t,t=i}n?this.matrix[t+\"-\"+e]=!0:delete this.matrix[t+\"-\"+e]},i.prototype.reset=function(){this.matrix={}},i.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=c;var i=t(\"../math/Vec3\"),r=t(\"../math/Quaternion\"),o=t(\"../math/Transform\"),s=(t(\"../shapes/ConvexPolyhedron\"),t(\"../shapes/Box\"),t(\"../collision/RaycastResult\")),a=t(\"../shapes/Shape\"),h=t(\"../collision/AABB\");function c(t,e){this.from=t?t.clone():new i,this.to=e?e.clone():new i,this._direction=new i,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=c.ANY,this.result=new s,this.hasHit=!1,this.callback=function(t){}}c.prototype.constructor=c,c.CLOSEST=1,c.ANY=2,c.ALL=4;var l=new h,u=[];c.prototype.intersectWorld=function(t,e){return this.mode=e.mode||c.ANY,this.result=e.result||new s,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(l),u.length=0,t.broadphase.aabbQuery(t,l,u),this.intersectBodies(u),this.hasHit};var p=new i,f=new i;function d(t,e,n,i){i.vsub(e,M),n.vsub(e,p),t.vsub(e,f);var r,o,s=M.dot(M),a=M.dot(p),h=M.dot(f),c=p.dot(p),l=p.dot(f);return(r=c*h-a*l)>=0&&(o=s*l-a*h)>=0&&r+o<s*c-a*a}c.pointInTriangle=d;var y=new i,v=new r;c.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var i=y,r=v,o=0,s=t.shapes.length;o<s;o++){var a=t.shapes[o];if((!n||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[o],r),t.quaternion.vmult(t.shapeOffsets[o],i),i.vadd(t.position,i),this.intersectShape(a,r,i,t),this.result._shouldStop))break}},c.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,i=t.length;!this.result._shouldStop&&n<i;n++)this.intersectBody(t[n])},c.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},c.prototype.intersectShape=function(t,e,n,i){var r=this.from,o=function(t,e,n){n.vsub(t,M);var i=M.dot(e);return e.mult(i,j),j.vadd(t,j),n.distanceTo(j)}(r,this._direction,n);if(!(o>t.boundingSphereRadius)){var s=this[t.type];s&&s.call(this,t,e,n,i)}},new i,new i;var m=new i,g=new i,b=new i,w=new i;new i,new s,c.prototype.intersectBox=function(t,e,n,i){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,i)},c.prototype[a.types.BOX]=c.prototype.intersectBox,c.prototype.intersectPlane=function(t,e,n,r){var o=this.from,s=this.to,a=this._direction,h=new i(0,0,1);e.vmult(h,h);var c=new i;o.vsub(n,c);var l=c.dot(h);s.vsub(n,c);var u=c.dot(h);if(!(l*u>0||o.distanceTo(s)<l)){var p=h.dot(a);if(!(Math.abs(p)<this.precision)){var f=new i,d=new i,y=new i;o.vsub(n,f);var v=-h.dot(f)/p;a.scale(v,d),o.vadd(d,y),this.reportIntersection(h,y,t,r,-1)}}},c.prototype[a.types.PLANE]=c.prototype.intersectPlane,c.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var x={faceList:[0]};c.prototype.intersectHeightfield=function(t,e,n,r){t.data,t.elementSize;var s=new i,a=new c(this.from,this.to);o.pointToLocalFrame(n,e,a.from,a.from),o.pointToLocalFrame(n,e,a.to,a.to);var h=[],l=null,u=null,p=null,f=null,d=t.getIndexOfPosition(a.from.x,a.from.y,h,!1);if(d&&(l=h[0],u=h[1],p=h[0],f=h[1]),(d=t.getIndexOfPosition(a.to.x,a.to.y,h,!1))&&((null===l||h[0]<l)&&(l=h[0]),(null===p||h[0]>p)&&(p=h[0]),(null===u||h[1]<u)&&(u=h[1]),(null===f||h[1]>f)&&(f=h[1])),null!==l){var y=[];t.getRectMinMax(l,u,p,f,y);for(var v=l;v<=p;v++)for(var m=u;m<=f;m++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(v,m,!1),o.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,r,x),this.result._shouldStop)return;t.getConvexTrianglePillar(v,m,!0),o.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,r,x)}}},c.prototype[a.types.HEIGHTFIELD]=c.prototype.intersectHeightfield;var E=new i,C=new i;c.prototype.intersectSphere=function(t,e,n,i){var r=this.from,o=this.to,s=t.radius,a=Math.pow(o.x-r.x,2)+Math.pow(o.y-r.y,2)+Math.pow(o.z-r.z,2),h=2*((o.x-r.x)*(r.x-n.x)+(o.y-r.y)*(r.y-n.y)+(o.z-r.z)*(r.z-n.z)),c=Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)+Math.pow(r.z-n.z,2)-Math.pow(s,2),l=Math.pow(h,2)-4*a*c,u=E,p=C;if(!(l<0))if(0===l)r.lerp(o,l,u),u.vsub(n,p),p.normalize(),this.reportIntersection(p,u,t,i,-1);else{var f=(-h-Math.sqrt(l))/(2*a),d=(-h+Math.sqrt(l))/(2*a);if(f>=0&&f<=1&&(r.lerp(o,f,u),u.vsub(n,p),p.normalize(),this.reportIntersection(p,u,t,i,-1)),this.result._shouldStop)return;d>=0&&d<=1&&(r.lerp(o,d,u),u.vsub(n,p),p.normalize(),this.reportIntersection(p,u,t,i,-1))}},c.prototype[a.types.SPHERE]=c.prototype.intersectSphere;var S=new i,T=(new i,new i,new i);c.prototype.intersectConvex=function(t,e,n,i,r){for(var o=S,s=T,a=r&&r.faceList||null,h=t.faces,c=t.vertices,l=t.faceNormals,u=this._direction,p=this.from,f=this.to,y=p.distanceTo(f),v=a?a.length:h.length,x=this.result,E=0;!x._shouldStop&&E<v;E++){var C=a?a[E]:E,A=h[C],B=l[C],R=e,_=n;s.copy(c[A[0]]),R.vmult(s,s),s.vadd(_,s),s.vsub(p,s),R.vmult(B,o);var P=u.dot(o);if(!(Math.abs(P)<this.precision)){var F=o.dot(s)/P;if(!(F<0)){u.mult(F,m),m.vadd(p,m),g.copy(c[A[0]]),R.vmult(g,g),_.vadd(g,g);for(var I=1;!x._shouldStop&&I<A.length-1;I++){b.copy(c[A[I]]),w.copy(c[A[I+1]]),R.vmult(b,b),R.vmult(w,w),_.vadd(b,b),_.vadd(w,w);var k=m.distanceTo(p);!d(m,g,b,w)&&!d(m,b,g,w)||k>y||this.reportIntersection(o,m,t,i,C)}}}}},c.prototype[a.types.CONVEXPOLYHEDRON]=c.prototype.intersectConvex;var A=new i,B=new i,R=new i,_=new i,P=new i,F=new i,I=(new h,[]),k=new o;c.prototype.intersectTrimesh=function(t,e,n,i,r){var s=A,a=I,h=k,c=T,l=B,u=R,p=_,f=F,y=P,v=(r&&r.faceList,t.indices),x=(t.vertices,t.faceNormals,this.from),E=this.to,C=this._direction;h.position.copy(n),h.quaternion.copy(e),o.vectorToLocalFrame(n,e,C,l),o.pointToLocalFrame(n,e,x,u),o.pointToLocalFrame(n,e,E,p);var S=u.distanceSquared(p);t.tree.rayQuery(this,h,a);for(var M=0,j=a.length;!this.result._shouldStop&&M!==j;M++){var N=a[M];t.getNormal(N,s),t.getVertex(v[3*N],g),g.vsub(u,c);var O=l.dot(s),L=s.dot(c)/O;if(!(L<0)){l.scale(L,m),m.vadd(u,m),t.getVertex(v[3*N+1],b),t.getVertex(v[3*N+2],w);var q=m.distanceSquared(u);!d(m,b,g,w)&&!d(m,g,b,w)||q>S||(o.vectorToWorldFrame(e,s,y),o.pointToWorldFrame(n,e,m,f),this.reportIntersection(y,f,t,i,N))}}a.length=0},c.prototype[a.types.TRIMESH]=c.prototype.intersectTrimesh,c.prototype.reportIntersection=function(t,e,n,i,r){var o=this.from,s=this.to,a=o.distanceTo(e),h=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(h.hitFaceIndex=void 0!==r?r:-1,this.mode){case c.ALL:this.hasHit=!0,h.set(o,s,t,e,n,i,a),h.hasHit=!0,this.callback(h);break;case c.CLOSEST:(a<h.distance||!h.hasHit)&&(this.hasHit=!0,h.hasHit=!0,h.set(o,s,t,e,n,i,a));break;case c.ANY:this.hasHit=!0,h.hasHit=!0,h.set(o,s,t,e,n,i,a),h._shouldStop=!0}};var M=new i,j=new i},{\"../collision/AABB\":3,\"../collision/RaycastResult\":10,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/ConvexPolyhedron\":38,\"../shapes/Shape\":43}],10:[function(t,e,n){var i=t(\"../math/Vec3\");function r(){this.rayFromWorld=new i,this.rayToWorld=new i,this.hitNormalWorld=new i,this.hitPointWorld=new i,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=r,r.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(t,e,n,i,r,o,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=r,this.body=o,this.distance=s}},{\"../math/Vec3\":30}],11:[function(t,e,n){t(\"../shapes/Shape\");var i=t(\"../collision/Broadphase\");function r(t){i.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}e.exports=r,r.prototype=new i,r.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener(\"addBody\",this._addBodyHandler),t.removeEventListener(\"removeBody\",this._removeBodyHandler),t.addEventListener(\"addBody\",this._addBodyHandler),t.addEventListener(\"removeBody\",this._removeBodyHandler),this.world=t,this.dirty=!0},r.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.x<=i.aabb.lowerBound.x);r--)t[r+1]=t[r];t[r+1]=i}return t},r.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.y<=i.aabb.lowerBound.y);r--)t[r+1]=t[r];t[r+1]=i}return t},r.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var i=t[e],r=e-1;r>=0&&!(t[r].aabb.lowerBound.z<=i.aabb.lowerBound.z);r--)t[r+1]=t[r];t[r+1]=i}return t},r.prototype.collisionPairs=function(t,e,n){var i,o,s=this.axisList,a=s.length,h=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),i=0;i!==a;i++){var c=s[i];for(o=i+1;o<a;o++){var l=s[o];if(this.needBroadphaseCollision(c,l)){if(!r.checkBounds(c,l,h))break;this.intersectionTest(c,l,e,n)}}}},r.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,i=0;i!==n;i++){var o=t[i];o.aabbNeedsUpdate&&o.computeAABB()}0===e?r.insertionSortX(t):1===e?r.insertionSortY(t):2===e&&r.insertionSortZ(t)},r.checkBounds=function(t,e,n){var i,r;0===n?(i=t.position.x,r=e.position.x):1===n?(i=t.position.y,r=e.position.y):2===n&&(i=t.position.z,r=e.position.z);var o=t.boundingRadius,s=e.boundingRadius,a=i+o,h=r-s;return h<a},r.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,i=0,r=0,o=0,s=this.axisList,a=s.length,h=1/a,c=0;c!==a;c++){var l=s[c],u=l.position.x;t+=u,e+=u*u;var p=l.position.y;n+=p,i+=p*p;var f=l.position.z;r+=f,o+=f*f}var d=e-t*t*h,y=i-n*n*h,v=o-r*r*h;this.axisIndex=d>y?d>v?0:2:y>v?1:2},r.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var i=this.axisIndex,r=\"x\";1===i&&(r=\"y\"),2===i&&(r=\"z\");for(var o=this.axisList,s=(e.lowerBound[r],e.upperBound[r],0);s<o.length;s++){var a=o[s];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(e)&&n.push(a)}return n}},{\"../collision/Broadphase\":5,\"../shapes/Shape\":43}],12:[function(t,e,n){e.exports=a,t(\"./Constraint\");var i=t(\"./PointToPointConstraint\"),r=t(\"../equations/ConeEquation\"),o=t(\"../equations/RotationalEquation\"),s=(t(\"../equations/ContactEquation\"),t(\"../math/Vec3\"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,h=n.pivotA?n.pivotA.clone():new s,c=n.pivotB?n.pivotB.clone():new s;this.axisA=n.axisA?n.axisA.clone():new s,this.axisB=n.axisB?n.axisB.clone():new s,i.call(this,t,h,e,c,a),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;var l=this.coneEquation=new r(t,e,n),u=this.twistEquation=new o(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,l.maxForce=0,l.minForce=-a,u.maxForce=0,u.minForce=-a,this.equations.push(l,u)}a.prototype=new i,a.constructor=a,new s,new s,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,r=this.twistEquation;i.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(r.axisA,r.axisA),t.vectorToWorldFrame(r.axisA,r.axisA),this.axisB.tangents(r.axisB,r.axisB),e.vectorToWorldFrame(r.axisB,r.axisB),n.angle=this.angle,r.maxAngle=this.twistAngle}},{\"../equations/ConeEquation\":18,\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],13:[function(t,e,n){e.exports=r;var i=t(\"../utils/Utils\");function r(t,e,n){n=i.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=r.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}r.prototype.update=function(){throw new Error(\"method update() not implmemented in this Constraint subclass!\")},r.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},r.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},r.idCounter=0},{\"../utils/Utils\":53}],14:[function(t,e,n){e.exports=o;var i=t(\"./Constraint\"),r=t(\"../equations/ContactEquation\");function o(t,e,n,o){i.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===o&&(o=1e6),this.distance=n;var s=this.distanceEquation=new r(t,e);this.equations.push(s),s.minForce=-o,s.maxForce=o}o.prototype=new i,o.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,i=.5*this.distance,r=n.ni;e.position.vsub(t.position,r),r.normalize(),r.mult(i,n.ri),r.mult(-i,n.rj)}},{\"../equations/ContactEquation\":19,\"./Constraint\":13}],15:[function(t,e,n){e.exports=a,t(\"./Constraint\");var i=t(\"./PointToPointConstraint\"),r=t(\"../equations/RotationalEquation\"),o=t(\"../equations/RotationalMotorEquation\"),s=(t(\"../equations/ContactEquation\"),t(\"../math/Vec3\"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,h=n.pivotA?n.pivotA.clone():new s,c=n.pivotB?n.pivotB.clone():new s;i.call(this,t,h,e,c,a);var l=this.axisA=n.axisA?n.axisA.clone():new s(1,0,0);l.normalize();var u=this.axisB=n.axisB?n.axisB.clone():new s(1,0,0);u.normalize();var p=this.rotationalEquation1=new r(t,e,n),f=this.rotationalEquation2=new r(t,e,n),d=this.motorEquation=new o(t,e,a);d.enabled=!1,this.equations.push(p,f,d)}a.prototype=new i,a.constructor=a,a.prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},a.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var h=new s,c=new s;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,r=this.rotationalEquation1,o=this.rotationalEquation2,s=h,a=c,l=this.axisA,u=this.axisB;i.prototype.update.call(this),t.quaternion.vmult(l,s),e.quaternion.vmult(u,a),s.tangents(r.axisA,o.axisA),r.axisB.copy(a),o.axisB.copy(a),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../equations/RotationalMotorEquation\":23,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],16:[function(t,e,n){e.exports=s,t(\"./Constraint\");var i=t(\"./PointToPointConstraint\"),r=t(\"../equations/RotationalEquation\"),o=(t(\"../equations/RotationalMotorEquation\"),t(\"../equations/ContactEquation\"),t(\"../math/Vec3\"));function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,a=new o,h=new o,c=new o;t.position.vadd(e.position,c),c.scale(.5,c),e.pointToLocalFrame(c,h),t.pointToLocalFrame(c,a),i.call(this,t,a,e,h,s);var l=this.rotationalEquation1=new r(t,e,n),u=this.rotationalEquation2=new r(t,e,n),p=this.rotationalEquation3=new r(t,e,n);this.equations.push(l,u,p)}s.prototype=new i,s.constructor=s,new o,new o,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),r=this.rotationalEquation2,s=this.rotationalEquation3;i.prototype.update.call(this),t.vectorToWorldFrame(o.UNIT_X,n.axisA),e.vectorToWorldFrame(o.UNIT_Y,n.axisB),t.vectorToWorldFrame(o.UNIT_Y,r.axisA),e.vectorToWorldFrame(o.UNIT_Z,r.axisB),t.vectorToWorldFrame(o.UNIT_Z,s.axisA),e.vectorToWorldFrame(o.UNIT_X,s.axisB)}},{\"../equations/ContactEquation\":19,\"../equations/RotationalEquation\":22,\"../equations/RotationalMotorEquation\":23,\"../math/Vec3\":30,\"./Constraint\":13,\"./PointToPointConstraint\":17}],17:[function(t,e,n){e.exports=s;var i=t(\"./Constraint\"),r=t(\"../equations/ContactEquation\"),o=t(\"../math/Vec3\");function s(t,e,n,s,a){i.call(this,t,n),a=void 0!==a?a:1e6,this.pivotA=e?e.clone():new o,this.pivotB=s?s.clone():new o;var h=this.equationX=new r(t,n),c=this.equationY=new r(t,n),l=this.equationZ=new r(t,n);this.equations.push(h,c,l),h.minForce=c.minForce=l.minForce=-a,h.maxForce=c.maxForce=l.maxForce=a,h.ni.set(1,0,0),c.ni.set(0,1,0),l.ni.set(0,0,1)}s.prototype=new i,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,i=this.equationY,r=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj)}},{\"../equations/ContactEquation\":19,\"../math/Vec3\":30,\"./Constraint\":13}],18:[function(t,e,n){e.exports=o;var i=t(\"../math/Vec3\"),r=(t(\"../math/Mat3\"),t(\"./Equation\"));function o(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.angle=void 0!==n.angle?n.angle:0}o.prototype=new r,o.prototype.constructor=o;var s=new i,a=new i;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,o=s,h=a,c=this.jacobianElementA,l=this.jacobianElementB;i.cross(r,o),r.cross(i,h),c.rotational.copy(h),l.rotational.copy(o);var u=Math.cos(this.angle)-i.dot(r),p=this.computeGW(),f=this.computeGiMf(),d=-u*e-p*n-t*f;return d}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],19:[function(t,e,n){e.exports=o;var i=t(\"./Equation\"),r=t(\"../math/Vec3\");function o(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,0,n),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}t(\"../math/Mat3\"),o.prototype=new i,o.prototype.constructor=o;var s=new r,a=new r,h=new r;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.bi,r=this.bj,o=this.ri,c=this.rj,l=s,u=a,p=i.velocity,f=i.angularVelocity,d=(i.force,i.torque,r.velocity),y=r.angularVelocity,v=(r.force,r.torque,h),m=this.jacobianElementA,g=this.jacobianElementB,b=this.ni;o.cross(b,l),c.cross(b,u),b.negate(m.spatial),l.negate(m.rotational),g.spatial.copy(b),g.rotational.copy(u),v.copy(r.position),v.vadd(c,v),v.vsub(i.position,v),v.vsub(o,v);var w=b.dot(v),x=this.restitution+1,E=x*d.dot(b)-x*p.dot(b)+y.dot(u)-f.dot(l),C=this.computeGiMf(),S=-w*e-E*n-t*C;return S};var c=new r,l=new r,u=new r,p=new r,f=new r;o.prototype.getImpactVelocityAlongNormal=function(){var t=c,e=l,n=u,i=p,r=f;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,i),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(i,e),t.vsub(e,r),this.ni.dot(r)}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],20:[function(t,e,n){e.exports=o;var i=t(\"../math/JacobianElement\"),r=t(\"../math/Vec3\");function o(t,e,n,r){this.id=o.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===r?1e6:r,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new i,this.jacobianElementB=new i,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}o.prototype.constructor=o,o.id=0,o.prototype.setSpookParams=function(t,e,n){var i=e,r=t,o=n;this.a=4/(o*(1+4*i)),this.b=4*i/(1+4*i),this.eps=4/(o*o*r*(1+4*i))},o.prototype.computeB=function(t,e,n){var i=this.computeGW(),r=this.computeGq(),o=this.computeGiMf();return-r*t-i*e-o*n},o.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.position,o=i.position;return t.spatial.dot(r)+e.spatial.dot(o)};var s=new r;o.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.velocity,o=i.velocity,a=n.angularVelocity||s,h=i.angularVelocity||s;return t.multiplyVectors(r,a)+e.multiplyVectors(o,h)},o.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.vlambda,o=i.vlambda,a=n.wlambda||s,h=i.wlambda||s;return t.multiplyVectors(r,a)+e.multiplyVectors(o,h)};var a=new r,h=new r,c=new r,l=new r;o.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.force,o=n.torque,s=i.force,u=i.torque,p=n.invMassSolve,f=i.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(o,c):c.set(0,0,0),i.invInertiaWorldSolve?i.invInertiaWorldSolve.vmult(u,l):l.set(0,0,0),r.mult(p,a),s.mult(f,h),t.multiplyVectors(a,c)+e.multiplyVectors(h,l)};var u=new r;o.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,i=this.bj,r=n.invMassSolve,o=i.invMassSolve,s=n.invInertiaWorldSolve,a=i.invInertiaWorldSolve,h=r+o;return s&&(s.vmult(t.rotational,u),h+=u.dot(t.rotational)),a&&(a.vmult(e.rotational,u),h+=u.dot(e.rotational)),h};var p=new r;new r,new r,new r,new r,new r,o.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,i=this.bi,r=this.bj,o=p;e.spatial.mult(i.invMassSolve*t,o),i.vlambda.vadd(o,i.vlambda),n.spatial.mult(r.invMassSolve*t,o),r.vlambda.vadd(o,r.vlambda),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(e.rotational,o),o.mult(t,o),i.wlambda.vadd(o,i.wlambda)),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(n.rotational,o),o.mult(t,o),r.wlambda.vadd(o,r.wlambda))},o.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{\"../math/JacobianElement\":26,\"../math/Vec3\":30}],21:[function(t,e,n){e.exports=o;var i=t(\"./Equation\"),r=t(\"../math/Vec3\");function o(t,e,n){i.call(this,t,e,-n,n),this.ri=new r,this.rj=new r,this.t=new r}t(\"../math/Mat3\"),o.prototype=new i,o.prototype.constructor=o;var s=new r,a=new r;o.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),i=this.rj,r=s,o=a,h=this.t;n.cross(h,r),i.cross(h,o);var c=this.jacobianElementA,l=this.jacobianElementB;h.negate(c.spatial),r.negate(c.rotational),l.spatial.copy(h),l.rotational.copy(o);var u=this.computeGW(),p=this.computeGiMf(),f=-u*e-t*p;return f}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],22:[function(t,e,n){e.exports=o;var i=t(\"../math/Vec3\"),r=(t(\"../math/Mat3\"),t(\"./Equation\"));function o(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;r.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new i(1,0,0),this.axisB=n.axisB?n.axisB.clone():new i(0,1,0),this.maxAngle=Math.PI/2}o.prototype=new r,o.prototype.constructor=o;var s=new i,a=new i;o.prototype.computeB=function(t){var e=this.a,n=this.b,i=this.axisA,r=this.axisB,o=s,h=a,c=this.jacobianElementA,l=this.jacobianElementB;i.cross(r,o),r.cross(i,h),c.rotational.copy(h),l.rotational.copy(o);var u=Math.cos(this.maxAngle)-i.dot(r),p=this.computeGW(),f=this.computeGiMf(),d=-u*e-p*n-t*f;return d}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],23:[function(t,e,n){e.exports=o;var i=t(\"../math/Vec3\"),r=(t(\"../math/Mat3\"),t(\"./Equation\"));function o(t,e,n){n=void 0!==n?n:1e6,r.call(this,t,e,-n,n),this.axisA=new i,this.axisB=new i,this.targetVelocity=0}o.prototype=new r,o.prototype.constructor=o,o.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),i=this.axisB,r=this.jacobianElementA,o=this.jacobianElementB;r.rotational.copy(n),i.negate(o.rotational);var s=this.computeGW()-this.targetVelocity,a=this.computeGiMf(),h=-s*e-t*a;return h}},{\"../math/Mat3\":27,\"../math/Vec3\":30,\"./Equation\":20}],24:[function(t,e,n){var i=t(\"../utils/Utils\");function r(t,e,n){n=i.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}e.exports=r,r.idCounter=0},{\"../utils/Utils\":53}],25:[function(t,e,n){function i(t){var e=\"\";\"string\"==typeof(t=t||{})?(e=t,t={}):\"object\"==typeof t&&(e=\"\"),this.name=e,this.id=i.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=i,i.idCounter=0},{}],26:[function(t,e,n){e.exports=r;var i=t(\"./Vec3\");function r(){this.spatial=new i,this.rotational=new i}r.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{\"./Vec3\":30}],27:[function(t,e,n){e.exports=r;var i=t(\"./Vec3\");function r(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}r.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},r.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},r.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},r.prototype.getTrace=function(t){var t=t||new i,e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},r.prototype.vmult=function(t,e){e=e||new i;var n=this.elements,r=t.x,o=t.y,s=t.z;return e.x=n[0]*r+n[1]*o+n[2]*s,e.y=n[3]*r+n[4]*o+n[5]*s,e.z=n[6]*r+n[7]*o+n[8]*s,e},r.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},r.prototype.mmult=function(t,e){for(var n=e||new r,i=0;i<3;i++)for(var o=0;o<3;o++){for(var s=0,a=0;a<3;a++)s+=t.elements[i+3*a]*this.elements[a+3*o];n.elements[i+3*o]=s}return n},r.prototype.scale=function(t,e){e=e||new r;for(var n=this.elements,i=e.elements,o=0;3!==o;o++)i[3*o+0]=t.x*n[3*o+0],i[3*o+1]=t.y*n[3*o+1],i[3*o+2]=t.z*n[3*o+2];return e},r.prototype.solve=function(t,e){e=e||new i;for(var n,r=[],o=0;o<12;o++)r.push(0);for(o=0;o<3;o++)for(n=0;n<3;n++)r[o+4*n]=this.elements[o+3*n];r[3]=t.x,r[7]=t.y,r[11]=t.z;var s,a,h=3,c=h;do{if(0===r[(o=c-h)+4*o])for(n=o+1;n<c;n++)if(0!==r[o+4*n]){s=4;do{r[(a=4-s)+4*o]+=r[a+4*n]}while(--s);break}if(0!==r[o+4*o])for(n=o+1;n<c;n++){var l=r[o+4*n]/r[o+4*o];s=4;do{r[(a=4-s)+4*n]=a<=o?0:r[a+4*n]-r[a+4*o]*l}while(--s)}}while(--h);if(e.z=r[11]/r[10],e.y=(r[7]-r[6]*e.z)/r[5],e.x=(r[3]-r[2]*e.z-r[1]*e.y)/r[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw\"Could not solve equation! Got x=[\"+e.toString()+\"], b=[\"+t.toString()+\"], A=[\"+this.toString()+\"]\";return e},r.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},r.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},r.prototype.toString=function(){for(var t=\"\",e=0;e<9;e++)t+=this.elements[e]+\",\";return t},r.prototype.reverse=function(t){t=t||new r;for(var e,n=[],i=0;i<18;i++)n.push(0);for(i=0;i<3;i++)for(e=0;e<3;e++)n[i+6*e]=this.elements[i+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var o,s,a=3,h=a;do{if(0===n[(i=h-a)+6*i])for(e=i+1;e<h;e++)if(0!==n[i+6*e]){o=6;do{n[(s=6-o)+6*i]+=n[s+6*e]}while(--o);break}if(0!==n[i+6*i])for(e=i+1;e<h;e++){var c=n[i+6*e]/n[i+6*i];o=6;do{n[(s=6-o)+6*e]=s<=i?0:n[s+6*e]-n[s+6*i]*c}while(--o)}}while(--a);i=2;do{e=i-1;do{var c=n[i+6*e]/n[i+6*i];o=6;do{n[(s=6-o)+6*e]=n[s+6*e]-n[s+6*i]*c}while(--o)}while(e--)}while(--i);i=2;do{var c=1/n[i+6*i];o=6;do{n[(s=6-o)+6*i]=n[s+6*i]*c}while(--o)}while(i--);i=2;do{e=2;do{if(s=n[3+e+6*i],isNaN(s)||s===1/0)throw\"Could not reverse! A=[\"+this.toString()+\"]\";t.e(i,e,s)}while(e--)}while(i--);return t},r.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,o=e+e,s=n+n,a=i+i,h=e*o,c=e*s,l=e*a,u=n*s,p=n*a,f=i*a,d=r*o,y=r*s,v=r*a,m=this.elements;return m[0]=1-(u+f),m[1]=c-v,m[2]=l+y,m[3]=c+v,m[4]=1-(h+f),m[5]=p-d,m[6]=l-y,m[7]=p+d,m[8]=1-(h+u),this},r.prototype.transpose=function(t){for(var e=(t=t||new r).elements,n=this.elements,i=0;3!==i;i++)for(var o=0;3!==o;o++)e[3*i+o]=n[3*o+i];return t}},{\"./Vec3\":30}],28:[function(t,e,n){e.exports=r;var i=t(\"./Vec3\");function r(t,e,n,i){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==i?i:1}r.prototype.set=function(t,e,n,i){this.x=t,this.y=e,this.z=n,this.w=i},r.prototype.toString=function(){return this.x+\",\"+this.y+\",\"+this.z+\",\"+this.w},r.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},r.prototype.toAxisAngle=function(t){t=t||new i,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var o=new i,s=new i;r.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var n=o,i=s;t.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{var r=t.cross(e);this.x=r.x,this.y=r.y,this.z=r.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var a=new i,h=new i,c=new i;r.prototype.mult=function(t,e){e=e||new r;var n=this.w,i=a,o=h,s=c;return i.set(this.x,this.y,this.z),o.set(t.x,t.y,t.z),e.w=n*t.w-i.dot(o),i.cross(o,s),e.x=n*o.x+t.w*i.x+s.x,e.y=n*o.y+t.w*i.y+s.y,e.z=n*o.z+t.w*i.z+s.z,e},r.prototype.inverse=function(t){var e=this.x,n=this.y,i=this.z,o=this.w;t=t||new r,this.conjugate(t);var s=1/(e*e+n*n+i*i+o*o);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t},r.prototype.conjugate=function(t){return(t=t||new r).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},r.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},r.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},r.prototype.vmult=function(t,e){e=e||new i;var n=t.x,r=t.y,o=t.z,s=this.x,a=this.y,h=this.z,c=this.w,l=c*n+a*o-h*r,u=c*r+h*n-s*o,p=c*o+s*r-a*n,f=-s*n-a*r-h*o;return e.x=l*c+f*-s+u*-h-p*-a,e.y=u*c+f*-a+p*-s-l*-h,e.z=p*c+f*-h+l*-a-u*-s,e},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},r.prototype.toEuler=function(t,e){var n,i,r;e=e||\"YZX\";var o=this.x,s=this.y,a=this.z,h=this.w;switch(e){case\"YZX\":var c=o*s+a*h;if(c>.499&&(n=2*Math.atan2(o,h),i=Math.PI/2,r=0),c<-.499&&(n=-2*Math.atan2(o,h),i=-Math.PI/2,r=0),isNaN(n)){var l=o*o,u=s*s,p=a*a;n=Math.atan2(2*s*h-2*o*a,1-2*u-2*p),i=Math.asin(2*c),r=Math.atan2(2*o*h-2*s*a,1-2*l-2*p)}break;default:throw new Error(\"Euler order \"+e+\" not supported yet.\")}t.y=n,t.z=i,t.x=r},r.prototype.setFromEuler=function(t,e,n,i){i=i||\"XYZ\";var r=Math.cos(t/2),o=Math.cos(e/2),s=Math.cos(n/2),a=Math.sin(t/2),h=Math.sin(e/2),c=Math.sin(n/2);return\"XYZ\"===i?(this.x=a*o*s+r*h*c,this.y=r*h*s-a*o*c,this.z=r*o*c+a*h*s,this.w=r*o*s-a*h*c):\"YXZ\"===i?(this.x=a*o*s+r*h*c,this.y=r*h*s-a*o*c,this.z=r*o*c-a*h*s,this.w=r*o*s+a*h*c):\"ZXY\"===i?(this.x=a*o*s-r*h*c,this.y=r*h*s+a*o*c,this.z=r*o*c+a*h*s,this.w=r*o*s-a*h*c):\"ZYX\"===i?(this.x=a*o*s-r*h*c,this.y=r*h*s+a*o*c,this.z=r*o*c-a*h*s,this.w=r*o*s+a*h*c):\"YZX\"===i?(this.x=a*o*s+r*h*c,this.y=r*h*s+a*o*c,this.z=r*o*c-a*h*s,this.w=r*o*s-a*h*c):\"XZY\"===i&&(this.x=a*o*s-r*h*c,this.y=r*h*s-a*o*c,this.z=r*o*c+a*h*s,this.w=r*o*s+a*h*c),this},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)}},{\"./Vec3\":30}],29:[function(t,e,n){var i=t(\"./Vec3\"),r=t(\"./Quaternion\");function o(t){t=t||{},this.position=new i,t.position&&this.position.copy(t.position),this.quaternion=new r,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=o;var s=new r;o.pointToLocalFrame=function(t,e,n,r){var r=r||new i;return n.vsub(t,r),e.conjugate(s),s.vmult(r,r),r},o.prototype.pointToLocal=function(t,e){return o.pointToLocalFrame(this.position,this.quaternion,t,e)},o.pointToWorldFrame=function(t,e,n,r){var r=r||new i;return e.vmult(n,r),r.vadd(t,r),r},o.prototype.pointToWorld=function(t,e){return o.pointToWorldFrame(this.position,this.quaternion,t,e)},o.prototype.vectorToWorldFrame=function(t,e){var e=e||new i;return this.quaternion.vmult(t,e),e},o.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},o.vectorToLocalFrame=function(t,e,n,r){var r=r||new i;return e.w*=-1,e.vmult(n,r),e.w*=-1,r}},{\"./Quaternion\":28,\"./Vec3\":30}],30:[function(t,e,n){e.exports=r;var i=t(\"./Mat3\");function r(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}r.ZERO=new r(0,0,0),r.UNIT_X=new r(1,0,0),r.UNIT_Y=new r(0,1,0),r.UNIT_Z=new r(0,0,1),r.prototype.cross=function(t,e){var n=t.x,i=t.y,o=t.z,s=this.x,a=this.y,h=this.z;return(e=e||new r).x=a*o-h*i,e.y=h*n-s*o,e.z=s*i-a*n,e},r.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},r.prototype.setZero=function(){this.x=this.y=this.z=0},r.prototype.vadd=function(t,e){if(!e)return new r(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},r.prototype.vsub=function(t,e){if(!e)return new r(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},r.prototype.crossmat=function(){return new i([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},r.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,i=Math.sqrt(t*t+e*e+n*n);if(i>0){var r=1/i;this.x*=r,this.y*=r,this.z*=r}else this.x=0,this.y=0,this.z=0;return i},r.prototype.unit=function(t){t=t||new r;var e=this.x,n=this.y,i=this.z,o=Math.sqrt(e*e+n*n+i*i);return o>0?(o=1/o,t.x=e*o,t.y=n*o,t.z=i*o):(t.x=1,t.y=0,t.z=0),t},r.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},r.prototype.length=r.prototype.norm,r.prototype.norm2=function(){return this.dot(this)},r.prototype.lengthSquared=r.prototype.norm2,r.prototype.distanceTo=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,s=t.z;return Math.sqrt((r-e)*(r-e)+(o-n)*(o-n)+(s-i)*(s-i))},r.prototype.distanceSquared=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,s=t.z;return(r-e)*(r-e)+(o-n)*(o-n)+(s-i)*(s-i)},r.prototype.mult=function(t,e){e=e||new r;var n=this.x,i=this.y,o=this.z;return e.x=t*n,e.y=t*i,e.z=t*o,e},r.prototype.scale=r.prototype.mult,r.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},r.prototype.negate=function(t){return(t=t||new r).x=-this.x,t.y=-this.y,t.z=-this.z,t};var o=new r,s=new r;r.prototype.tangents=function(t,e){var n=this.norm();if(n>0){var i=o,r=1/n;i.set(this.x*r,this.y*r,this.z*r);var a=s;Math.abs(i.x)<.9?(a.set(1,0,0),i.cross(a,t)):(a.set(0,1,0),i.cross(a,t)),i.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},r.prototype.toString=function(){return this.x+\",\"+this.y+\",\"+this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},r.prototype.lerp=function(t,e,n){var i=this.x,r=this.y,o=this.z;n.x=i+(t.x-i)*e,n.y=r+(t.y-r)*e,n.z=o+(t.z-o)*e},r.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},r.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new r;r.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)}},{\"./Mat3\":27}],31:[function(t,e,n){e.exports=c;var i=t(\"../utils/EventTarget\"),r=(t(\"../shapes/Shape\"),t(\"../math/Vec3\")),o=t(\"../math/Mat3\"),s=t(\"../math/Quaternion\"),a=(t(\"../material/Material\"),t(\"../collision/AABB\")),h=t(\"../shapes/Box\");function c(t){t=t||{},i.apply(this),this.id=c.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup=\"number\"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=\"number\"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,t.position&&this.position.copy(t.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new r,this.force=new r;var e=\"number\"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping=\"number\"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?c.STATIC:c.DYNAMIC,typeof t.type==typeof c.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new s,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new s,this.angularVelocity=new r,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new a,this.aabbNeedsUpdate=!0,this.wlambda=new r,t.shape&&this.addShape(t.shape),this.updateMassProperties()}c.prototype=new i,c.prototype.constructor=c,c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2,c.idCounter=0,c.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===c.SLEEPING&&this.dispatchEvent({type:\"wakeup\"})},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},c.sleepyEvent={type:\"sleepy\"},c.sleepEvent={type:\"sleep\"},c.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),i=Math.pow(this.sleepSpeedLimit,2);e===c.AWAKE&&n<i?(this.sleepState=c.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(c.sleepyEvent)):e===c.SLEEPY&&n>i?this.wakeUp():e===c.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(c.sleepEvent))}},c.prototype.updateSolveMassProperties=function(){this.sleepState===c.SLEEPING||this.type===c.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},c.prototype.pointToLocalFrame=function(t,e){var e=e||new r;return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},c.prototype.vectorToLocalFrame=function(t,e){var e=e||new r;return this.quaternion.conjugate().vmult(t,e),e},c.prototype.pointToWorldFrame=function(t,e){var e=e||new r;return this.quaternion.vmult(t,e),e.vadd(this.position,e),e},c.prototype.vectorToWorldFrame=function(t,e){var e=e||new r;return this.quaternion.vmult(t,e),e};var l=new r,u=new s;c.prototype.addShape=function(t,e,n){var i=new r,o=new s;return e&&i.copy(e),n&&o.copy(n),this.shapes.push(t),this.shapeOffsets.push(i),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},c.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,i=0,r=0;r!==n;r++){var o=t[r];o.updateBoundingSphereRadius();var s=e[r].norm(),a=o.boundingSphereRadius;s+a>i&&(i=s+a)}this.boundingRadius=i};var p=new a;c.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,i=t.length,r=l,o=u,s=this.quaternion,a=this.aabb,h=p,c=0;c!==i;c++){var f=t[c];n[c].mult(s,o),o.vmult(e[c],r),r.vadd(this.position,r),f.calculateWorldAABB(r,o,h.lowerBound,h.upperBound),0===c?a.copy(h):a.extend(h)}this.aabbNeedsUpdate=!1};var f=new o,d=new o;new o,c.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var n=f,i=d;n.setRotationFromQuaternion(this.quaternion),n.transpose(i),n.scale(e,n),n.mmult(i,this.invInertiaWorld)}};var y=new r,v=new r;c.prototype.applyForce=function(t,e){if(this.type===c.DYNAMIC){var n=y;e.vsub(this.position,n);var i=v;n.cross(t,i),this.force.vadd(t,this.force),this.torque.vadd(i,this.torque)}};var m=new r,g=new r;c.prototype.applyLocalForce=function(t,e){if(this.type===c.DYNAMIC){var n=m,i=g;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyForce(n,i)}};var b=new r,w=new r,x=new r;c.prototype.applyImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=b;e.vsub(this.position,n);var i=w;i.copy(t),i.mult(this.invMass,i),this.velocity.vadd(i,this.velocity);var r=x;n.cross(t,r),this.invInertiaWorld.vmult(r,r),this.angularVelocity.vadd(r,this.angularVelocity)}};var E=new r,C=new r;c.prototype.applyLocalImpulse=function(t,e){if(this.type===c.DYNAMIC){var n=E,i=C;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,i),this.applyImpulse(n,i)}};var S=new r;c.prototype.updateMassProperties=function(){var t=S;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),h.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)},c.prototype.getVelocityAtWorldPoint=function(t,e){var n=new r;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{\"../collision/AABB\":3,\"../material/Material\":25,\"../math/Mat3\":27,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/Shape\":43,\"../utils/EventTarget\":49}],32:[function(t,e,n){t(\"./Body\");var i=t(\"../math/Vec3\"),r=t(\"../math/Quaternion\"),o=(t(\"../collision/RaycastResult\"),t(\"../collision/Ray\")),s=t(\"../objects/WheelInfo\");function a(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=a,new i,new i,new i;var h=new i,c=new i,l=new i;new o,a.prototype.addWheel=function(t){var e=new s(t=t||{}),n=this.wheelInfos.length;return this.wheelInfos.push(e),n},a.prototype.setSteeringValue=function(t,e){var n=this.wheelInfos[e];n.steering=t},new i,a.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},a.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},a.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener(\"preStep\",this.preStepCallback),this.world=t},a.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},a.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,r=this.chassisBody,o=0;o<n;o++)this.updateWheelTransform(o);this.currentVehicleSpeedKmHour=3.6*r.velocity.norm();var s=new i;this.getVehicleAxisWorld(this.indexForwardAxis,s),s.dot(r.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var o=0;o<n;o++)this.castRay(e[o]);this.updateSuspension(t);for(var a=new i,h=new i,o=0;o<n;o++){var c=e[o],l=c.suspensionForce;l>c.maxSuspensionForce&&(l=c.maxSuspensionForce),c.raycastResult.hitNormalWorld.scale(l*t,a),c.raycastResult.hitPointWorld.vsub(r.position,h),r.applyImpulse(a,c.raycastResult.hitPointWorld)}this.updateFriction(t);var u=new i,p=new i,f=new i;for(o=0;o<n;o++){var c=e[o];r.getVelocityAtWorldPoint(c.chassisConnectionPointWorld,f);var d=1;switch(this.indexUpAxis){case 1:d=-1}if(c.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,p);var y=p.dot(c.raycastResult.hitNormalWorld);c.raycastResult.hitNormalWorld.scale(y,u),p.vsub(u,p);var v=p.dot(f);c.deltaRotation=d*v*t/c.radius}!c.sliding&&c.isInContact||0===c.engineForce||!c.useCustomSlidingRotationalSpeed||(c.deltaRotation=(c.engineForce>0?1:-1)*c.customSlidingRotationalSpeed*t),Math.abs(c.brake)>Math.abs(c.engineForce)&&(c.deltaRotation=0),c.rotation+=c.deltaRotation,c.deltaRotation*=.99}},a.prototype.updateSuspension=function(t){for(var e=this.chassisBody,n=e.mass,i=this.wheelInfos,r=i.length,o=0;o<r;o++){var s=i[o];if(s.isInContact){var a,h=s.suspensionRestLength,c=s.suspensionLength,l=h-c;a=s.suspensionStiffness*l*s.clippedInvContactDotSuspension;var u,p=s.suspensionRelativeVelocity;u=p<0?s.dampingCompression:s.dampingRelaxation,a-=u*p,s.suspensionForce=a*n,s.suspensionForce<0&&(s.suspensionForce=0)}else s.suspensionForce=0}},a.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener(\"preStep\",this.preStepCallback),this.world=null};var u=new i,p=new i;a.prototype.castRay=function(t){var e=u,n=p;this.updateWheelTransformWorld(t);var r=this.chassisBody,o=-1,s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);var a=t.chassisConnectionPointWorld;a.vadd(e,n);var h=t.raycastResult;h.reset();var c=r.collisionResponse;r.collisionResponse=!1,this.world.rayTest(a,n,h),r.collisionResponse=c;var l=h.body;if(t.raycastResult.groundObject=0,l){o=h.distance,t.raycastResult.hitNormalWorld=h.hitNormalWorld,t.isInContact=!0;var f=h.distance;t.suspensionLength=f-t.radius;var d=t.suspensionRestLength-t.maxSuspensionTravel,y=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<d&&(t.suspensionLength=d),t.suspensionLength>y&&(t.suspensionLength=y,t.raycastResult.reset());var v=t.raycastResult.hitNormalWorld.dot(t.directionWorld),m=new i;r.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,m);var g=t.raycastResult.hitNormalWorld.dot(m);if(v>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var b=-1/v;t.suspensionRelativeVelocity=g*b,t.clippedInvContactDotSuspension=b}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return o},a.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},a.prototype.updateWheelTransform=function(t){var e=h,n=c,i=l,o=this.wheelInfos[t];this.updateWheelTransformWorld(o),o.directionLocal.scale(-1,e),n.copy(o.axleLocal),e.cross(n,i),i.normalize(),n.normalize();var s=o.steering,a=new r;a.setFromAxisAngle(e,s);var u=new r;u.setFromAxisAngle(n,o.rotation);var p=o.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,p),p.mult(u,p),p.normalize();var f=o.worldTransform.position;f.copy(o.directionWorld),f.scale(o.suspensionLength,f),f.vadd(o.chassisConnectionPointWorld,f)};var f=[new i(1,0,0),new i(0,1,0),new i(0,0,1)];a.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var d=new i,y=[],v=[];a.prototype.updateFriction=function(t){for(var e=d,n=this.wheelInfos,r=n.length,o=this.chassisBody,s=v,a=y,h=0;h<r;h++){var c=n[h],l=c.raycastResult.body;c.sideImpulse=0,c.forwardImpulse=0,s[h]||(s[h]=new i),a[h]||(a[h]=new i)}for(var h=0;h<r;h++){var c=n[h],l=c.raycastResult.body;if(l){var u=a[h],p=this.getWheelTransformWorld(h);p.vectorToWorldFrame(f[this.indexRightAxis],u);var m=c.raycastResult.hitNormalWorld,g=u.dot(m);m.scale(g,e),u.vsub(e,u),u.normalize(),m.cross(u,s[h]),s[h].normalize(),c.sideImpulse=_(o,c.raycastResult.hitPointWorld,l,c.raycastResult.hitPointWorld,u),c.sideImpulse*=1}}this.sliding=!1;for(var h=0;h<r;h++){var c=n[h],l=c.raycastResult.body,b=0;if(c.slipInfo=1,l){var x=c.brake?c.brake:0;b=w(o,l,c.raycastResult.hitPointWorld,s[h],x),b+=c.engineForce*t;var E=x/b;c.slipInfo*=E}if(c.forwardImpulse=0,c.skidInfo=1,l){c.skidInfo=1;var C=c.suspensionForce*t*c.frictionSlip,S=C,T=C*S;c.forwardImpulse=b;var A=.5*c.forwardImpulse,B=1*c.sideImpulse,R=A*A+B*B;if(c.sliding=!1,R>T){this.sliding=!0,c.sliding=!0;var E=C/Math.sqrt(R);c.skidInfo*=E}}}if(this.sliding)for(var h=0;h<r;h++){var c=n[h];0!==c.sideImpulse&&c.skidInfo<1&&(c.forwardImpulse*=c.skidInfo,c.sideImpulse*=c.skidInfo)}for(var h=0;h<r;h++){var c=n[h],P=new i;if(P.copy(c.raycastResult.hitPointWorld),0!==c.forwardImpulse){var F=new i;s[h].scale(c.forwardImpulse,F),o.applyImpulse(F,P)}if(0!==c.sideImpulse){var l=c.raycastResult.body,I=new i;I.copy(c.raycastResult.hitPointWorld);var k=new i;a[h].scale(c.sideImpulse,k),o.pointToLocalFrame(P,P),P[\"xyz\"[this.indexUpAxis]]*=c.rollInfluence,o.pointToWorldFrame(P,P),o.applyImpulse(k,P),k.scale(-1,k),l.applyImpulse(k,I)}}};var m=new i,g=new i,b=new i;function w(t,e,n,i,r){var o=0,s=n,a=m,h=g,c=b;t.getVelocityAtWorldPoint(s,a),e.getVelocityAtWorldPoint(s,h),a.vsub(h,c);var l=i.dot(c),u=T(t,n,i),p=T(e,n,i),f=1/(u+p);return r<(o=-l*f)&&(o=r),o<-r&&(o=-r),o}var x=new i,E=new i,C=new i,S=new i;function T(t,e,n){var i=x,r=E,o=C,s=S;return e.vsub(t.position,i),i.cross(n,r),t.invInertiaWorld.vmult(r,s),s.cross(i,o),t.invMass+n.dot(o)}var A=new i,B=new i,R=new i;function _(t,e,n,i,r,o){var s=r.norm2();if(s>1.1)return 0;var a=A,h=B,c=R;t.getVelocityAtWorldPoint(e,a),n.getVelocityAtWorldPoint(i,h),a.vsub(h,c);var l=r.dot(c),u=1/(t.invMass+n.invMass),o=-.2*l*u;return o}},{\"../collision/Ray\":9,\"../collision/RaycastResult\":10,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/WheelInfo\":36,\"./Body\":31}],33:[function(t,e,n){var i=t(\"./Body\"),r=t(\"../shapes/Sphere\"),o=t(\"../shapes/Box\"),s=t(\"../math/Vec3\"),a=t(\"../constraints/HingeConstraint\");function h(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new s(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new o(new s(5,2,.5));this.chassisBody=new i(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=h,h.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new i(1,new r(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new s;var n=void 0!==t.position?t.position.clone():new s,o=new s;this.chassisBody.pointToWorldFrame(n,o),e.position.set(o.x,o.y,o.z);var h=void 0!==t.axis?t.axis.clone():new s(0,1,0);this.wheelAxes.push(h);var c=new a(this.chassisBody,e,{pivotA:n,axisA:h,pivotB:s.ZERO,axisB:h,collideConnected:!1});return this.constraints.push(c),this.wheelBodies.length-1},h.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],i=Math.cos(t),r=Math.sin(t),o=n.x,s=n.y;this.constraints[e].axisA.set(i*o-r*s,r*o+i*s,0)},h.prototype.setMotorSpeed=function(t,e){var n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t},h.prototype.disableMotor=function(t){var e=this.constraints[t];e.disableMotor()};var c=new s;h.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},h.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],i=this.wheelBodies[e],r=i.torque;n.scale(t,c),i.vectorToWorldFrame(c,c),r.vadd(c,r)},h.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.add(n[i]);for(var i=0;i<e.length;i++)t.addConstraint(e[i]);t.addEventListener(\"preStep\",this._update.bind(this))},h.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},h.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),i=0;i<n.length;i++)t.remove(n[i]);for(var i=0;i<e.length;i++)t.removeConstraint(e[i])};var l=new s;h.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],n=this.wheelBodies[t],i=n.angularVelocity;return this.chassisBody.vectorToWorldFrame(e,l),i.dot(l)}},{\"../constraints/HingeConstraint\":15,\"../math/Vec3\":30,\"../shapes/Box\":37,\"../shapes/Sphere\":44,\"./Body\":31}],34:[function(t,e,n){e.exports=r,t(\"../shapes/Shape\");var i=t(\"../math/Vec3\");function r(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t(\"../math/Quaternion\"),t(\"../shapes/Particle\"),t(\"../objects/Body\"),t(\"../material/Material\"),r.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},r.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new i;r.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,i=t.id,r=this.smoothingRadius*this.smoothingRadius,s=o,a=0;a!==n;a++){var h=this.particles[a];h.position.vsub(t.position,s),i!==h.id&&s.norm2()<r&&e.push(h)}};var s=new i,a=new i,h=new i,c=new i,l=new i,u=new i;r.prototype.update=function(){for(var t=this.particles.length,e=s,n=this.speedOfSound,i=this.eps,r=0;r!==t;r++){var o=this.particles[r],p=this.neighbors[r];p.length=0,this.getNeighbors(o,p),p.push(this.particles[r]);for(var f=p.length,d=0,y=0;y!==f;y++){o.position.vsub(p[y].position,e);var v=e.norm(),m=this.w(v);d+=p[y].mass*m}this.densities[r]=d,this.pressures[r]=n*n*(this.densities[r]-this.density)}for(var g=a,b=h,w=c,x=l,E=u,r=0;r!==t;r++){var C,S,T=this.particles[r];g.set(0,0,0),b.set(0,0,0);for(var p=this.neighbors[r],f=p.length,y=0;y!==f;y++){var A=p[y];T.position.vsub(A.position,x);var B=x.norm();C=-A.mass*(this.pressures[r]/(this.densities[r]*this.densities[r]+i)+this.pressures[y]/(this.densities[y]*this.densities[y]+i)),this.gradw(x,w),w.mult(C,w),g.vadd(w,g),A.velocity.vsub(T.velocity,E),E.mult(1/(1e-4+this.densities[r]*this.densities[y])*this.viscosity*A.mass,E),S=this.nablaw(B),E.mult(S,E),b.vadd(E,b)}b.mult(T.mass,b),g.mult(T.mass,g),T.force.vadd(b,T.force),T.force.vadd(g,T.force)}},r.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},r.prototype.gradw=function(t,e){var n=t.norm(),i=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(i,9))*Math.pow(i*i-n*n,2),e)},r.prototype.nablaw=function(t){var e=this.smoothingRadius,n=945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e);return n}},{\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Particle\":41,\"../shapes/Shape\":43}],35:[function(t,e,n){var i=t(\"../math/Vec3\");function r(t,e,n){n=n||{},this.restLength=\"number\"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new i,this.localAnchorB=new i,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}e.exports=r,r.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},r.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},r.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},r.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var o=new i,s=new i,a=new i,h=new i,c=new i,l=new i,u=new i,p=new i,f=new i,d=new i,y=new i;r.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,i=this.bodyA,r=this.bodyB,v=o,m=s,g=a,b=h,w=y,x=c,E=l,C=u,S=p,T=f,A=d;this.getWorldAnchorA(x),this.getWorldAnchorB(E),x.vsub(i.position,C),E.vsub(r.position,S),E.vsub(x,v);var B=v.norm();m.copy(v),m.normalize(),r.velocity.vsub(i.velocity,g),r.angularVelocity.cross(S,w),g.vadd(w,g),i.angularVelocity.cross(C,w),g.vsub(w,g),m.mult(-t*(B-n)-e*g.dot(m),b),i.force.vsub(b,i.force),r.force.vadd(b,r.force),C.cross(b,T),S.cross(b,A),i.torque.vsub(T,i.torque),r.torque.vadd(A,r.torque)}},{\"../math/Vec3\":30}],36:[function(t,e,n){var i=t(\"../math/Vec3\"),r=t(\"../math/Transform\"),o=t(\"../collision/RaycastResult\"),s=t(\"../utils/Utils\");function a(t){t=s.defaults(t,{chassisConnectionPointLocal:new i,chassisConnectionPointWorld:new i,directionLocal:new i,directionWorld:new i,axleLocal:new i,axleWorld:new i,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new r,this.isInContact=!1}e.exports=a;var h=new i,c=new i,h=new i;a.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,c),t.getVelocityAtWorldPoint(c,h);var i=e.hitNormalWorld.dot(h);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var r=-1/n;this.suspensionRelativeVelocity=i*r,this.clippedInvContactDotSuspension=r}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{\"../collision/RaycastResult\":10,\"../math/Transform\":29,\"../math/Vec3\":30,\"../utils/Utils\":53}],37:[function(t,e,n){e.exports=s;var i=t(\"./Shape\"),r=t(\"../math/Vec3\"),o=t(\"./ConvexPolyhedron\");function s(t){i.call(this),this.type=i.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}s.prototype=new i,s.prototype.constructor=s,s.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,i=r,s=[new i(-t,-e,-n),new i(t,-e,-n),new i(t,e,-n),new i(-t,e,-n),new i(-t,-e,n),new i(t,-e,n),new i(t,e,n),new i(-t,e,n)],a=(new i(0,0,1),new i(0,1,0),new i(1,0,0),new o(s,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=a,a.material=this.material},s.prototype.calculateLocalInertia=function(t,e){return e=e||new r,s.calculateInertia(this.halfExtents,t,e),e},s.calculateInertia=function(t,e,n){var i=t;n.x=1/12*e*(2*i.y*2*i.y+2*i.z*2*i.z),n.y=1/12*e*(2*i.x*2*i.x+2*i.z*2*i.z),n.z=1/12*e*(2*i.y*2*i.y+2*i.x*2*i.x)},s.prototype.getSideNormals=function(t,e){var n=t,i=this.halfExtents;if(n[0].set(i.x,0,0),n[1].set(0,i.y,0),n[2].set(0,0,i.z),n[3].set(-i.x,0,0),n[4].set(0,-i.y,0),n[5].set(0,0,-i.z),void 0!==e)for(var r=0;r!==n.length;r++)e.vmult(n[r],n[r]);return n},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new r;new r,s.prototype.forEachWorldCorner=function(t,e,n){for(var i=this.halfExtents,r=[[i.x,i.y,i.z],[-i.x,i.y,i.z],[-i.x,-i.y,i.z],[-i.x,-i.y,-i.z],[i.x,-i.y,-i.z],[i.x,i.y,-i.z],[-i.x,i.y,-i.z],[i.x,-i.y,i.z]],o=0;o<r.length;o++)a.set(r[o][0],r[o][1],r[o][2]),e.vmult(a,a),t.vadd(a,a),n(a.x,a.y,a.z)};var h=[new r,new r,new r,new r,new r,new r,new r,new r];s.prototype.calculateWorldAABB=function(t,e,n,i){var r=this.halfExtents;h[0].set(r.x,r.y,r.z),h[1].set(-r.x,r.y,r.z),h[2].set(-r.x,-r.y,r.z),h[3].set(-r.x,-r.y,-r.z),h[4].set(r.x,-r.y,-r.z),h[5].set(r.x,r.y,-r.z),h[6].set(-r.x,r.y,-r.z),h[7].set(r.x,-r.y,r.z);var o=h[0];e.vmult(o,o),t.vadd(o,o),i.copy(o),n.copy(o);for(var s=1;s<8;s++){var o=h[s];e.vmult(o,o),t.vadd(o,o);var a=o.x,c=o.y,l=o.z;a>i.x&&(i.x=a),c>i.y&&(i.y=c),l>i.z&&(i.z=l),a<n.x&&(n.x=a),c<n.y&&(n.y=c),l<n.z&&(n.z=l)}}},{\"../math/Vec3\":30,\"./ConvexPolyhedron\":38,\"./Shape\":43}],38:[function(t,e,n){e.exports=s;var i=t(\"./Shape\"),r=t(\"../math/Vec3\"),o=(t(\"../math/Quaternion\"),t(\"../math/Transform\"));function s(t,e,n){i.call(this),this.type=i.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}s.prototype=new i,s.prototype.constructor=s;var a=new r;s.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var i=a,r=0;r!==t.length;r++)for(var o=t[r],s=o.length,h=0;h!==s;h++){var c=(h+1)%s;e[o[h]].vsub(e[o[c]],i),i.normalize();for(var l=!1,u=0;u!==n.length;u++)if(n[u].almostEquals(i)||n[u].almostEquals(i)){l=!0;break}l||n.push(i.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error(\"Vertex \"+this.faces[t][e]+\" not found!\");var n=this.faceNormals[t]||new r;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var i=this.vertices[this.faces[t][0]];if(n.dot(i)<0){console.error(\".faceNormals[\"+t+\"] = Vec3(\"+n.toString()+\") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.\");for(var e=0;e<this.faces[t].length;e++)console.warn(\".vertices[\"+this.faces[t][e]+\"] = Vec3(\"+this.vertices[this.faces[t][e]].toString()+\")\")}}};var h=new r,c=new r;s.computeNormal=function(t,e,n,i){e.vsub(t,c),n.vsub(e,h),h.cross(c,i),i.isZero()||i.normalize()},s.prototype.getFaceNormal=function(t,e){var n=this.faces[t],i=this.vertices[n[0]],r=this.vertices[n[1]],o=this.vertices[n[2]];return s.computeNormal(i,r,o,e)};var l=new r;s.prototype.clipAgainstHull=function(t,e,n,i,o,s,a,h,c){for(var u=l,p=-1,f=-Number.MAX_VALUE,d=0;d<n.faces.length;d++){u.copy(n.faceNormals[d]),o.vmult(u,u);var y=u.dot(s);y>f&&(f=y,p=d)}for(var v=[],m=n.faces[p],g=m.length,b=0;b<g;b++){var w=n.vertices[m[b]],x=new r;x.copy(w),o.vmult(x,x),i.vadd(x,x),v.push(x)}p>=0&&this.clipFaceAgainstHull(s,t,e,v,a,h,c)};var u=new r,p=new r,f=new r,d=new r,y=new r,v=new r;s.prototype.findSeparatingAxis=function(t,e,n,i,r,o,s,a){var h=u,c=p,l=f,m=d,g=y,b=v,w=Number.MAX_VALUE;if(this.uniqueAxes)for(var x=0;x!==this.uniqueAxes.length;x++){n.vmult(this.uniqueAxes[x],h);var E=this.testSepAxis(h,t,e,n,i,r);if(!1===E)return!1;E<w&&(w=E,o.copy(h))}else for(var C=s?s.length:this.faces.length,x=0;x<C;x++){var S=s?s[x]:x;h.copy(this.faceNormals[S]),n.vmult(h,h);var E=this.testSepAxis(h,t,e,n,i,r);if(!1===E)return!1;E<w&&(w=E,o.copy(h))}if(t.uniqueAxes)for(var x=0;x!==t.uniqueAxes.length;x++){r.vmult(t.uniqueAxes[x],c);var E=this.testSepAxis(c,t,e,n,i,r);if(!1===E)return!1;E<w&&(w=E,o.copy(c))}else for(var T=a?a.length:t.faces.length,x=0;x<T;x++){var S=a?a[x]:x;c.copy(t.faceNormals[S]),r.vmult(c,c);var E=this.testSepAxis(c,t,e,n,i,r);if(!1===E)return!1;E<w&&(w=E,o.copy(c))}for(var A=0;A!==this.uniqueEdges.length;A++){n.vmult(this.uniqueEdges[A],m);for(var B=0;B!==t.uniqueEdges.length;B++)if(r.vmult(t.uniqueEdges[B],g),m.cross(g,b),!b.almostZero()){b.normalize();var R=this.testSepAxis(b,t,e,n,i,r);if(!1===R)return!1;R<w&&(w=R,o.copy(b))}}return i.vsub(e,l),l.dot(o)>0&&o.negate(o),!0};var m=[],g=[];s.prototype.testSepAxis=function(t,e,n,i,r,o){s.project(this,t,n,i,m),s.project(e,t,r,o,g);var a=m[0],h=m[1],c=g[0],l=g[1];if(a<l||c<h)return!1;var u=a-l,p=c-h,f=u<p?u:p;return f};var b=new r,w=new r;s.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(b,w);var n=w.x-b.x,i=w.y-b.y,r=w.z-b.z;e.x=1/12*t*(2*i*2*i+2*r*2*r),e.y=1/12*t*(2*n*2*n+2*r*2*r),e.z=1/12*t*(2*i*2*i+2*n*2*n)},s.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],n=this.faceNormals[t],i=this.vertices[e[0]],r=-n.dot(i);return r};var x=new r,E=new r,C=new r,S=new r,T=new r,A=new r,B=new r,R=new r;s.prototype.clipFaceAgainstHull=function(t,e,n,i,r,o,s){for(var a=x,h=E,c=C,l=S,u=T,p=A,f=B,d=R,y=i,v=[],m=-1,g=Number.MAX_VALUE,b=0;b<this.faces.length;b++){a.copy(this.faceNormals[b]),n.vmult(a,a);var w=a.dot(t);w<g&&(g=w,m=b)}if(!(m<0)){var _=this.faces[m];_.connectedFaces=[];for(var P=0;P<this.faces.length;P++)for(var F=0;F<this.faces[P].length;F++)-1!==_.indexOf(this.faces[P][F])&&P!==m&&-1===_.connectedFaces.indexOf(P)&&_.connectedFaces.push(P);y.length;for(var I=_.length,k=0;k<I;k++){var M=this.vertices[_[k]],j=this.vertices[_[(k+1)%I]];M.vsub(j,h),c.copy(h),n.vmult(c,c),e.vadd(c,c),l.copy(this.faceNormals[m]),n.vmult(l,l),e.vadd(l,l),c.cross(l,u),u.negate(u),p.copy(M),n.vmult(p,p),e.vadd(p,p),p.dot(u);var N=_.connectedFaces[k];f.copy(this.faceNormals[N]);var O=this.getPlaneConstantOfFace(N);d.copy(f),n.vmult(d,d);var L=O-d.dot(e);for(this.clipFaceAgainstPlane(y,v,d,L);y.length;)y.shift();for(;v.length;)y.push(v.shift())}f.copy(this.faceNormals[m]);var O=this.getPlaneConstantOfFace(m);d.copy(f),n.vmult(d,d);for(var L=O-d.dot(e),P=0;P<y.length;P++){var q=d.dot(y[P])+L;if(q<=r&&(console.log(\"clamped: depth=\"+q+\" to minDist=\"+r),q=r),q<=o){var z=y[P];if(q<=0){var U={point:z,normal:d,depth:q};s.push(U)}}}}},s.prototype.clipFaceAgainstPlane=function(t,e,n,i){var o,s,a=t.length;if(a<2)return e;var h=t[t.length-1],c=t[0];o=n.dot(h)+i;for(var l=0;l<a;l++){if(c=t[l],s=n.dot(c)+i,o<0)if(s<0){var u=new r;u.copy(c),e.push(u)}else{var u=new r;h.lerp(c,o/(o-s),u),e.push(u)}else if(s<0){var u=new r;h.lerp(c,o/(o-s),u),e.push(u),e.push(c)}h=c,o=s}return e},s.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new r);for(var i=this.vertices,o=this.worldVertices,s=0;s!==n;s++)e.vmult(i[s],o[s]),t.vadd(o[s],o[s]);this.worldVerticesNeedsUpdate=!1},new r,s.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,i=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0;r<n;r++){var o=i[r];o.x<t.x?t.x=o.x:o.x>e.x&&(e.x=o.x),o.y<t.y?t.y=o.y:o.y>e.y&&(e.y=o.y),o.z<t.z?t.z=o.z:o.z>e.z&&(e.z=o.z)}},s.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new r);for(var n=this.faceNormals,i=this.worldFaceNormals,o=0;o!==e;o++)t.vmult(n[o],i[o]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,i=e.length;n!==i;n++){var r=e[n].norm2();r>t&&(t=r)}this.boundingSphereRadius=Math.sqrt(t)};var _=new r;s.prototype.calculateWorldAABB=function(t,e,n,i){for(var r,o,s,a,h,c,l=this.vertices.length,u=this.vertices,p=0;p<l;p++){_.copy(u[p]),e.vmult(_,_),t.vadd(_,_);var f=_;f.x<r||void 0===r?r=f.x:(f.x>a||void 0===a)&&(a=f.x),f.y<o||void 0===o?o=f.y:(f.y>h||void 0===h)&&(h=f.y),f.z<s||void 0===s?s=f.z:(f.z>c||void 0===c)&&(c=f.z)}n.set(r,o,s),i.set(a,h,c)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(t){t=t||new r;for(var e=this.vertices.length,n=this.vertices,i=0;i<e;i++)t.vadd(n[i],t);return t.mult(1/e,t),t},s.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,i=this.vertices;if(e){for(var r=0;r<n;r++){var o=i[r];e.vmult(o,o)}for(var r=0;r<this.faceNormals.length;r++){var o=this.faceNormals[r];e.vmult(o,o)}}if(t)for(var r=0;r<n;r++){var o=i[r];o.vadd(t,o)}};var P=new r,F=new r,I=new r;s.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,i=this.faces,r=this.faceNormals,o=this.faces.length,s=P;this.getAveragePointLocal(s);for(var a=0;a<o;a++){this.faces[a].length;var e=r[a],h=n[i[a][0]],c=F;t.vsub(h,c);var l=e.dot(c),u=I;s.vsub(h,u);var p=e.dot(u);if(l<0&&p>0||l>0&&p<0)return!1}return-1},new r;var k=new r,M=new r;s.project=function(t,e,n,i,r){var s=t.vertices.length,a=k,h=0,c=0,l=M,u=t.vertices;l.setZero(),o.vectorToLocalFrame(n,i,e,a),o.pointToLocalFrame(n,i,l,l);var p=l.dot(a);c=h=u[0].dot(a);for(var f=1;f<s;f++){var d=u[f].dot(a);d>h&&(h=d),d<c&&(c=d)}if((c-=p)>(h-=p)){var y=c;c=h,h=y}r[0]=h,r[1]=c}},{\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"./Shape\":43}],39:[function(t,e,n){e.exports=s;var i=t(\"./Shape\"),r=t(\"../math/Vec3\"),o=(t(\"../math/Quaternion\"),t(\"./ConvexPolyhedron\"));function s(t,e,n,s){var a=s,h=[],c=[],l=[],u=[],p=[],f=Math.cos,d=Math.sin;h.push(new r(e*f(0),e*d(0),.5*-n)),u.push(0),h.push(new r(t*f(0),t*d(0),.5*n)),p.push(1);for(var y=0;y<a;y++){var v=2*Math.PI/a*(y+1),m=2*Math.PI/a*(y+.5);y<a-1?(h.push(new r(e*f(v),e*d(v),.5*-n)),u.push(2*y+2),h.push(new r(t*f(v),t*d(v),.5*n)),p.push(2*y+3),l.push([2*y+2,2*y+3,2*y+1,2*y])):l.push([0,1,2*y+1,2*y]),(a%2==1||y<a/2)&&c.push(new r(f(m),d(m),0))}l.push(p),c.push(new r(0,0,1));for(var g=[],y=0;y<u.length;y++)g.push(u[u.length-y-1]);l.push(g),this.type=i.types.CONVEXPOLYHEDRON,o.call(this,h,l,c)}s.prototype=new o},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./ConvexPolyhedron\":38,\"./Shape\":43}],40:[function(t,e,n){var i=t(\"./Shape\"),r=t(\"./ConvexPolyhedron\"),o=t(\"../math/Vec3\"),s=t(\"../utils/Utils\");function a(t,e){e=s.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,i.call(this),this.pillarConvex=new r,this.pillarOffset=new o,this.type=i.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=a,a.prototype=new i,a.prototype.update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];r<e&&(e=r)}this.minValue=e},a.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var i=0;i!==t[n].length;i++){var r=t[n][i];r>e&&(e=r)}this.maxValue=e},a.prototype.setHeightValueAtIndex=function(t,e,n){var i=this.data;i[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},a.prototype.getRectMinMax=function(t,e,n,i,r){r=r||[];for(var o=this.data,s=this.minValue,a=t;a<=n;a++)for(var h=e;h<=i;h++){var c=o[a][h];c>s&&(s=c)}r[0]=this.minValue,r[1]=s},a.prototype.getIndexOfPosition=function(t,e,n,i){var r=this.elementSize,o=this.data,s=Math.floor(t/r),a=Math.floor(e/r);return n[0]=s,n[1]=a,i&&(s<0&&(s=0),a<0&&(a=0),s>=o.length-1&&(s=o.length-1),a>=o[0].length-1&&(a=o[0].length-1)),!(s<0||a<0||s>=o.length-1||a>=o[0].length-1)},a.prototype.getHeightAt=function(t,e,n){var i=[];this.getIndexOfPosition(t,e,i,n);var r=[];return this.getRectMinMax(i[0],i[1]+1,i[0],i[1]+1,r),(r[0]+r[1])/2},a.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+\"_\"+e+\"_\"+(n?1:0)},a.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.setCachedConvexTrianglePillar=function(t,e,n,i,r){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:i,offset:r}},a.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.getConvexTrianglePillar=function(t,e,n){var i=this.pillarConvex,s=this.pillarOffset;if(this.cacheEnabled){var a=this.getCachedConvexTrianglePillar(t,e,n);if(a)return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);i=new r,s=new o,this.pillarConvex=i,this.pillarOffset=s}var a=this.data,h=this.elementSize,c=i.faces;i.vertices.length=6;for(var l=0;l<6;l++)i.vertices[l]||(i.vertices[l]=new o);c.length=5;for(var l=0;l<5;l++)c[l]||(c[l]=[]);var u=i.vertices,p=(Math.min(a[t][e],a[t+1][e],a[t][e+1],a[t+1][e+1])-this.minValue)/2+this.minValue;n?(s.set((t+.75)*h,(e+.75)*h,p),u[0].set(.25*h,.25*h,a[t+1][e+1]-p),u[1].set(-.75*h,.25*h,a[t][e+1]-p),u[2].set(.25*h,-.75*h,a[t+1][e]-p),u[3].set(.25*h,.25*h,-p-1),u[4].set(-.75*h,.25*h,-p-1),u[5].set(.25*h,-.75*h,-p-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=2,c[2][1]=5,c[2][2]=3,c[2][3]=0,c[3][0]=3,c[3][1]=4,c[3][2]=1,c[3][3]=0,c[4][0]=1,c[4][1]=4,c[4][2]=5,c[4][3]=2):(s.set((t+.25)*h,(e+.25)*h,p),u[0].set(-.25*h,-.25*h,a[t][e]-p),u[1].set(.75*h,-.25*h,a[t+1][e]-p),u[2].set(-.25*h,.75*h,a[t][e+1]-p),u[3].set(-.25*h,-.25*h,-p-1),u[4].set(.75*h,-.25*h,-p-1),u[5].set(-.25*h,.75*h,-p-1),c[0][0]=0,c[0][1]=1,c[0][2]=2,c[1][0]=5,c[1][1]=4,c[1][2]=3,c[2][0]=0,c[2][1]=2,c[2][2]=5,c[2][3]=3,c[3][0]=1,c[3][1]=0,c[3][2]=3,c[3][3]=4,c[4][0]=4,c[4][1]=5,c[4][2]=2,c[4][3]=1),i.computeNormals(),i.computeEdges(),i.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,i,s)},a.prototype.calculateLocalInertia=function(t,e){return(e=e||new o).set(0,0,0),e},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(t,e,n,i){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new o(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{\"../math/Vec3\":30,\"../utils/Utils\":53,\"./ConvexPolyhedron\":38,\"./Shape\":43}],41:[function(t,e,n){e.exports=o;var i=t(\"./Shape\"),r=t(\"../math/Vec3\");function o(){i.call(this),this.type=i.types.PARTICLE}o.prototype=new i,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},o.prototype.volume=function(){return 0},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},o.prototype.calculateWorldAABB=function(t,e,n,i){n.copy(t),i.copy(t)}},{\"../math/Vec3\":30,\"./Shape\":43}],42:[function(t,e,n){e.exports=o;var i=t(\"./Shape\"),r=t(\"../math/Vec3\");function o(){i.call(this),this.type=i.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}o.prototype=new i,o.prototype.constructor=o,o.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},o.prototype.calculateLocalInertia=function(t,e){return e=e||new r},o.prototype.volume=function(){return Number.MAX_VALUE};var s=new r;o.prototype.calculateWorldAABB=function(t,e,n,i){s.set(0,0,1),e.vmult(s,s);var r=Number.MAX_VALUE;n.set(-r,-r,-r),i.set(r,r,r),1===s.x&&(i.x=t.x),1===s.y&&(i.y=t.y),1===s.z&&(i.z=t.z),-1===s.x&&(n.x=t.x),-1===s.y&&(n.y=t.y),-1===s.z&&(n.z=t.z)},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{\"../math/Vec3\":30,\"./Shape\":43}],43:[function(t,e,n){e.exports=i;var i=t(\"./Shape\");function i(){this.id=i.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t(\"../math/Vec3\"),t(\"../math/Quaternion\"),t(\"../material/Material\"),i.prototype.constructor=i,i.prototype.updateBoundingSphereRadius=function(){throw\"computeBoundingSphereRadius() not implemented for shape type \"+this.type},i.prototype.volume=function(){throw\"volume() not implemented for shape type \"+this.type},i.prototype.calculateLocalInertia=function(t,e){throw\"calculateLocalInertia() not implemented for shape type \"+this.type},i.idCounter=0,i.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./Shape\":43}],44:[function(t,e,n){e.exports=o;var i=t(\"./Shape\"),r=t(\"../math/Vec3\");function o(t){if(i.call(this),this.radius=void 0!==t?Number(t):1,this.type=i.types.SPHERE,this.radius<0)throw new Error(\"The sphere radius cannot be negative.\");this.updateBoundingSphereRadius()}o.prototype=new i,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(t,e){e=e||new r;var n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e},o.prototype.volume=function(){return 4*Math.PI*this.radius/3},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},o.prototype.calculateWorldAABB=function(t,e,n,i){for(var r=this.radius,o=[\"x\",\"y\",\"z\"],s=0;s<o.length;s++){var a=o[s];n[a]=t[a]-r,i[a]=t[a]+r}}},{\"../math/Vec3\":30,\"./Shape\":43}],45:[function(t,e,n){e.exports=h;var i=t(\"./Shape\"),r=t(\"../math/Vec3\"),o=(t(\"../math/Quaternion\"),t(\"../math/Transform\")),s=t(\"../collision/AABB\"),a=t(\"../utils/Octree\");function h(t,e){i.call(this),this.type=i.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new s,this.edges=null,this.scale=new r(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}h.prototype=new i,h.prototype.constructor=h;var c=new r;h.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new s,i=new r,o=new r,a=new r,h=[i,o,a],c=0;c<this.indices.length/3;c++){var l=3*c;this._getUnscaledVertex(this.indices[l],i),this._getUnscaledVertex(this.indices[l+1],o),this._getUnscaledVertex(this.indices[l+2],a),n.setFromPoints(h),t.insert(n,c)}t.removeEmptyNodes()};var l=new s;h.prototype.getTrianglesInAABB=function(t,e){l.copy(t);var n=this.scale,i=n.x,r=n.y,o=n.z,s=l.lowerBound,a=l.upperBound;return s.x/=i,s.y/=r,s.z/=o,a.x/=i,a.y/=r,a.z/=o,this.tree.aabbQuery(l,e)},h.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},h.prototype.updateNormals=function(){for(var t=c,e=this.normals,n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],o=this.indices[i+1],s=this.indices[i+2];this.getVertex(r,y),this.getVertex(o,v),this.getVertex(s,m),h.computeNormal(v,y,m,t),e[i]=t.x,e[i+1]=t.y,e[i+2]=t.z}},h.prototype.updateEdges=function(){for(var t={},e=function(e,n){var i=r<o?r+\"_\"+o:o+\"_\"+r;t[i]=!0},n=0;n<this.indices.length/3;n++){var i=3*n,r=this.indices[i],o=this.indices[i+1];this.indices[i+2];e(),e(),e()}var s=Object.keys(t);this.edges=new Int16Array(2*s.length);for(var n=0;n<s.length;n++){var a=s[n].split(\"_\");this.edges[2*n]=parseInt(a[0],10),this.edges[2*n+1]=parseInt(a[1],10)}},h.prototype.getEdgeVertex=function(t,e,n){var i=this.edges[2*t+(e?1:0)];this.getVertex(i,n)};var u=new r,p=new r;h.prototype.getEdgeVector=function(t,e){var n=u,i=p;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,i),i.vsub(n,e)};var f=new r,d=new r;h.computeNormal=function(t,e,n,i){e.vsub(t,d),n.vsub(e,f),f.cross(d,i),i.isZero()||i.normalize()};var y=new r,v=new r,m=new r;h.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},h.prototype._getUnscaledVertex=function(t,e){var n=3*t,i=this.vertices;return e.set(i[n],i[n+1],i[n+2])},h.prototype.getWorldVertex=function(t,e,n,i){return this.getVertex(t,i),o.pointToWorldFrame(e,n,i,i),i},h.prototype.getTriangleVertices=function(t,e,n,i){var r=3*t;this.getVertex(this.indices[r],e),this.getVertex(this.indices[r+1],n),this.getVertex(this.indices[r+2],i)},h.prototype.getNormal=function(t,e){var n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var g=new s;h.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(g);var n=g.upperBound.x-g.lowerBound.x,i=g.upperBound.y-g.lowerBound.y,r=g.upperBound.z-g.lowerBound.z;return e.set(1/12*t*(2*i*2*i+2*r*2*r),1/12*t*(2*n*2*n+2*r*2*r),1/12*t*(2*i*2*i+2*n*2*n))};var b=new r;h.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,i=this.vertices.length,r=(this.vertices,b);this.getVertex(0,r),e.copy(r),n.copy(r);for(var o=0;o!==i;o++)this.getVertex(o,r),r.x<e.x?e.x=r.x:r.x>n.x&&(n.x=r.x),r.y<e.y?e.y=r.y:r.y>n.y&&(n.y=r.y),r.z<e.z?e.z=r.z:r.z>n.z&&(n.z=r.z)},h.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},h.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new r,i=0,o=e.length/3;i!==o;i++){this.getVertex(i,n);var s=n.norm2();s>t&&(t=s)}this.boundingSphereRadius=Math.sqrt(t)},new r;var w=new o,x=new s;h.prototype.calculateWorldAABB=function(t,e,n,i){var r=w,o=x;r.position=t,r.quaternion=e,this.aabb.toWorldFrame(r,o),n.copy(o.lowerBound),i.copy(o.upperBound)},h.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},h.createTorus=function(t,e,n,i,r){t=t||1,e=e||.5,n=n||8,i=i||6,r=r||2*Math.PI;for(var o=[],s=[],a=0;a<=n;a++)for(var c=0;c<=i;c++){var l=c/i*r,u=a/n*Math.PI*2,p=(t+e*Math.cos(u))*Math.cos(l),f=(t+e*Math.cos(u))*Math.sin(l),d=e*Math.sin(u);o.push(p,f,d)}for(var a=1;a<=n;a++)for(var c=1;c<=i;c++){var y=(i+1)*a+c-1,v=(i+1)*(a-1)+c-1,m=(i+1)*(a-1)+c,g=(i+1)*a+c;s.push(y,v,g),s.push(v,m,g)}return new h(o,s)}},{\"../collision/AABB\":3,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../utils/Octree\":50,\"./Shape\":43}],46:[function(t,e,n){e.exports=r,t(\"../math/Vec3\"),t(\"../math/Quaternion\");var i=t(\"./Solver\");function r(){i.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new i;var o=[],s=[],a=[];r.prototype.solve=function(t,e){var n,i,r,h,c,l,u=0,p=this.iterations,f=this.tolerance*this.tolerance,d=this.equations,y=d.length,v=e.bodies,m=v.length,g=t;if(0!==y)for(var b=0;b!==m;b++)v[b].updateSolveMassProperties();var w=s,x=a,E=o;w.length=y,x.length=y,E.length=y;for(var b=0;b!==y;b++){var C=d[b];E[b]=0,x[b]=C.computeB(g),w[b]=1/C.computeC()}if(0!==y){for(var b=0;b!==m;b++){var S=v[b],T=S.vlambda,A=S.wlambda;T.set(0,0,0),A&&A.set(0,0,0)}for(u=0;u!==p;u++){h=0;for(var B=0;B!==y;B++){var C=d[B];n=x[B],i=w[B],l=E[B],c=C.computeGWlambda(),r=i*(n-c-C.eps*l),l+r<C.minForce?r=C.minForce-l:l+r>C.maxForce&&(r=C.maxForce-l),E[B]+=r,h+=r>0?r:-r,C.addToWlambda(r)}if(h*h<f)break}for(var b=0;b!==m;b++){var S=v[b],R=S.velocity,_=S.angularVelocity;R.vadd(S.vlambda,R),_&&_.vadd(S.wlambda,_)}}return u}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"./Solver\":47}],47:[function(t,e,n){function i(){this.equations=[]}e.exports=i,i.prototype.solve=function(t,e){return 0},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.removeEquation=function(t){var e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)},i.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=o,t(\"../math/Vec3\"),t(\"../math/Quaternion\");var i=t(\"./Solver\"),r=t(\"../objects/Body\");function o(t){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}o.prototype=new i;var s=[],a=[],h={bodies:[]},c=r.STATIC;function l(t){for(var e=t.length,n=0;n!==e;n++){var i=t[n];if(!(i.visited||i.body.type&c))return i}return!1}var u=[];function p(t,e,n,i){for(u.push(t),t.visited=!0,e(t,n,i);u.length;)for(var r,o=u.pop();r=l(o.children);)r.visited=!0,e(r,n,i),u.push(r)}function f(t,e,n){e.push(t.body);for(var i=t.eqs.length,r=0;r!==i;r++){var o=t.eqs[r];-1===n.indexOf(o)&&n.push(o)}}function d(t,e){return e.id-t.id}o.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},o.prototype.solve=function(t,e){for(var n=s,i=this.nodePool,r=e.bodies,o=this.equations,c=o.length,u=r.length,y=this.subsolver;i.length<u;)i.push(this.createNode());n.length=u;for(var v=0;v<u;v++)n[v]=i[v];for(var v=0;v!==u;v++){var m=n[v];m.body=r[v],m.children.length=0,m.eqs.length=0,m.visited=!1}for(var g=0;g!==c;g++){var b=o[g],v=r.indexOf(b.bi),w=r.indexOf(b.bj),x=n[v],E=n[w];x.children.push(E),x.eqs.push(b),E.children.push(x),E.eqs.push(b)}var C,S=0,T=a;y.tolerance=this.tolerance,y.iterations=this.iterations;for(var A=h;C=l(n);){T.length=0,A.bodies.length=0,p(C,f,A.bodies,T);var B=T.length;T=T.sort(d);for(var v=0;v!==B;v++)y.addEquation(T[v]);y.solve(t,A),y.removeAllEquations(),S++}return S}},{\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"./Solver\":47}],49:[function(t,e,n){var i=function(){};e.exports=i,i.prototype={constructor:i,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;var i=n[t].indexOf(e);return-1!==i&&n[t].splice(i,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;for(var i=0,r=n.length;i<r;i++)n[i].call(this,t)}return this}}},{}],50:[function(t,e,n){var i=t(\"../collision/AABB\"),r=t(\"../math/Vec3\");function o(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new i,this.data=[],this.children=[]}function s(t,e){(e=e||{}).root=null,e.aabb=t,o.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=s,s.prototype=new o,o.prototype.reset=function(t,e){this.children.length=this.data.length=0},o.prototype.insert=function(t,e,n){var i=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var r=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var o=!1;r.length||(this.subdivide(),o=!0);for(var s=0;8!==s;s++)if(r[s].insert(t,e,n+1))return!0;o&&(r.length=0)}return i.push(e),!0};var a=new r;o.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,n=t.upperBound,s=this.children;s.push(new o({aabb:new i({lowerBound:new r(0,0,0)})}),new o({aabb:new i({lowerBound:new r(1,0,0)})}),new o({aabb:new i({lowerBound:new r(1,1,0)})}),new o({aabb:new i({lowerBound:new r(1,1,1)})}),new o({aabb:new i({lowerBound:new r(0,1,1)})}),new o({aabb:new i({lowerBound:new r(0,0,1)})}),new o({aabb:new i({lowerBound:new r(1,0,1)})}),new o({aabb:new i({lowerBound:new r(0,1,0)})})),n.vsub(e,a),a.scale(.5,a);for(var h=this.root||this,c=0;8!==c;c++){var l=s[c];l.root=h;var u=l.aabb.lowerBound;u.x*=a.x,u.y*=a.y,u.z*=a.z,u.vadd(e,u),u.vadd(a,l.aabb.upperBound)}},o.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var i=n.pop();i.aabb.overlaps(t)&&Array.prototype.push.apply(e,i.data),Array.prototype.push.apply(n,i.children)}return e};var h=new i;o.prototype.rayQuery=function(t,e,n){return t.getAABB(h),h.toLocalFrame(e,h),this.aabbQuery(h,n),n},o.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;n>=0;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{\"../collision/AABB\":3,\"../math/Vec3\":30}],51:[function(t,e,n){function i(){this.objects=[],this.type=Object}e.exports=i,i.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},i.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},i.prototype.constructObject=function(){throw new Error(\"constructObject() not implemented in this Pool subclass yet!\")}},{}],52:[function(t,e,n){function i(){this.data={keys:[]}}e.exports=i,i.prototype.get=function(t,e){if(t>e){var n=e;e=t,t=n}return this.data[t+\"-\"+e]},i.prototype.set=function(t,e,n){if(t>e){var i=e;e=t,t=i}var r=t+\"-\"+e;this.get(t,e)||this.data.keys.push(r),this.data[r]=n},i.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;){var n=e.pop();delete t[n]}}},{}],53:[function(t,e,n){function i(){}e.exports=i,i.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=o;var i=t(\"../math/Vec3\"),r=t(\"./Pool\");function o(){r.call(this),this.type=i}o.prototype=new r,o.prototype.constructObject=function(){return new i}},{\"../math/Vec3\":30,\"./Pool\":51}],55:[function(t,e,n){e.exports=p;var i=t(\"../collision/AABB\"),r=t(\"../shapes/Shape\"),o=t(\"../collision/Ray\"),s=t(\"../math/Vec3\"),a=t(\"../math/Transform\"),h=(t(\"../shapes/ConvexPolyhedron\"),t(\"../math/Quaternion\")),c=(t(\"../solver/Solver\"),t(\"../utils/Vec3Pool\")),l=t(\"../equations/ContactEquation\"),u=t(\"../equations/FrictionEquation\");function p(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(t,e,n,i,r,o){var s;this.contactPointPool.length?((s=this.contactPointPool.pop()).bi=t,s.bj=e):s=new l(t,e),s.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&i.collisionResponse;var a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var h=n.material||t.material,c=i.material||e.material;return h&&c&&h.restitution>=0&&c.restitution>=0&&(s.restitution=h.restitution*c.restitution),s.si=r||n,s.sj=o||i,s},p.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,i=t.bj,r=t.si,o=t.sj,s=this.world,a=this.currentContactMaterial,h=a.friction,c=r.material||n.material,l=o.material||i.material;if(c&&l&&c.friction>=0&&l.friction>=0&&(h=c.friction*l.friction),h>0){var p=h*s.gravity.length(),f=n.invMass+i.invMass;f>0&&(f=1/f);var d=this.frictionEquationPool,y=d.length?d.pop():new u(n,i,p*f),v=d.length?d.pop():new u(n,i,p*f);return y.bi=v.bi=n,y.bj=v.bj=i,y.minForce=v.minForce=-p*f,y.maxForce=v.maxForce=p*f,y.ri.copy(t.ri),y.rj.copy(t.rj),v.ri.copy(t.ri),v.rj.copy(t.rj),t.ni.tangents(y.t,v.t),y.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),v.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),y.enabled=v.enabled=t.enabled,e.push(y,v),!0}return!1};var f=new s,d=new s,y=new s;p.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],i=this.frictionResult[this.frictionResult.length-1];f.setZero(),d.setZero(),y.setZero();for(var r=e.bi,o=(e.bj,0);o!==t;o++)(e=this.result[this.result.length-1-o]).bodyA!==r?(f.vadd(e.ni,f),d.vadd(e.ri,d),y.vadd(e.rj,y)):(f.vsub(e.ni,f),d.vadd(e.rj,d),y.vadd(e.ri,y));var s=1/t;d.scale(s,n.ri),y.scale(s,n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj),f.normalize(),f.tangents(n.t,i.t)}};var v=new s,m=new s,g=new h,b=new h;p.prototype.getContacts=function(t,e,n,i,r,o,s){this.contactPointPool=r,this.frictionEquationPool=s,this.result=i,this.frictionResult=o;for(var a=g,h=b,c=v,l=m,u=0,p=t.length;u!==p;u++){var f=t[u],d=e[u],y=null;f.material&&d.material&&(y=n.getContactMaterial(f.material,d.material)||null);for(var w=0;w<f.shapes.length;w++){f.quaternion.mult(f.shapeOrientations[w],a),f.quaternion.vmult(f.shapeOffsets[w],c),c.vadd(f.position,c);for(var x=f.shapes[w],E=0;E<d.shapes.length;E++){d.quaternion.mult(d.shapeOrientations[E],h),d.quaternion.vmult(d.shapeOffsets[E],l),l.vadd(d.position,l);var C=d.shapes[E];if(!(c.distanceTo(l)>x.boundingSphereRadius+C.boundingSphereRadius)){var S=null;x.material&&C.material&&(S=n.getContactMaterial(x.material,C.material)||null),this.currentContactMaterial=S||y||n.defaultContactMaterial;var T=this[x.type|C.type];T&&(x.type<C.type?T.call(this,x,C,c,l,a,h,f,d,x,C):T.call(this,C,x,l,c,h,a,d,f,x,C))}}}}},p.prototype[r.types.BOX|r.types.BOX]=p.prototype.boxBox=function(t,e,n,i,r,o,s,a){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,i,r,o,s,a,t,e)},p.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(t,e,n,i,r,o,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,i,r,o,s,a,t,e)},p.prototype[r.types.BOX|r.types.PARTICLE]=p.prototype.boxParticle=function(t,e,n,i,r,o,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,i,r,o,s,a,t,e)},p.prototype[r.types.SPHERE]=p.prototype.sphereSphere=function(t,e,n,i,r,o,s,a){var h=this.createContactEquation(s,a,t,e);i.vsub(n,h.ni),h.ni.normalize(),h.ri.copy(h.ni),h.rj.copy(h.ni),h.ri.mult(t.radius,h.ri),h.rj.mult(-e.radius,h.rj),h.ri.vadd(n,h.ri),h.ri.vsub(s.position,h.ri),h.rj.vadd(i,h.rj),h.rj.vsub(a.position,h.rj),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)};var w=new s,x=new s,E=new s;p.prototype[r.types.PLANE|r.types.TRIMESH]=p.prototype.planeTrimesh=function(t,e,n,i,r,o,h,c){var l=new s,u=w;u.set(0,0,1),r.vmult(u,u);for(var p=0;p<e.vertices.length/3;p++){e.getVertex(p,l);var f=new s;f.copy(l),a.pointToWorldFrame(i,o,f,l);var d=x;l.vsub(n,d);var y=u.dot(d);if(y<=0){var v=this.createContactEquation(h,c,t,e);v.ni.copy(u);var m=E;u.scale(d.dot(u),m),l.vsub(m,m),v.ri.copy(m),v.ri.vsub(h.position,v.ri),v.rj.copy(l),v.rj.vsub(c.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var C=new s,S=new s,T=(new s,new s),A=new s,B=new s,R=new s,_=new s,P=new s,F=new s,I=new s,k=new s,M=new s,j=new s,N=new i,O=[];p.prototype[r.types.SPHERE|r.types.TRIMESH]=p.prototype.sphereTrimesh=function(t,e,n,i,r,s,h,c){var l=B,u=R,p=_,f=P,d=F,y=I,v=N,m=A,g=S,b=O;a.pointToLocalFrame(i,s,n,d);var w=t.radius;v.lowerBound.set(d.x-w,d.y-w,d.z-w),v.upperBound.set(d.x+w,d.y+w,d.z+w),e.getTrianglesInAABB(v,b);for(var x=T,E=t.radius*t.radius,L=0;L<b.length;L++)for(var q=0;q<3;q++)if(e.getVertex(e.indices[3*b[L]+q],x),x.vsub(d,g),g.norm2()<=E){m.copy(x),a.pointToWorldFrame(i,s,m,x),x.vsub(n,g);var z=this.createContactEquation(h,c,t,e);z.ni.copy(g),z.ni.normalize(),z.ri.copy(z.ni),z.ri.scale(t.radius,z.ri),z.ri.vadd(n,z.ri),z.ri.vsub(h.position,z.ri),z.rj.copy(x),z.rj.vsub(c.position,z.rj),this.result.push(z),this.createFrictionEquationsFromContact(z,this.frictionResult)}for(var L=0;L<b.length;L++)for(var q=0;q<3;q++){e.getVertex(e.indices[3*b[L]+q],l),e.getVertex(e.indices[3*b[L]+(q+1)%3],u),u.vsub(l,p),d.vsub(u,y);var U=y.dot(p);d.vsub(l,y);var D=y.dot(p);if(D>0&&U<0){d.vsub(l,y),f.copy(p),f.normalize(),D=y.dot(f),f.scale(D,y),y.vadd(l,y);var W=y.distanceTo(d);if(W<t.radius){var z=this.createContactEquation(h,c,t,e);y.vsub(d,z.ni),z.ni.normalize(),z.ni.scale(t.radius,z.ri),a.pointToWorldFrame(i,s,y,y),y.vsub(c.position,z.rj),a.vectorToWorldFrame(s,z.ni,z.ni),a.vectorToWorldFrame(s,z.ri,z.ri),this.result.push(z),this.createFrictionEquationsFromContact(z,this.frictionResult)}}}for(var V=k,Y=M,H=j,X=C,L=0,$=b.length;L!==$;L++){e.getTriangleVertices(b[L],V,Y,H),e.getNormal(b[L],X),d.vsub(V,y);var W=y.dot(X);if(X.scale(W,y),d.vsub(y,y),W=y.distanceTo(d),o.pointInTriangle(y,V,Y,H)&&W<t.radius){var z=this.createContactEquation(h,c,t,e);y.vsub(d,z.ni),z.ni.normalize(),z.ni.scale(t.radius,z.ri),a.pointToWorldFrame(i,s,y,y),y.vsub(c.position,z.rj),a.vectorToWorldFrame(s,z.ni,z.ni),a.vectorToWorldFrame(s,z.ri,z.ri),this.result.push(z),this.createFrictionEquationsFromContact(z,this.frictionResult)}}b.length=0};var L=new s,q=new s;p.prototype[r.types.SPHERE|r.types.PLANE]=p.prototype.spherePlane=function(t,e,n,i,r,o,s,a){var h=this.createContactEquation(s,a,t,e);if(h.ni.set(0,0,1),o.vmult(h.ni,h.ni),h.ni.negate(h.ni),h.ni.normalize(),h.ni.mult(t.radius,h.ri),n.vsub(i,L),h.ni.mult(h.ni.dot(L),q),L.vsub(q,h.rj),-L.dot(h.ni)<=t.radius){var c=h.ri,l=h.rj;c.vadd(n,c),c.vsub(s.position,c),l.vadd(i,l),l.vsub(a.position,l),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}};var z=new s,U=new s,D=new s;function W(t,e,n){for(var i=null,r=t.length,o=0;o!==r;o++){var s=t[o],a=z;t[(o+1)%r].vsub(s,a);var h=U;a.cross(e,h);var c=D;n.vsub(s,c);var l=h.dot(c);if(!(null===i||l>0&&!0===i||l<=0&&!1===i))return!1;null===i&&(i=l>0)}return!0}var V=new s,Y=new s,H=new s,X=new s,$=[new s,new s,new s,new s,new s,new s],G=new s,Q=new s,Z=new s,K=new s;p.prototype[r.types.SPHERE|r.types.BOX]=p.prototype.sphereBox=function(t,e,n,i,r,o,s,a){var h=this.v3pool,c=$;n.vsub(i,V),e.getSideNormals(c,o);for(var l=t.radius,u=!1,p=Q,f=Z,d=K,y=null,v=0,m=0,g=0,b=null,w=0,x=c.length;w!==x&&!1===u;w++){var E=Y;E.copy(c[w]);var C=E.norm();E.normalize();var S=V.dot(E);if(S<C+l&&S>0){var T=H,A=X;T.copy(c[(w+1)%3]),A.copy(c[(w+2)%3]);var B=T.norm(),R=A.norm();T.normalize(),A.normalize();var _=V.dot(T),P=V.dot(A);if(_<B&&_>-B&&P<R&&P>-R){var F=Math.abs(S-C-l);(null===b||F<b)&&(b=F,m=_,g=P,y=C,p.copy(E),f.copy(T),d.copy(A),v++)}}}if(v){u=!0;var I=this.createContactEquation(s,a,t,e);p.mult(-l,I.ri),I.ni.copy(p),I.ni.negate(I.ni),p.mult(y,p),f.mult(m,f),p.vadd(f,p),d.mult(g,d),p.vadd(d,I.rj),I.ri.vadd(n,I.ri),I.ri.vsub(s.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}for(var k=h.get(),M=G,j=0;2!==j&&!u;j++)for(var N=0;2!==N&&!u;N++)for(var O=0;2!==O&&!u;O++)if(k.set(0,0,0),j?k.vadd(c[0],k):k.vsub(c[0],k),N?k.vadd(c[1],k):k.vsub(c[1],k),O?k.vadd(c[2],k):k.vsub(c[2],k),i.vadd(k,M),M.vsub(n,M),M.norm2()<l*l){u=!0;var I=this.createContactEquation(s,a,t,e);I.ri.copy(M),I.ri.normalize(),I.ni.copy(I.ri),I.ri.mult(l,I.ri),I.rj.copy(k),I.ri.vadd(n,I.ri),I.ri.vsub(s.position,I.ri),I.rj.vadd(i,I.rj),I.rj.vsub(a.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}h.release(k),k=null;for(var L=h.get(),q=h.get(),I=h.get(),z=h.get(),F=h.get(),U=c.length,j=0;j!==U&&!u;j++)for(var N=0;N!==U&&!u;N++)if(j%3!=N%3){c[N].cross(c[j],L),L.normalize(),c[j].vadd(c[N],q),I.copy(n),I.vsub(q,I),I.vsub(i,I);var D=I.dot(L);L.mult(D,z);for(var O=0;O===j%3||O===N%3;)O++;F.copy(n),F.vsub(z,F),F.vsub(q,F),F.vsub(i,F);var W=Math.abs(D),J=F.norm();if(W<c[O].norm()&&J<l){u=!0;var tt=this.createContactEquation(s,a,t,e);q.vadd(z,tt.rj),tt.rj.copy(tt.rj),F.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(i,tt.ri),tt.ri.vsub(n,tt.ri),tt.ri.normalize(),tt.ri.mult(l,tt.ri),tt.ri.vadd(n,tt.ri),tt.ri.vsub(s.position,tt.ri),tt.rj.vadd(i,tt.rj),tt.rj.vsub(a.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}h.release(L,q,I,z,F)};var J=new s,tt=new s,et=new s,nt=new s,it=new s,rt=new s,ot=new s,st=new s,at=new s,ht=new s;p.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(t,e,n,i,r,o,s,a){var h=this.v3pool;n.vsub(i,J);for(var c=e.faceNormals,l=e.faces,u=e.vertices,p=t.radius,f=0;f!==u.length;f++){var d=u[f],y=it;o.vmult(d,y),i.vadd(y,y);var v=nt;if(y.vsub(n,v),v.norm2()<p*p){g=!0;var m=this.createContactEquation(s,a,t,e);return m.ri.copy(v),m.ri.normalize(),m.ni.copy(m.ri),m.ri.mult(p,m.ri),y.vsub(i,m.rj),m.ri.vadd(n,m.ri),m.ri.vsub(s.position,m.ri),m.rj.vadd(i,m.rj),m.rj.vsub(a.position,m.rj),this.result.push(m),void this.createFrictionEquationsFromContact(m,this.frictionResult)}}for(var g=!1,f=0,b=l.length;f!==b&&!1===g;f++){var w=c[f],x=l[f],E=rt;o.vmult(w,E);var C=ot;o.vmult(u[x[0]],C),C.vadd(i,C);var S=st;E.mult(-p,S),n.vadd(S,S);var T=at;S.vsub(C,T);var A=T.dot(E),B=ht;if(n.vsub(C,B),A<0&&B.dot(E)>0){for(var R=[],_=0,P=x.length;_!==P;_++){var F=h.get();o.vmult(u[x[_]],F),i.vadd(F,F),R.push(F)}if(W(R,E,n)){g=!0;var m=this.createContactEquation(s,a,t,e);E.mult(-p,m.ri),E.negate(m.ni);var I=h.get();E.mult(-A,I);var k=h.get();E.mult(-p,k),n.vsub(i,m.rj),m.rj.vadd(k,m.rj),m.rj.vadd(I,m.rj),m.rj.vadd(i,m.rj),m.rj.vsub(a.position,m.rj),m.ri.vadd(n,m.ri),m.ri.vsub(s.position,m.ri),h.release(I),h.release(k),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult);for(var _=0,M=R.length;_!==M;_++)h.release(R[_]);return}for(var _=0;_!==x.length;_++){var j=h.get(),N=h.get();o.vmult(u[x[(_+1)%x.length]],j),o.vmult(u[x[(_+2)%x.length]],N),i.vadd(j,j),i.vadd(N,N);var O=tt;N.vsub(j,O);var L=et;O.unit(L);var q=h.get(),z=h.get();n.vsub(j,z);var U=z.dot(L);L.mult(U,q),q.vadd(j,q);var D=h.get();if(q.vsub(n,D),U>0&&U*U<O.norm2()&&D.norm2()<p*p){var m=this.createContactEquation(s,a,t,e);q.vsub(i,m.rj),q.vsub(n,m.ni),m.ni.normalize(),m.ni.mult(p,m.ri),m.rj.vadd(i,m.rj),m.rj.vsub(a.position,m.rj),m.ri.vadd(n,m.ri),m.ri.vsub(s.position,m.ri),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult);for(var _=0,M=R.length;_!==M;_++)h.release(R[_]);return h.release(j),h.release(N),h.release(q),h.release(D),void h.release(z)}h.release(j),h.release(N),h.release(q),h.release(D),h.release(z)}for(var _=0,M=R.length;_!==M;_++)h.release(R[_])}}},new s,new s,p.prototype[r.types.PLANE|r.types.BOX]=p.prototype.planeBox=function(t,e,n,i,r,o,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,i,r,o,s,a)};var ct=new s,lt=new s,ut=new s,pt=new s;p.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(t,e,n,i,r,o,s,a){var h=ct,c=lt;c.set(0,0,1),r.vmult(c,c);for(var l=0,u=ut,p=0;p!==e.vertices.length;p++){h.copy(e.vertices[p]),o.vmult(h,h),i.vadd(h,h),h.vsub(n,u);var f=c.dot(u);if(f<=0){var d=this.createContactEquation(s,a,t,e),y=pt;c.mult(c.dot(u),y),h.vsub(y,y),y.vsub(n,d.ri),d.ni.copy(c),h.vsub(i,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(s.position,d.ri),d.rj.vadd(i,d.rj),d.rj.vsub(a.position,d.rj),this.result.push(d),l++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}}this.enableFrictionReduction&&l&&this.createFrictionFromAverage(l)};var ft=new s,dt=new s;p.prototype[r.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(t,e,n,i,r,o,s,a,h,c,l,u){var p=ft;if(!(n.distanceTo(i)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,r,i,o,p,l,u)){var f=[],d=dt;t.clipAgainstHull(n,r,e,i,o,p,-100,100,f);for(var y=0,v=0;v!==f.length;v++){var m=this.createContactEquation(s,a,t,e,h,c),g=m.ri,b=m.rj;p.negate(m.ni),f[v].normal.negate(d),d.mult(f[v].depth,d),f[v].point.vadd(d,g),b.copy(f[v].point),g.vsub(n,g),b.vsub(i,b),g.vadd(n,g),g.vsub(s.position,g),b.vadd(i,b),b.vsub(a.position,b),this.result.push(m),y++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}this.enableFrictionReduction&&y&&this.createFrictionFromAverage(y)}};var yt=new s,vt=new s,mt=new s;p.prototype[r.types.PLANE|r.types.PARTICLE]=p.prototype.planeParticle=function(t,e,n,i,r,o,s,a){var h=yt;h.set(0,0,1),s.quaternion.vmult(h,h);var c=vt;i.vsub(s.position,c);var l=h.dot(c);if(l<=0){var u=this.createContactEquation(a,s,e,t);u.ni.copy(h),u.ni.negate(u.ni),u.ri.set(0,0,0);var p=mt;h.mult(h.dot(i),p),i.vsub(p,p),u.rj.copy(p),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var gt=new s;p.prototype[r.types.PARTICLE|r.types.SPHERE]=p.prototype.sphereParticle=function(t,e,n,i,r,o,s,a){var h=gt;h.set(0,0,1),i.vsub(n,h);var c=h.norm2();if(c<=t.radius*t.radius){var l=this.createContactEquation(a,s,e,t);h.normalize(),l.rj.copy(h),l.rj.mult(t.radius,l.rj),l.ni.copy(h),l.ni.negate(l.ni),l.ri.set(0,0,0),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var bt=new h,wt=new s,xt=(new s,new s),Et=new s,Ct=new s;p.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(t,e,n,i,r,o,s,a){var h=-1,c=xt,l=Ct,u=null,p=wt;if(p.copy(i),p.vsub(n,p),r.conjugate(bt),bt.vmult(p,p),t.pointIsInside(p)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,r),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(r);for(var f=0,d=t.faces.length;f!==d;f++){var y=[t.worldVertices[t.faces[f][0]]],v=t.worldFaceNormals[f];i.vsub(y[0],Et);var m=-v.dot(Et);(null===u||Math.abs(m)<Math.abs(u))&&(u=m,h=f,c.copy(v))}if(-1!==h){var g=this.createContactEquation(a,s,e,t);c.mult(u,l),l.vadd(i,l),l.vsub(n,l),g.rj.copy(l),c.negate(g.ni),g.ri.set(0,0,0);var b=g.ri,w=g.rj;b.vadd(i,b),b.vsub(a.position,b),w.vadd(n,w),w.vsub(s.position,w),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}else console.warn(\"Point found inside convex, but did not find penetrating face!\")}},p.prototype[r.types.BOX|r.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(t,e,n,i,r,o,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,i,r,o,s,a)};var St=new s,Tt=new s,At=[0];p.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(t,e,n,i,r,o,s,h){var c=e.data,l=e.elementSize,u=t.boundingSphereRadius,p=Tt,f=At,d=St;a.pointToLocalFrame(i,o,n,d);var y=Math.floor((d.x-u)/l)-1,v=Math.ceil((d.x+u)/l)+1,m=Math.floor((d.y-u)/l)-1,g=Math.ceil((d.y+u)/l)+1;if(!(v<0||g<0||y>c.length||m>c[0].length)){y<0&&(y=0),v<0&&(v=0),m<0&&(m=0),g<0&&(g=0),y>=c.length&&(y=c.length-1),v>=c.length&&(v=c.length-1),g>=c[0].length&&(g=c[0].length-1),m>=c[0].length&&(m=c[0].length-1);var b=[];e.getRectMinMax(y,m,v,g,b);var w=b[0],x=b[1];if(!(d.z-u>x||d.z+u<w))for(var E=y;E<v;E++)for(var C=m;C<g;C++)e.getConvexTrianglePillar(E,C,!1),a.pointToWorldFrame(i,o,e.pillarOffset,p),n.distanceTo(p)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,p,r,o,s,h,null,null,f,null),e.getConvexTrianglePillar(E,C,!0),a.pointToWorldFrame(i,o,e.pillarOffset,p),n.distanceTo(p)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,p,r,o,s,h,null,null,f,null)}};var Bt=new s,Rt=new s;p.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(t,e,n,i,r,o,s,h){var c=e.data,l=t.radius,u=e.elementSize,p=Rt,f=Bt;a.pointToLocalFrame(i,o,n,f);var d=Math.floor((f.x-l)/u)-1,y=Math.ceil((f.x+l)/u)+1,v=Math.floor((f.y-l)/u)-1,m=Math.ceil((f.y+l)/u)+1;if(!(y<0||m<0||d>c.length||m>c[0].length)){d<0&&(d=0),y<0&&(y=0),v<0&&(v=0),m<0&&(m=0),d>=c.length&&(d=c.length-1),y>=c.length&&(y=c.length-1),m>=c[0].length&&(m=c[0].length-1),v>=c[0].length&&(v=c[0].length-1);var g=[];e.getRectMinMax(d,v,y,m,g);var b=g[0],w=g[1];if(!(f.z-l>w||f.z+l<b))for(var x=this.result,E=d;E<y;E++)for(var C=v;C<m;C++){var S=x.length;e.getConvexTrianglePillar(E,C,!1),a.pointToWorldFrame(i,o,e.pillarOffset,p),n.distanceTo(p)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,p,r,o,s,h),e.getConvexTrianglePillar(E,C,!0),a.pointToWorldFrame(i,o,e.pillarOffset,p),n.distanceTo(p)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,p,r,o,s,h);var T=x.length-S;if(T>2)return}}}},{\"../collision/AABB\":3,\"../collision/Ray\":9,\"../equations/ContactEquation\":19,\"../equations/FrictionEquation\":21,\"../math/Quaternion\":28,\"../math/Transform\":29,\"../math/Vec3\":30,\"../shapes/ConvexPolyhedron\":38,\"../shapes/Shape\":43,\"../solver/Solver\":47,\"../utils/Vec3Pool\":54}],56:[function(t,e,n){e.exports=g;var i=t(\"../shapes/Shape\"),r=t(\"../math/Vec3\"),o=t(\"../math/Quaternion\"),s=t(\"../solver/GSSolver\"),a=(t(\"../utils/Vec3Pool\"),t(\"../equations/ContactEquation\"),t(\"../equations/FrictionEquation\"),t(\"./Narrowphase\")),h=t(\"../utils/EventTarget\"),c=t(\"../collision/ArrayCollisionMatrix\"),l=t(\"../material/Material\"),u=t(\"../material/ContactMaterial\"),p=t(\"../objects/Body\"),f=t(\"../utils/TupleDictionary\"),d=t(\"../collision/RaycastResult\"),y=t(\"../collision/AABB\"),v=t(\"../collision/Ray\"),m=t(\"../collision/NaiveBroadphase\");function g(){h.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new m,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new a(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new l(\"default\"),this.defaultContactMaterial=new u(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:\"addBody\",body:null},this.removeBodyEvent={type:\"removeBody\",body:null}}g.prototype=new h,new y;var b=new v;if(g.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},g.prototype.numObjects=function(){return this.bodies.length},g.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},g.prototype.add=g.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof p&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},g.prototype.addConstraint=function(t){this.constraints.push(t)},g.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},g.prototype.rayTest=function(t,e,n){n instanceof d?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},g.prototype.raycastAll=function(t,e,n,i){return n.mode=v.ALL,n.from=t,n.to=e,n.callback=i,b.intersectWorld(this,n)},g.prototype.raycastAny=function(t,e,n,i){return n.mode=v.ANY,n.from=t,n.to=e,n.result=i,b.intersectWorld(this,n)},g.prototype.raycastClosest=function(t,e,n,i){return n.mode=v.CLOSEST,n.from=t,n.to=e,n.result=i,b.intersectWorld(this,n)},g.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,i=n.indexOf(t);if(-1!==i){n.splice(i,1);for(var r=0;r!==n.length;r++)n[r].index=r;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},g.prototype.removeBody=g.prototype.remove,g.prototype.addMaterial=function(t){this.materials.push(t)},g.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},\"undefined\"==typeof performance&&(performance={}),!performance.now){var w=Date.now();performance.timing&&performance.timing.navigationStart&&(w=performance.timing.navigationStart),performance.now=function(){return Date.now()-w}}var x=new r;g.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var i=Math.floor((this.time+e)/t)-Math.floor(this.time/t);i=Math.min(i,n);for(var r=performance.now(),o=0;o!==i&&(this.internalStep(t),!(performance.now()-r>1e3*t));o++);this.time+=e;for(var s=this.time%t,a=s/t,h=x,c=this.bodies,l=0;l!==c.length;l++){var u=c[l];u.type!==p.STATIC&&u.sleepState!==p.SLEEPING?(u.position.vsub(u.previousPosition,h),h.scale(a,h),u.position.vadd(h,u.interpolatedPosition)):(u.interpolatedPosition.copy(u.position),u.interpolatedQuaternion.copy(u.quaternion))}}};var E={type:\"postStep\"},C={type:\"preStep\"},S={type:\"collide\",body:null,contact:null},T=[],A=[],B=[],R=[],_=(new r,new r,new r,new r,new r,new r,new r,new r,new r,new o,new o),P=new o,F=new r;g.prototype.internalStep=function(t){this.dt=t;var e,n=this.contacts,r=B,o=R,s=this.numObjects(),a=this.bodies,h=this.solver,c=this.gravity,l=this.doProfiling,u=this.profile,f=p.DYNAMIC,d=this.constraints,y=A,v=(c.norm(),c.x),m=c.y,g=c.z,b=0;for(l&&(e=performance.now()),b=0;b!==s;b++){var w=a[b];if(w.type&f){var x=w.force,I=w.mass;x.x+=I*v,x.y+=I*m,x.z+=I*g}}for(var b=0,k=this.subsystems.length;b!==k;b++)this.subsystems[b].update();l&&(e=performance.now()),r.length=0,o.length=0,this.broadphase.collisionPairs(this,r,o),l&&(u.broadphase=performance.now()-e);var M=d.length;for(b=0;b!==M;b++){var j=d[b];if(!j.collideConnected)for(var N=r.length-1;N>=0;N-=1)(j.bodyA===r[N]&&j.bodyB===o[N]||j.bodyB===r[N]&&j.bodyA===o[N])&&(r.splice(N,1),o.splice(N,1))}this.collisionMatrixTick(),l&&(e=performance.now());var O=T,L=n.length;for(b=0;b!==L;b++)O.push(n[b]);n.length=0;var q=this.frictionEquations.length;for(b=0;b!==q;b++)y.push(this.frictionEquations[b]);this.frictionEquations.length=0,this.narrowphase.getContacts(r,o,this,n,O,this.frictionEquations,y),l&&(u.narrowphase=performance.now()-e),l&&(e=performance.now());for(var b=0;b<this.frictionEquations.length;b++)h.addEquation(this.frictionEquations[b]);for(var z=n.length,U=0;U!==z;U++){var j=n[U],w=j.bi,D=j.bj;if(j.si,j.sj,(w.material&&D.material&&this.getContactMaterial(w.material,D.material)||this.defaultContactMaterial).friction,w.material&&D.material&&(w.material.friction>=0&&D.material.friction>=0&&(w.material.friction,D.material.friction),w.material.restitution>=0&&D.material.restitution>=0&&(j.restitution=w.material.restitution*D.material.restitution)),h.addEquation(j),w.allowSleep&&w.type===p.DYNAMIC&&w.sleepState===p.SLEEPING&&D.sleepState===p.AWAKE&&D.type!==p.STATIC){var W=D.velocity.norm2()+D.angularVelocity.norm2(),V=Math.pow(D.sleepSpeedLimit,2);W>=2*V&&(w._wakeUpAfterNarrowphase=!0)}if(D.allowSleep&&D.type===p.DYNAMIC&&D.sleepState===p.SLEEPING&&w.sleepState===p.AWAKE&&w.type!==p.STATIC){var Y=w.velocity.norm2()+w.angularVelocity.norm2(),H=Math.pow(w.sleepSpeedLimit,2);Y>=2*H&&(D._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(w,D,!0),this.collisionMatrixPrevious.get(w,D)||(S.body=D,S.contact=j,w.dispatchEvent(S),S.body=w,D.dispatchEvent(S))}for(l&&(u.makeContactConstraints=performance.now()-e,e=performance.now()),b=0;b!==s;b++){var w=a[b];w._wakeUpAfterNarrowphase&&(w.wakeUp(),w._wakeUpAfterNarrowphase=!1)}var M=d.length;for(b=0;b!==M;b++){var j=d[b];j.update();for(var N=0,X=j.equations.length;N!==X;N++){var $=j.equations[N];h.addEquation($)}}h.solve(t,this),l&&(u.solve=performance.now()-e),h.removeAllEquations();var G=Math.pow;for(b=0;b!==s;b++){var w=a[b];if(w.type&f){var Q=G(1-w.linearDamping,t),Z=w.velocity;Z.mult(Q,Z);var K=w.angularVelocity;if(K){var J=G(1-w.angularDamping,t);K.mult(J,K)}}}for(this.dispatchEvent(C),b=0;b!==s;b++){var w=a[b];w.preStep&&w.preStep.call(w)}l&&(e=performance.now());var tt=_,et=P,nt=this.stepnumber,it=p.DYNAMIC|p.KINEMATIC,rt=nt%(this.quatNormalizeSkip+1)==0,ot=this.quatNormalizeFast,st=.5*t;for(i.types.PLANE,i.types.CONVEXPOLYHEDRON,b=0;b!==s;b++){var at=a[b],ht=at.force,ct=at.torque;if(at.type&it&&at.sleepState!==p.SLEEPING){var lt=at.velocity,ut=at.angularVelocity,pt=at.position,ft=at.quaternion,dt=at.invMass,yt=at.invInertiaWorld;lt.x+=ht.x*dt*t,lt.y+=ht.y*dt*t,lt.z+=ht.z*dt*t,at.angularVelocity&&(yt.vmult(ct,F),F.mult(t,F),F.vadd(ut,ut)),pt.x+=lt.x*t,pt.y+=lt.y*t,pt.z+=lt.z*t,at.angularVelocity&&(tt.set(ut.x,ut.y,ut.z,0),tt.mult(ft,et),ft.x+=st*et.x,ft.y+=st*et.y,ft.z+=st*et.z,ft.w+=st*et.w,rt&&(ot?ft.normalizeFast():ft.normalize())),at.aabb&&(at.aabbNeedsUpdate=!0),at.updateInertiaWorld&&at.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(E),b=0;b!==s;b++){var w=a[b],vt=w.postStep;vt&&vt.call(w)}if(this.allowSleep)for(b=0;b!==s;b++)a[b].sleepTick(this.time)},g.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var i=t[n];i.force,i.torque,i.force.set(0,0,0),i.torque.set(0,0,0)}}},{\"../collision/AABB\":3,\"../collision/ArrayCollisionMatrix\":4,\"../collision/NaiveBroadphase\":7,\"../collision/Ray\":9,\"../collision/RaycastResult\":10,\"../equations/ContactEquation\":19,\"../equations/FrictionEquation\":21,\"../material/ContactMaterial\":24,\"../material/Material\":25,\"../math/Quaternion\":28,\"../math/Vec3\":30,\"../objects/Body\":31,\"../shapes/Shape\":43,\"../solver/GSSolver\":46,\"../utils/EventTarget\":49,\"../utils/TupleDictionary\":52,\"../utils/Vec3Pool\":54,\"./Narrowphase\":55}]},{},[2])(2)},function(t,e){var n,i,r=t.exports={};function o(){throw new Error(\"setTimeout has not been defined\")}function s(){throw new Error(\"clearTimeout has not been defined\")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n=\"function\"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i=\"function\"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var h,c=[],l=!1,u=-1;function p(){l&&h&&(l=!1,h.length?c=h.concat(c):u=-1,c.length&&f())}function f(){if(!l){var t=a(p);l=!0;for(var e=c.length;e;){for(h=c,c=[];++u<e;)h&&h[u].run();u=-1,e=c.length}h=null,l=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new d(t,e)),1!==c.length||l||a(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},r.title=\"browser\",r.browser=!0,r.env={},r.argv=[],r.version=\"\",r.versions={},r.on=y,r.addListener=y,r.once=y,r.off=y,r.removeListener=y,r.removeAllListeners=y,r.emit=y,r.prependListener=y,r.prependOnceListener=y,r.listeners=function(t){return[]},r.binding=function(t){throw new Error(\"process.binding is not supported\")},r.cwd=function(){return\"/\"},r.chdir=function(t){throw new Error(\"process.chdir is not supported\")},r.umask=function(){return 0}},function(t,e,n){\"use strict\";(function(t){\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nvar i=n(70),r=n(71),o=n(72);function s(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(s()<e)throw new RangeError(\"Invalid typed array length\");return h.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=h.prototype:(null===t&&(t=new h(e)),t.length=e),t}function h(t,e,n){if(!(h.TYPED_ARRAY_SUPPORT||this instanceof h))return new h(t,e,n);if(\"number\"==typeof t){if(\"string\"==typeof e)throw new Error(\"If encoding is specified then the first argument must be a string\");return u(this,t)}return c(this,t,e,n)}function c(t,e,n,i){if(\"number\"==typeof e)throw new TypeError('\"value\" argument must not be a number');return\"undefined\"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,i){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError(\"'offset' is out of bounds\");if(e.byteLength<n+(i||0))throw new RangeError(\"'length' is out of bounds\");e=void 0===n&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,n):new Uint8Array(e,n,i);h.TYPED_ARRAY_SUPPORT?(t=e).__proto__=h.prototype:t=p(t,e);return t}(t,e,n,i):\"string\"==typeof e?function(t,e,n){\"string\"==typeof n&&\"\"!==n||(n=\"utf8\");if(!h.isEncoding(n))throw new TypeError('\"encoding\" must be a valid string encoding');var i=0|d(e,n),r=(t=a(t,i)).write(e,n);r!==i&&(t=t.slice(0,r));return t}(t,e,n):function(t,e){if(h.isBuffer(e)){var n=0|f(e.length);return 0===(t=a(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if(\"undefined\"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||\"length\"in e)return\"number\"!=typeof e.length||(i=e.length)!=i?a(t,0):p(t,e);if(\"Buffer\"===e.type&&o(e.data))return p(t,e.data)}var i;throw new TypeError(\"First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.\")}(t,e)}function l(t){if(\"number\"!=typeof t)throw new TypeError('\"size\" argument must be a number');if(t<0)throw new RangeError('\"size\" argument must not be negative')}function u(t,e){if(l(e),t=a(t,e<0?0:0|f(e)),!h.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function p(t,e){var n=e.length<0?0:0|f(e.length);t=a(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function f(t){if(t>=s())throw new RangeError(\"Attempt to allocate Buffer larger than maximum size: 0x\"+s().toString(16)+\" bytes\");return 0|t}function d(t,e){if(h.isBuffer(t))return t.length;if(\"undefined\"!=typeof ArrayBuffer&&\"function\"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;\"string\"!=typeof t&&(t=\"\"+t);var n=t.length;if(0===n)return 0;for(var i=!1;;)switch(e){case\"ascii\":case\"latin1\":case\"binary\":return n;case\"utf8\":case\"utf-8\":case void 0:return z(t).length;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return 2*n;case\"hex\":return n>>>1;case\"base64\":return U(t).length;default:if(i)return z(t).length;e=(\"\"+e).toLowerCase(),i=!0}}function y(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function v(t,e,n,i,r){if(0===t.length)return-1;if(\"string\"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(r)return-1;n=t.length-1}else if(n<0){if(!r)return-1;n=0}if(\"string\"==typeof e&&(e=h.from(e,i)),h.isBuffer(e))return 0===e.length?-1:m(t,e,n,i,r);if(\"number\"==typeof e)return e&=255,h.TYPED_ARRAY_SUPPORT&&\"function\"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):m(t,[e],n,i,r);throw new TypeError(\"val must be string, number or Buffer\")}function m(t,e,n,i,r){var o,s=1,a=t.length,h=e.length;if(void 0!==i&&(\"ucs2\"===(i=String(i).toLowerCase())||\"ucs-2\"===i||\"utf16le\"===i||\"utf-16le\"===i)){if(t.length<2||e.length<2)return-1;s=2,a/=2,h/=2,n/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(r){var l=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===h)return l*s}else-1!==l&&(o-=o-l),l=-1}else for(n+h>a&&(n=a-h),o=n;o>=0;o--){for(var u=!0,p=0;p<h;p++)if(c(t,o+p)!==c(e,p)){u=!1;break}if(u)return o}return-1}function g(t,e,n,i){n=Number(n)||0;var r=t.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=e.length;if(o%2!=0)throw new TypeError(\"Invalid hex string\");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function b(t,e,n,i){return D(z(e,t.length-n),t,n,i)}function w(t,e,n,i){return D(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,i)}function x(t,e,n,i){return w(t,e,n,i)}function E(t,e,n,i){return D(U(e),t,n,i)}function C(t,e,n,i){return D(function(t,e){for(var n,i,r,o=[],s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}(e,t.length-n),t,n,i)}function S(t,e,n){return 0===e&&n===t.length?i.fromByteArray(t):i.fromByteArray(t.slice(e,n))}function T(t,e,n){n=Math.min(t.length,n);for(var i=[],r=e;r<n;){var o,s,a,h,c=t[r],l=null,u=c>239?4:c>223?3:c>191?2:1;if(r+u<=n)switch(u){case 1:c<128&&(l=c);break;case 2:128==(192&(o=t[r+1]))&&(h=(31&c)<<6|63&o)>127&&(l=h);break;case 3:o=t[r+1],s=t[r+2],128==(192&o)&&128==(192&s)&&(h=(15&c)<<12|(63&o)<<6|63&s)>2047&&(h<55296||h>57343)&&(l=h);break;case 4:o=t[r+1],s=t[r+2],a=t[r+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(h=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&h<1114112&&(l=h)}null===l?(l=65533,u=1):l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l),r+=u}return function(t){var e=t.length;if(e<=A)return String.fromCharCode.apply(String,t);var n=\"\",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=A));return n}(i)}e.Buffer=h,e.SlowBuffer=function(t){+t!=t&&(t=0);return h.alloc(+t)},e.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&\"function\"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=s(),h.poolSize=8192,h._augment=function(t){return t.__proto__=h.prototype,t},h.from=function(t,e,n){return c(null,t,e,n)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,\"undefined\"!=typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(t,e,n){return function(t,e,n,i){return l(e),e<=0?a(t,e):void 0!==n?\"string\"==typeof i?a(t,e).fill(n,i):a(t,e).fill(n):a(t,e)}(null,t,e,n)},h.allocUnsafe=function(t){return u(null,t)},h.allocUnsafeSlow=function(t){return u(null,t)},h.isBuffer=function(t){return!(null==t||!t._isBuffer)},h.compare=function(t,e){if(!h.isBuffer(t)||!h.isBuffer(e))throw new TypeError(\"Arguments must be Buffers\");if(t===e)return 0;for(var n=t.length,i=e.length,r=0,o=Math.min(n,i);r<o;++r)if(t[r]!==e[r]){n=t[r],i=e[r];break}return n<i?-1:i<n?1:0},h.isEncoding=function(t){switch(String(t).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"latin1\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},h.concat=function(t,e){if(!o(t))throw new TypeError('\"list\" argument must be an Array of Buffers');if(0===t.length)return h.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var i=h.allocUnsafe(e),r=0;for(n=0;n<t.length;++n){var s=t[n];if(!h.isBuffer(s))throw new TypeError('\"list\" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},h.byteLength=d,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError(\"Buffer size must be a multiple of 16-bits\");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},h.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError(\"Buffer size must be a multiple of 32-bits\");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},h.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError(\"Buffer size must be a multiple of 64-bits\");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},h.prototype.toString=function(){var t=0|this.length;return 0===t?\"\":0===arguments.length?T(this,0,t):function(t,e,n){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return\"\";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return\"\";if((n>>>=0)<=(e>>>=0))return\"\";for(t||(t=\"utf8\");;)switch(t){case\"hex\":return _(this,e,n);case\"utf8\":case\"utf-8\":return T(this,e,n);case\"ascii\":return B(this,e,n);case\"latin1\":case\"binary\":return R(this,e,n);case\"base64\":return S(this,e,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return P(this,e,n);default:if(i)throw new TypeError(\"Unknown encoding: \"+t);t=(t+\"\").toLowerCase(),i=!0}}.apply(this,arguments)},h.prototype.equals=function(t){if(!h.isBuffer(t))throw new TypeError(\"Argument must be a Buffer\");return this===t||0===h.compare(this,t)},h.prototype.inspect=function(){var t=\"\",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString(\"hex\",0,n).match(/.{2}/g).join(\" \"),this.length>n&&(t+=\" ... \")),\"<Buffer \"+t+\">\"},h.prototype.compare=function(t,e,n,i,r){if(!h.isBuffer(t))throw new TypeError(\"Argument must be a Buffer\");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),e<0||n>t.length||i<0||r>this.length)throw new RangeError(\"out of range index\");if(i>=r&&e>=n)return 0;if(i>=r)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(n>>>=0)-(e>>>=0),a=Math.min(o,s),c=this.slice(i,r),l=t.slice(e,n),u=0;u<a;++u)if(c[u]!==l[u]){o=c[u],s=l[u];break}return o<s?-1:s<o?1:0},h.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},h.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},h.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},h.prototype.write=function(t,e,n,i){if(void 0===e)i=\"utf8\",n=this.length,e=0;else if(void 0===n&&\"string\"==typeof e)i=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error(\"Buffer.write(string, encoding, offset[, length]) is no longer supported\");e|=0,isFinite(n)?(n|=0,void 0===i&&(i=\"utf8\")):(i=n,n=void 0)}var r=this.length-e;if((void 0===n||n>r)&&(n=r),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError(\"Attempt to write outside buffer bounds\");i||(i=\"utf8\");for(var o=!1;;)switch(i){case\"hex\":return g(this,t,e,n);case\"utf8\":case\"utf-8\":return b(this,t,e,n);case\"ascii\":return w(this,t,e,n);case\"latin1\":case\"binary\":return x(this,t,e,n);case\"base64\":return E(this,t,e,n);case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return C(this,t,e,n);default:if(o)throw new TypeError(\"Unknown encoding: \"+i);i=(\"\"+i).toLowerCase(),o=!0}},h.prototype.toJSON=function(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function B(t,e,n){var i=\"\";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(127&t[r]);return i}function R(t,e,n){var i=\"\";n=Math.min(t.length,n);for(var r=e;r<n;++r)i+=String.fromCharCode(t[r]);return i}function _(t,e,n){var i=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>i)&&(n=i);for(var r=\"\",o=e;o<n;++o)r+=q(t[o]);return r}function P(t,e,n){for(var i=t.slice(e,n),r=\"\",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function F(t,e,n){if(t%1!=0||t<0)throw new RangeError(\"offset is not uint\");if(t+e>n)throw new RangeError(\"Trying to access beyond buffer length\")}function I(t,e,n,i,r,o){if(!h.isBuffer(t))throw new TypeError('\"buffer\" argument must be a Buffer instance');if(e>r||e<o)throw new RangeError('\"value\" argument is out of bounds');if(n+i>t.length)throw new RangeError(\"Index out of range\")}function k(t,e,n,i){e<0&&(e=65535+e+1);for(var r=0,o=Math.min(t.length-n,2);r<o;++r)t[n+r]=(e&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function M(t,e,n,i){e<0&&(e=4294967295+e+1);for(var r=0,o=Math.min(t.length-n,4);r<o;++r)t[n+r]=e>>>8*(i?r:3-r)&255}function j(t,e,n,i,r,o){if(n+i>t.length)throw new RangeError(\"Index out of range\");if(n<0)throw new RangeError(\"Index out of range\")}function N(t,e,n,i,o){return o||j(t,0,n,4),r.write(t,e,n,i,23,4),n+4}function O(t,e,n,i,o){return o||j(t,0,n,8),r.write(t,e,n,i,52,8),n+8}h.prototype.slice=function(t,e){var n,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),h.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=h.prototype;else{var r=e-t;n=new h(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+t]}return n},h.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||F(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i},h.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||F(t,e,this.length);for(var i=this[t+--e],r=1;e>0&&(r*=256);)i+=this[t+--e]*r;return i},h.prototype.readUInt8=function(t,e){return e||F(t,1,this.length),this[t]},h.prototype.readUInt16LE=function(t,e){return e||F(t,2,this.length),this[t]|this[t+1]<<8},h.prototype.readUInt16BE=function(t,e){return e||F(t,2,this.length),this[t]<<8|this[t+1]},h.prototype.readUInt32LE=function(t,e){return e||F(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},h.prototype.readUInt32BE=function(t,e){return e||F(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},h.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||F(t,e,this.length);for(var i=this[t],r=1,o=0;++o<e&&(r*=256);)i+=this[t+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*e)),i},h.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||F(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},h.prototype.readInt8=function(t,e){return e||F(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},h.prototype.readInt16LE=function(t,e){e||F(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt16BE=function(t,e){e||F(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt32LE=function(t,e){return e||F(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},h.prototype.readInt32BE=function(t,e){return e||F(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},h.prototype.readFloatLE=function(t,e){return e||F(t,4,this.length),r.read(this,t,!0,23,4)},h.prototype.readFloatBE=function(t,e){return e||F(t,4,this.length),r.read(this,t,!1,23,4)},h.prototype.readDoubleLE=function(t,e){return e||F(t,8,this.length),r.read(this,t,!0,52,8)},h.prototype.readDoubleBE=function(t,e){return e||F(t,8,this.length),r.read(this,t,!1,52,8)},h.prototype.writeUIntLE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[e]=255&t;++o<n&&(r*=256);)this[e+o]=t/r&255;return e+n},h.prototype.writeUIntBE=function(t,e,n,i){(t=+t,e|=0,n|=0,i)||I(this,t,e,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[e+r]=255&t;--r>=0&&(o*=256);)this[e+r]=t/o&255;return e+n},h.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,255,0),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},h.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):k(this,t,e,!0),e+2},h.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):k(this,t,e,!1),e+2},h.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):M(this,t,e,!0),e+4},h.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):M(this,t,e,!1),e+4},h.prototype.writeIntLE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);I(this,t,e,n,r-1,-r)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},h.prototype.writeIntBE=function(t,e,n,i){if(t=+t,e|=0,!i){var r=Math.pow(2,8*n-1);I(this,t,e,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},h.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,1,127,-128),h.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},h.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):k(this,t,e,!0),e+2},h.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):k(this,t,e,!1),e+2},h.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):M(this,t,e,!0),e+4},h.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||I(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),h.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):M(this,t,e,!1),e+4},h.prototype.writeFloatLE=function(t,e,n){return N(this,t,e,!0,n)},h.prototype.writeFloatBE=function(t,e,n){return N(this,t,e,!1,n)},h.prototype.writeDoubleLE=function(t,e,n){return O(this,t,e,!0,n)},h.prototype.writeDoubleBE=function(t,e,n){return O(this,t,e,!1,n)},h.prototype.copy=function(t,e,n,i){if(n||(n=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError(\"targetStart out of bounds\");if(n<0||n>=this.length)throw new RangeError(\"sourceStart out of bounds\");if(i<0)throw new RangeError(\"sourceEnd out of bounds\");i>this.length&&(i=this.length),t.length-e<i-n&&(i=t.length-e+n);var r,o=i-n;if(this===t&&n<e&&e<i)for(r=o-1;r>=0;--r)t[r+e]=this[r+n];else if(o<1e3||!h.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+e]=this[r+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},h.prototype.fill=function(t,e,n,i){if(\"string\"==typeof t){if(\"string\"==typeof e?(i=e,e=0,n=this.length):\"string\"==typeof n&&(i=n,n=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&\"string\"!=typeof i)throw new TypeError(\"encoding must be a string\");if(\"string\"==typeof i&&!h.isEncoding(i))throw new TypeError(\"Unknown encoding: \"+i)}else\"number\"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError(\"Out of range index\");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),\"number\"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=h.isBuffer(t)?t:z(new h(t,i).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var L=/[^+\\/0-9A-Za-z-_]/g;function q(t){return t<16?\"0\"+t.toString(16):t.toString(16)}function z(t,e){var n;e=e||1/0;for(var i=t.length,r=null,o=[],s=0;s<i;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(e-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(e-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error(\"Invalid code point\");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function U(t){return i.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,\"\")}(t).replace(L,\"\")).length<2)return\"\";for(;t.length%4!=0;)t+=\"=\";return t}(t))}function D(t,e,n,i){for(var r=0;r<i&&!(r+n>=e.length||r>=t.length);++r)e[r+n]=t[r];return r}}).call(this,n(0))},function(t,e){\"function\"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[\"$\"+t]=this._callbacks[\"$\"+t]||[]).push(e),this},i.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,i=this._callbacks[\"$\"+t];if(!i)return this;if(1==arguments.length)return delete this._callbacks[\"$\"+t],this;for(var r=0;r<i.length;r++)if((n=i[r])===e||n.fn===e){i.splice(r,1);break}return this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[\"$\"+t];if(n)for(var i=0,r=(n=n.slice(0)).length;i<r;++i)n[i].apply(this,e);return this},i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[\"$\"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,n){var i,r=n(77),o=n(28),s=n(78),a=n(79),h=n(80);\"undefined\"!=typeof ArrayBuffer&&(i=n(81));var c=\"undefined\"!=typeof navigator&&/Android/i.test(navigator.userAgent),l=\"undefined\"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),u=c||l;e.protocol=3;var p=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=r(p),d={type:\"error\",data:\"parser error\"},y=n(82);function v(t,e,n){for(var i=new Array(t.length),r=a(t.length,n),o=function(t,n,r){e(n,function(e,n){i[t]=n,r(e,i)})},s=0;s<t.length;s++)o(s,t[s],r)}e.encodePacket=function(t,n,i,r){\"function\"==typeof n&&(r=n,n=!1),\"function\"==typeof i&&(r=i,i=null);var o=void 0===t.data?void 0:t.data.buffer||t.data;if(\"undefined\"!=typeof ArrayBuffer&&o instanceof ArrayBuffer)return function(t,n,i){if(!n)return e.encodeBase64Packet(t,i);var r=t.data,o=new Uint8Array(r),s=new Uint8Array(1+r.byteLength);s[0]=p[t.type];for(var a=0;a<o.length;a++)s[a+1]=o[a];return i(s.buffer)}(t,n,r);if(void 0!==y&&o instanceof y)return function(t,n,i){if(!n)return e.encodeBase64Packet(t,i);if(u)return function(t,n,i){if(!n)return e.encodeBase64Packet(t,i);var r=new FileReader;return r.onload=function(){e.encodePacket({type:t.type,data:r.result},n,!0,i)},r.readAsArrayBuffer(t.data)}(t,n,i);var r=new Uint8Array(1);r[0]=p[t.type];var o=new y([r.buffer,t.data]);return i(o)}(t,n,r);if(o&&o.base64)return function(t,n){var i=\"b\"+e.packets[t.type]+t.data.data;return n(i)}(t,r);var s=p[t.type];return void 0!==t.data&&(s+=i?h.encode(String(t.data),{strict:!1}):String(t.data)),r(\"\"+s)},e.encodeBase64Packet=function(t,n){var i,r=\"b\"+e.packets[t.type];if(void 0!==y&&t.data instanceof y){var o=new FileReader;return o.onload=function(){var t=o.result.split(\",\")[1];n(r+t)},o.readAsDataURL(t.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var s=new Uint8Array(t.data),a=new Array(s.length),h=0;h<s.length;h++)a[h]=s[h];i=String.fromCharCode.apply(null,a)}return r+=btoa(i),n(r)},e.decodePacket=function(t,n,i){if(void 0===t)return d;if(\"string\"==typeof t){if(\"b\"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),n);if(i&&!1===(t=function(t){try{t=h.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return d;var r=t.charAt(0);return Number(r)==r&&f[r]?t.length>1?{type:f[r],data:t.substring(1)}:{type:f[r]}:d}r=new Uint8Array(t)[0];var o=s(t,1);return y&&\"blob\"===n&&(o=new y([o])),{type:f[r],data:o}},e.decodeBase64Packet=function(t,e){var n=f[t.charAt(0)];if(!i)return{type:n,data:{base64:!0,data:t.substr(1)}};var r=i.decode(t.substr(1));return\"blob\"===e&&y&&(r=new y([r])),{type:n,data:r}},e.encodePayload=function(t,n,i){\"function\"==typeof n&&(i=n,n=null);var r=o(t);if(n&&r)return y&&!u?e.encodePayloadAsBlob(t,i):e.encodePayloadAsArrayBuffer(t,i);if(!t.length)return i(\"0:\");v(t,function(t,i){e.encodePacket(t,!!r&&n,!1,function(t){i(null,function(t){return t.length+\":\"+t}(t))})},function(t,e){return i(e.join(\"\"))})},e.decodePayload=function(t,n,i){if(\"string\"!=typeof t)return e.decodePayloadAsBinary(t,n,i);var r;if(\"function\"==typeof n&&(i=n,n=null),\"\"===t)return i(d,0,1);for(var o,s,a=\"\",h=0,c=t.length;h<c;h++){var l=t.charAt(h);if(\":\"===l){if(\"\"===a||a!=(o=Number(a)))return i(d,0,1);if(a!=(s=t.substr(h+1,o)).length)return i(d,0,1);if(s.length){if(r=e.decodePacket(s,n,!1),d.type===r.type&&d.data===r.data)return i(d,0,1);if(!1===i(r,h+o,c))return}h+=o,a=\"\"}else a+=l}return\"\"!==a?i(d,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,n){if(!t.length)return n(new ArrayBuffer(0));v(t,function(t,n){e.encodePacket(t,!0,!0,function(t){return n(null,t)})},function(t,e){var i=e.reduce(function(t,e){var n;return t+(n=\"string\"==typeof e?e.length:e.byteLength).toString().length+n+2},0),r=new Uint8Array(i),o=0;return e.forEach(function(t){var e=\"string\"==typeof t,n=t;if(e){for(var i=new Uint8Array(t.length),s=0;s<t.length;s++)i[s]=t.charCodeAt(s);n=i.buffer}r[o++]=e?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)r[o++]=parseInt(a[s]);r[o++]=255;for(i=new Uint8Array(n),s=0;s<i.length;s++)r[o++]=i[s]}),n(r.buffer)})},e.encodePayloadAsBlob=function(t,n){v(t,function(t,n){e.encodePacket(t,!0,!0,function(t){var e=new Uint8Array(1);if(e[0]=1,\"string\"==typeof t){for(var i=new Uint8Array(t.length),r=0;r<t.length;r++)i[r]=t.charCodeAt(r);t=i.buffer,e[0]=0}var o=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),s=new Uint8Array(o.length+1);for(r=0;r<o.length;r++)s[r]=parseInt(o[r]);if(s[o.length]=255,y){var a=new y([e.buffer,s.buffer,t]);n(null,a)}})},function(t,e){return n(new y(e))})},e.decodePayloadAsBinary=function(t,n,i){\"function\"==typeof n&&(i=n,n=null);for(var r=t,o=[];r.byteLength>0;){for(var a=new Uint8Array(r),h=0===a[0],c=\"\",l=1;255!==a[l];l++){if(c.length>310)return i(d,0,1);c+=a[l]}r=s(r,2+c.length),c=parseInt(c);var u=s(r,0,c);if(h)try{u=String.fromCharCode.apply(null,new Uint8Array(u))}catch(t){var p=new Uint8Array(u);u=\"\";for(l=0;l<p.length;l++)u+=String.fromCharCode(p[l])}o.push(u),r=s(r,c)}var f=o.length;o.forEach(function(t,r){i(e.decodePacket(t,n,!0),r,f)})}},function(t,e,n){\"use strict\";var i=n(14),r=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=u;var o=n(9);o.inherits=n(4);var s=n(37),a=n(41);o.inherits(u,s);for(var h=r(a.prototype),c=0;c<h.length;c++){var l=h[c];u.prototype[l]||(u.prototype[l]=a.prototype[l])}function u(t){if(!(this instanceof u))return new u(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once(\"end\",p)}function p(){this.allowHalfOpen||this._writableState.ended||i.nextTick(f,this)}function f(t){t.end()}Object.defineProperty(u.prototype,\"writableHighWaterMark\",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,\"destroyed\",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),u.prototype._destroy=function(t,e){this.push(null),this.end(),i.nextTick(e,t)}},function(t,e,n){\"use strict\";var i,r,o,s,a,h,c,l=n(48),u=n(62),p=Function.prototype.apply,f=Function.prototype.call,d=Object.create,y=Object.defineProperty,v=Object.defineProperties,m=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(t,e){var n,r;return u(e),r=this,i.call(this,t,n=function(){o.call(r,t,n),p.call(e,this,arguments)}),n.__eeOnceListener__=e,this},a={on:i=function(t,e){var n;return u(e),m.call(this,\"__ee__\")?n=this.__ee__:(n=g.value=d(null),y(this,\"__ee__\",g),g.value=null),n[t]?\"object\"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},once:r,off:o=function(t,e){var n,i,r,o;if(u(e),!m.call(this,\"__ee__\"))return this;if(!(n=this.__ee__)[t])return this;if(\"object\"==typeof(i=n[t]))for(o=0;r=i[o];++o)r!==e&&r.__eeOnceListener__!==e||(2===i.length?n[t]=i[o?0:1]:i.splice(o,1));else i!==e&&i.__eeOnceListener__!==e||delete n[t];return this},emit:s=function(t){var e,n,i,r,o;if(m.call(this,\"__ee__\")&&(r=this.__ee__[t]))if(\"object\"==typeof r){for(n=arguments.length,o=new Array(n-1),e=1;e<n;++e)o[e-1]=arguments[e];for(r=r.slice(),e=0;i=r[e];++e)p.call(i,this,o)}else switch(arguments.length){case 1:f.call(r,this);break;case 2:f.call(r,this,arguments[1]);break;case 3:f.call(r,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),e=1;e<n;++e)o[e-1]=arguments[e];p.call(r,this,o)}}},h={on:l(i),once:l(r),off:l(o),emit:l(s)},c=v({},h),t.exports=e=function(t){return null==t?d(c):v(Object(t),h)},e.methods=a},function(t,e,n){(function(t){function n(t){return Object.prototype.toString.call(t)}e.isArray=function(t){return Array.isArray?Array.isArray(t):\"[object Array]\"===n(t)},e.isBoolean=function(t){return\"boolean\"==typeof t},e.isNull=function(t){return null===t},e.isNullOrUndefined=function(t){return null==t},e.isNumber=function(t){return\"number\"==typeof t},e.isString=function(t){return\"string\"==typeof t},e.isSymbol=function(t){return\"symbol\"==typeof t},e.isUndefined=function(t){return void 0===t},e.isRegExp=function(t){return\"[object RegExp]\"===n(t)},e.isObject=function(t){return\"object\"==typeof t&&null!==t},e.isDate=function(t){return\"[object Date]\"===n(t)},e.isError=function(t){return\"[object Error]\"===n(t)||t instanceof Error},e.isFunction=function(t){return\"function\"==typeof t},e.isPrimitive=function(t){return null===t||\"boolean\"==typeof t||\"number\"==typeof t||\"string\"==typeof t||\"symbol\"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,n(3).Buffer)},function(t,e,n){(function(i){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&\"env\"in i&&(t=i.env.DEBUG),t}(e=t.exports=n(64)).log=function(){return\"object\"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?\"%c\":\"\")+this.namespace+(n?\" %c\":\" \")+t[0]+(n?\"%c \":\" \")+\"+\"+e.humanize(this.diff),!n)return;var i=\"color: \"+this.color;t.splice(1,0,i,\"color: inherit\");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){\"%%\"!==t&&(r++,\"%c\"===t&&(o=r))}),t.splice(o,0,i)},e.save=function(t){try{null==t?e.storage.removeItem(\"debug\"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&\"renderer\"===window.process.type)return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},e.storage=\"undefined\"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return\"[UnexpectedJSONParseError]: \"+t.message}},e.enable(r())}).call(this,n(2))},function(t,e){e.encode=function(t){var e=\"\";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+=\"&\"),e+=encodeURIComponent(n)+\"=\"+encodeURIComponent(t[n]));return e},e.decode=function(t){for(var e={},n=t.split(\"&\"),i=0,r=n.length;i<r;i++){var o=n[i].split(\"=\");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},function(t,e){t.exports=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e,n){(function(i){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&\"env\"in i&&(t=i.env.DEBUG),t}(e=t.exports=n(83)).log=function(){return\"object\"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?\"%c\":\"\")+this.namespace+(n?\" %c\":\" \")+t[0]+(n?\"%c \":\" \")+\"+\"+e.humanize(this.diff),!n)return;var i=\"color: \"+this.color;t.splice(1,0,i,\"color: inherit\");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){\"%%\"!==t&&(r++,\"%c\"===t&&(o=r))}),t.splice(o,0,i)},e.save=function(t){try{null==t?e.storage.removeItem(\"debug\"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&\"renderer\"===window.process.type)return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},e.storage=\"undefined\"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return\"[UnexpectedJSONParseError]: \"+t.message}},e.enable(r())}).call(this,n(2))},function(t,e,n){\"use strict\";(function(e){!e.version||0===e.version.indexOf(\"v0.\")||0===e.version.indexOf(\"v1.\")&&0!==e.version.indexOf(\"v1.8.\")?t.exports={nextTick:function(t,n,i,r){if(\"function\"!=typeof t)throw new TypeError('\"callback\" argument must be a function');var o,s,a=arguments.length;switch(a){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function(){t.call(null,n)});case 3:return e.nextTick(function(){t.call(null,n,i)});case 4:return e.nextTick(function(){t.call(null,n,i,r)});default:for(o=new Array(a-1),s=0;s<o.length;)o[s++]=arguments[s];return e.nextTick(function(){t.apply(null,o)})}}}:t.exports=e}).call(this,n(2))},function(t,e,n){var i=n(3),r=i.Buffer;function o(t,e){for(var n in t)e[n]=t[n]}function s(t,e,n){return r(t,e,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?t.exports=i:(o(i,e),e.Buffer=s),o(r,s),s.from=function(t,e,n){if(\"number\"==typeof t)throw new TypeError(\"Argument must not be a number\");return r(t,e,n)},s.alloc=function(t,e,n){if(\"number\"!=typeof t)throw new TypeError(\"Argument must be a number\");var i=r(t);return void 0!==e?\"string\"==typeof n?i.fill(e,n):i.fill(e):i.fill(0),i},s.allocUnsafe=function(t){if(\"number\"!=typeof t)throw new TypeError(\"Argument must be a number\");return r(t)},s.allocUnsafeSlow=function(t){if(\"number\"!=typeof t)throw new TypeError(\"Argument must be a number\");return i.SlowBuffer(t)}},function(t,e,n){\"use strict\";var i=n(55)();t.exports=function(t){return t!==i&&null!==t}},function(t,e,n){var i=n(66)(\"socket.io-parser\"),r=n(5),o=n(69),s=n(18),a=n(24);function h(){}e.protocol=4,e.types=[\"CONNECT\",\"DISCONNECT\",\"EVENT\",\"ACK\",\"ERROR\",\"BINARY_EVENT\",\"BINARY_ACK\"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=h,e.Decoder=u;var c=e.ERROR+'\"encode error\"';function l(t){var n=\"\"+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(n+=t.attachments+\"-\"),t.nsp&&\"/\"!==t.nsp&&(n+=t.nsp+\",\"),null!=t.id&&(n+=t.id),null!=t.data){var r=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===r)return c;n+=r}return i(\"encoded %j as %s\",t,n),n}function u(){this.reconstructor=null}function p(t){this.reconPack=t,this.buffers=[]}function f(t){return{type:e.ERROR,data:\"parser error: \"+t}}h.prototype.encode=function(t,n){(i(\"encoding packet %j\",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type)?function(t,e){o.removeBlobs(t,function(t){var n=o.deconstructPacket(t),i=l(n.packet),r=n.buffers;r.unshift(i),e(r)})}(t,n):n([l(t)])},r(u.prototype),u.prototype.add=function(t){var n;if(\"string\"==typeof t)n=function(t){var n=0,r={type:Number(t.charAt(0))};if(null==e.types[r.type])return f(\"unknown packet type \"+r.type);if(e.BINARY_EVENT===r.type||e.BINARY_ACK===r.type){for(var o=\"\";\"-\"!==t.charAt(++n)&&(o+=t.charAt(n),n!=t.length););if(o!=Number(o)||\"-\"!==t.charAt(n))throw new Error(\"Illegal attachments\");r.attachments=Number(o)}if(\"/\"===t.charAt(n+1))for(r.nsp=\"\";++n;){var a=t.charAt(n);if(\",\"===a)break;if(r.nsp+=a,n===t.length)break}else r.nsp=\"/\";var h=t.charAt(n+1);if(\"\"!==h&&Number(h)==h){for(r.id=\"\";++n;){var a=t.charAt(n);if(null==a||Number(a)!=a){--n;break}if(r.id+=t.charAt(n),n===t.length)break}r.id=Number(r.id)}if(t.charAt(++n)){var c=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(n)),l=!1!==c&&(r.type===e.ERROR||s(c));if(!l)return f(\"invalid payload\");r.data=c}return i(\"decoded %s as %j\",t,r),r}(t),e.BINARY_EVENT===n.type||e.BINARY_ACK===n.type?(this.reconstructor=new p(n),0===this.reconstructor.reconPack.attachments&&this.emit(\"decoded\",n)):this.emit(\"decoded\",n);else{if(!a(t)&&!t.base64)throw new Error(\"Unknown type: \"+t);if(!this.reconstructor)throw new Error(\"got binary data when not reconstructing a packet\");(n=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit(\"decoded\",n))}},u.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},p.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=o.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},p.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return\"[object Array]\"==n.call(t)}},function(t,e,n){var i=n(75);t.exports=function(t){var e=t.xdomain,n=t.xscheme,r=t.enablesXDR;try{if(\"undefined\"!=typeof XMLHttpRequest&&(!e||i))return new XMLHttpRequest}catch(t){}try{if(\"undefined\"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(t){}if(!e)try{return new(self[[\"Active\"].concat(\"Object\").join(\"X\")])(\"Microsoft.XMLHTTP\")}catch(t){}}},function(t,e,n){var i=n(6),r=n(5);function o(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState=\"\",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}t.exports=o,r(o.prototype),o.prototype.onError=function(t,e){var n=new Error(t);return n.type=\"TransportError\",n.description=e,this.emit(\"error\",n),this},o.prototype.open=function(){return\"closed\"!==this.readyState&&\"\"!==this.readyState||(this.readyState=\"opening\",this.doOpen()),this},o.prototype.close=function(){return\"opening\"!==this.readyState&&\"open\"!==this.readyState||(this.doClose(),this.onClose()),this},o.prototype.send=function(t){if(\"open\"!==this.readyState)throw new Error(\"Transport not open\");this.write(t)},o.prototype.onOpen=function(){this.readyState=\"open\",this.writable=!0,this.emit(\"open\")},o.prototype.onData=function(t){var e=i.decodePacket(t,this.socket.binaryType);this.onPacket(e)},o.prototype.onPacket=function(t){this.emit(\"packet\",t)},o.prototype.onClose=function(){this.readyState=\"closed\",this.emit(\"close\")}},function(t,e,n){\"use strict\";e.a=class{constructor(){this.stepCount=0,this.objects={},this.playerCount=0,this.idCount=0}getNewId(){let t=this.idCount;for(;t in this.objects;)t++;return this.idCount=t+1,t}queryObjects(t){let e=[];return this.forEachObject((n,i)=>{let r=[];if(r.push(!(\"id\"in t)||null!==t.id&&i.id===t.id),r.push(!(\"playerId\"in t)||null!==t.playerId&&i.playerId===t.playerId),r.push(!(\"instanceType\"in t)||null!==t.instanceType&&i instanceof t.instanceType),\"components\"in t&&t.components.forEach(t=>{r.push(i.hasComponent(t))}),r.every(t=>t)&&(e.push(i),t.returnSingle))return!1}),t.returnSingle?e.length>0?e[0]:null:e}queryObject(t){return this.queryObjects(Object.assign(t,{returnSingle:!0}))}addObject(t){this.objects[t.id]=t}removeObject(t){delete this.objects[t]}forEachObject(t){for(let e of Object.keys(this.objects))if(!1===t(e,this.objects[e]))break}}},function(t,e,n){\"use strict\";class i{constructor(t){this.options=Object.assign({traceLevel:this.TRACE_DEBUG},t),this.traceBuffer=[],this.step=\"initializing\",this.error=this.trace.bind(this,i.TRACE_ERROR),this.warn=this.trace.bind(this,i.TRACE_WARN),this.info=this.trace.bind(this,i.TRACE_INFO),this.debug=this.trace.bind(this,i.TRACE_DEBUG),this.trace=this.trace.bind(this,i.TRACE_ALL)}static get TRACE_ALL(){return 0}static get TRACE_DEBUG(){return 1}static get TRACE_INFO(){return 2}static get TRACE_WARN(){return 3}static get TRACE_ERROR(){return 4}static get TRACE_NONE(){return 1e3}trace(t,e){if(\"function\"!=typeof e)throw new Error(`Lance trace was called but instead of passing a function, it received a [${typeof e}]`);t<this.options.traceLevel||this.traceBuffer.push({data:e(),level:t,step:this.step,time:new Date})}rotate(){let t=this.traceBuffer;return this.traceBuffer=[],t}get length(){return this.traceBuffer.length}setStep(t){this.step=t}}e.a=i},function(t,e){var n=/^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,i=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];t.exports=function(t){var e=t,r=t.indexOf(\"[\"),o=t.indexOf(\"]\");-1!=r&&-1!=o&&(t=t.substring(0,r)+t.substring(r,o).replace(/:/g,\";\")+t.substring(o,t.length));for(var s=n.exec(t||\"\"),a={},h=14;h--;)a[i[h]]=s[h]||\"\";return-1!=r&&-1!=o&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,\":\"),a.authority=a.authority.replace(\"[\",\"\").replace(\"]\",\"\").replace(/;/g,\":\"),a.ipv6uri=!0),a}},function(t,e,n){(function(e){t.exports=function(t){return n&&e.isBuffer(t)||i&&(t instanceof ArrayBuffer||r(t))};var n=\"function\"==typeof e&&\"function\"==typeof e.isBuffer,i=\"function\"==typeof ArrayBuffer,r=function(t){return\"function\"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}}).call(this,n(3).Buffer)},function(t,e,n){var i=n(73),r=n(31),o=n(5),s=n(17),a=n(32),h=n(33),c=n(10)(\"socket.io-client:manager\"),l=n(30),u=n(89),p=Object.prototype.hasOwnProperty;function f(t,e){if(!(this instanceof f))return new f(t,e);t&&\"object\"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||\"/socket.io\",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new u({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState=\"closed\",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=e.parser||s;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}t.exports=f,f.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)p.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},f.prototype.updateSocketIds=function(){for(var t in this.nsps)p.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},f.prototype.generateId=function(t){return(\"/\"===t?\"\":t+\"#\")+this.engine.id},o(f.prototype),f.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},f.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},f.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},f.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},f.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},f.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},f.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},f.prototype.open=f.prototype.connect=function(t,e){if(c(\"readyState %s\",this.readyState),~this.readyState.indexOf(\"open\"))return this;c(\"opening %s\",this.uri),this.engine=i(this.uri,this.opts);var n=this.engine,r=this;this.readyState=\"opening\",this.skipReconnect=!1;var o=a(n,\"open\",function(){r.onopen(),t&&t()}),s=a(n,\"error\",function(e){if(c(\"connect_error\"),r.cleanup(),r.readyState=\"closed\",r.emitAll(\"connect_error\",e),t){var n=new Error(\"Connection error\");n.data=e,t(n)}else r.maybeReconnectOnOpen()});if(!1!==this._timeout){var h=this._timeout;c(\"connect attempt will timeout after %d\",h);var l=setTimeout(function(){c(\"connect attempt timed out after %d\",h),o.destroy(),n.close(),n.emit(\"error\",\"timeout\"),r.emitAll(\"connect_timeout\",h)},h);this.subs.push({destroy:function(){clearTimeout(l)}})}return this.subs.push(o),this.subs.push(s),this},f.prototype.onopen=function(){c(\"open\"),this.cleanup(),this.readyState=\"open\",this.emit(\"open\");var t=this.engine;this.subs.push(a(t,\"data\",h(this,\"ondata\"))),this.subs.push(a(t,\"ping\",h(this,\"onping\"))),this.subs.push(a(t,\"pong\",h(this,\"onpong\"))),this.subs.push(a(t,\"error\",h(this,\"onerror\"))),this.subs.push(a(t,\"close\",h(this,\"onclose\"))),this.subs.push(a(this.decoder,\"decoded\",h(this,\"ondecoded\")))},f.prototype.onping=function(){this.lastPing=new Date,this.emitAll(\"ping\")},f.prototype.onpong=function(){this.emitAll(\"pong\",new Date-this.lastPing)},f.prototype.ondata=function(t){this.decoder.add(t)},f.prototype.ondecoded=function(t){this.emit(\"packet\",t)},f.prototype.onerror=function(t){c(\"error\",t),this.emitAll(\"error\",t)},f.prototype.socket=function(t,e){var n=this.nsps[t];if(!n){n=new r(this,t,e),this.nsps[t]=n;var i=this;n.on(\"connecting\",o),n.on(\"connect\",function(){n.id=i.generateId(t)}),this.autoConnect&&o()}function o(){~l(i.connecting,n)||i.connecting.push(n)}return n},f.prototype.destroy=function(t){var e=l(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},f.prototype.packet=function(t){c(\"writing packet %j\",t);var e=this;t.query&&0===t.type&&(t.nsp+=\"?\"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,function(n){for(var i=0;i<n.length;i++)e.engine.write(n[i],t.options);e.encoding=!1,e.processPacketQueue()}))},f.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},f.prototype.cleanup=function(){c(\"cleanup\");for(var t=this.subs.length,e=0;e<t;e++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},f.prototype.close=f.prototype.disconnect=function(){c(\"disconnect\"),this.skipReconnect=!0,this.reconnecting=!1,\"opening\"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState=\"closed\",this.engine&&this.engine.close()},f.prototype.onclose=function(t){c(\"onclose\"),this.cleanup(),this.backoff.reset(),this.readyState=\"closed\",this.emit(\"close\",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},f.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)c(\"reconnect failed\"),this.backoff.reset(),this.emitAll(\"reconnect_failed\"),this.reconnecting=!1;else{var e=this.backoff.duration();c(\"will wait %dms before reconnect attempt\",e),this.reconnecting=!0;var n=setTimeout(function(){t.skipReconnect||(c(\"attempting reconnect\"),t.emitAll(\"reconnect_attempt\",t.backoff.attempts),t.emitAll(\"reconnecting\",t.backoff.attempts),t.skipReconnect||t.open(function(e){e?(c(\"reconnect attempt error\"),t.reconnecting=!1,t.reconnect(),t.emitAll(\"reconnect_error\",e.data)):(c(\"reconnect success\"),t.onreconnect())}))},e);this.subs.push({destroy:function(){clearTimeout(n)}})}},f.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll(\"reconnect\",t)}},function(t,e,n){var i=n(19),r=n(76),o=n(85),s=n(86);e.polling=function(t){var e=!1,n=!1,s=!1!==t.jsonp;if(\"undefined\"!=typeof location){var a=\"https:\"===location.protocol,h=location.port;h||(h=a?443:80),e=t.hostname!==location.hostname||h!==t.port,n=t.secure!==a}if(t.xdomain=e,t.xscheme=n,\"open\"in new i(t)&&!t.forceJSONP)return new r(t);if(!s)throw new Error(\"JSONP disabled\");return new o(t)},e.websocket=s},function(t,e,n){var i=n(20),r=n(11),o=n(6),s=n(12),a=n(29),h=n(13)(\"engine.io-client:polling\");t.exports=l;var c=null!=new(n(19))({xdomain:!1}).responseType;function l(t){var e=t&&t.forceBase64;c&&!e||(this.supportsBinary=!1),i.call(this,t)}s(l,i),l.prototype.name=\"polling\",l.prototype.doOpen=function(){this.poll()},l.prototype.pause=function(t){var e=this;function n(){h(\"paused\"),e.readyState=\"paused\",t()}if(this.readyState=\"pausing\",this.polling||!this.writable){var i=0;this.polling&&(h(\"we are currently polling - waiting to pause\"),i++,this.once(\"pollComplete\",function(){h(\"pre-pause polling complete\"),--i||n()})),this.writable||(h(\"we are currently writing - waiting to pause\"),i++,this.once(\"drain\",function(){h(\"pre-pause writing complete\"),--i||n()}))}else n()},l.prototype.poll=function(){h(\"polling\"),this.polling=!0,this.doPoll(),this.emit(\"poll\")},l.prototype.onData=function(t){var e=this;h(\"polling got data %s\",t);o.decodePayload(t,this.socket.binaryType,function(t,n,i){if(\"opening\"===e.readyState&&e.onOpen(),\"close\"===t.type)return e.onClose(),!1;e.onPacket(t)}),\"closed\"!==this.readyState&&(this.polling=!1,this.emit(\"pollComplete\"),\"open\"===this.readyState?this.poll():h('ignoring poll - transport state \"%s\"',this.readyState))},l.prototype.doClose=function(){var t=this;function e(){h(\"writing close packet\"),t.write([{type:\"close\"}])}\"open\"===this.readyState?(h(\"transport open - closing\"),e()):(h(\"transport not open - deferring close\"),this.once(\"open\",e))},l.prototype.write=function(t){var e=this;this.writable=!1;var n=function(){e.writable=!0,e.emit(\"drain\")};o.encodePayload(t,this.supportsBinary,function(t){e.doWrite(t,n)})},l.prototype.uri=function(){var t=this.query||{},e=this.secure?\"https\":\"http\",n=\"\";return!1!==this.timestampRequests&&(t[this.timestampParam]=a()),this.supportsBinary||t.sid||(t.b64=1),t=r.encode(t),this.port&&(\"https\"===e&&443!==Number(this.port)||\"http\"===e&&80!==Number(this.port))&&(n=\":\"+this.port),t.length&&(t=\"?\"+t),e+\"://\"+(-1!==this.hostname.indexOf(\":\")?\"[\"+this.hostname+\"]\":this.hostname)+n+this.path+t}},function(t,e,n){(function(e){var i=n(18),r=Object.prototype.toString,o=\"function\"==typeof Blob||\"undefined\"!=typeof Blob&&\"[object BlobConstructor]\"===r.call(Blob),s=\"function\"==typeof File||\"undefined\"!=typeof File&&\"[object FileConstructor]\"===r.call(File);t.exports=function t(n){if(!n||\"object\"!=typeof n)return!1;if(i(n)){for(var r=0,a=n.length;r<a;r++)if(t(n[r]))return!0;return!1}if(\"function\"==typeof e&&e.isBuffer&&e.isBuffer(n)||\"function\"==typeof ArrayBuffer&&n instanceof ArrayBuffer||o&&n instanceof Blob||s&&n instanceof File)return!0;if(n.toJSON&&\"function\"==typeof n.toJSON&&1===arguments.length)return t(n.toJSON(),!0);for(var h in n)if(Object.prototype.hasOwnProperty.call(n,h)&&t(n[h]))return!0;return!1}}).call(this,n(3).Buffer)},function(t,e,n){\"use strict\";var i,r=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_\".split(\"\"),o=64,s={},a=0,h=0;function c(t){var e=\"\";do{e=r[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function l(){var t=c(+new Date);return t!==i?(a=0,i=t):t+\".\"+c(a++)}for(;h<o;h++)s[r[h]]=h;l.encode=c,l.decode=function(t){var e=0;for(h=0;h<t.length;h++)e=e*o+s[t.charAt(h)];return e},t.exports=l},function(t,e){var n=[].indexOf;t.exports=function(t,e){if(n)return t.indexOf(e);for(var i=0;i<t.length;++i)if(t[i]===e)return i;return-1}},function(t,e,n){var i=n(17),r=n(5),o=n(88),s=n(32),a=n(33),h=n(10)(\"socket.io-client:socket\"),c=n(11),l=n(28);t.exports=f;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=r.prototype.emit;function f(t,e,n){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}r(f.prototype),f.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[s(t,\"open\",a(this,\"onopen\")),s(t,\"packet\",a(this,\"onpacket\")),s(t,\"close\",a(this,\"onclose\"))]}},f.prototype.open=f.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),\"open\"===this.io.readyState&&this.onopen(),this.emit(\"connecting\"),this)},f.prototype.send=function(){var t=o(arguments);return t.unshift(\"message\"),this.emit.apply(this,t),this},f.prototype.emit=function(t){if(u.hasOwnProperty(t))return p.apply(this,arguments),this;var e=o(arguments),n={type:(void 0!==this.flags.binary?this.flags.binary:l(e))?i.BINARY_EVENT:i.EVENT,data:e,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,\"function\"==typeof e[e.length-1]&&(h(\"emitting packet with ack id %d\",this.ids),this.acks[this.ids]=e.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},f.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},f.prototype.onopen=function(){if(h(\"transport is open - connecting\"),\"/\"!==this.nsp)if(this.query){var t=\"object\"==typeof this.query?c.encode(this.query):this.query;h(\"sending connect packet with query %s\",t),this.packet({type:i.CONNECT,query:t})}else this.packet({type:i.CONNECT})},f.prototype.onclose=function(t){h(\"close (%s)\",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit(\"disconnect\",t)},f.prototype.onpacket=function(t){var e=t.nsp===this.nsp,n=t.type===i.ERROR&&\"/\"===t.nsp;if(e||n)switch(t.type){case i.CONNECT:this.onconnect();break;case i.EVENT:case i.BINARY_EVENT:this.onevent(t);break;case i.ACK:case i.BINARY_ACK:this.onack(t);break;case i.DISCONNECT:this.ondisconnect();break;case i.ERROR:this.emit(\"error\",t.data)}},f.prototype.onevent=function(t){var e=t.data||[];h(\"emitting event %j\",e),null!=t.id&&(h(\"attaching ack callback to event\"),e.push(this.ack(t.id))),this.connected?p.apply(this,e):this.receiveBuffer.push(e)},f.prototype.ack=function(t){var e=this,n=!1;return function(){if(!n){n=!0;var r=o(arguments);h(\"sending ack %j\",r),e.packet({type:l(r)?i.BINARY_ACK:i.ACK,id:t,data:r})}}},f.prototype.onack=function(t){var e=this.acks[t.id];\"function\"==typeof e?(h(\"calling ack %s with %j\",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):h(\"bad ack %s\",t.id)},f.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit(\"connect\"),this.emitBuffered()},f.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)p.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},f.prototype.ondisconnect=function(){h(\"server disconnect (%s)\",this.nsp),this.destroy(),this.onclose(\"io server disconnect\")},f.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},f.prototype.close=f.prototype.disconnect=function(){return this.connected&&(h(\"performing disconnect (%s)\",this.nsp),this.packet({type:i.DISCONNECT})),this.destroy(),this.connected&&this.onclose(\"io client disconnect\"),this},f.prototype.compress=function(t){return this.flags.compress=t,this},f.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e,n){return t.on(e,n),{destroy:function(){t.removeListener(e,n)}}}},function(t,e){var n=[].slice;t.exports=function(t,e){if(\"string\"==typeof e&&(e=t[e]),\"function\"!=typeof e)throw new Error(\"bind() requires a function\");var i=n.call(arguments,2);return function(){return e.apply(t,i.concat(n.call(arguments)))}}},function(t,e,n){(function(t){e.fetch=a(t.fetch)&&a(t.ReadableStream),e.writableStream=a(t.WritableStream),e.abortController=a(t.AbortController),e.blobConstructor=!1;try{new Blob([new ArrayBuffer(1)]),e.blobConstructor=!0}catch(t){}var n;function i(){if(void 0!==n)return n;if(t.XMLHttpRequest){n=new t.XMLHttpRequest;try{n.open(\"GET\",t.XDomainRequest?\"/\":\"https://example.com\")}catch(t){n=null}}else n=null;return n}function r(t){var e=i();if(!e)return!1;try{return e.responseType=t,e.responseType===t}catch(t){}return!1}var o=void 0!==t.ArrayBuffer,s=o&&a(t.ArrayBuffer.prototype.slice);function a(t){return\"function\"==typeof t}e.arraybuffer=e.fetch||o&&r(\"arraybuffer\"),e.msstream=!e.fetch&&s&&r(\"ms-stream\"),e.mozchunkedarraybuffer=!e.fetch&&o&&r(\"moz-chunked-arraybuffer\"),e.overrideMimeType=e.fetch||!!i()&&a(i().overrideMimeType),e.vbArray=a(t.VBArray),n=null}).call(this,n(0))},function(t,e,n){(function(t,i,r){var o=n(34),s=n(4),a=n(36),h=e.readyStates={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},c=e.IncomingMessage=function(e,n,s,h){var c=this;if(a.Readable.call(c),c._mode=s,c.headers={},c.rawHeaders=[],c.trailers={},c.rawTrailers=[],c.on(\"end\",function(){t.nextTick(function(){c.emit(\"close\")})}),\"fetch\"===s){if(c._fetchResponse=n,c.url=n.url,c.statusCode=n.status,c.statusMessage=n.statusText,n.headers.forEach(function(t,e){c.headers[e.toLowerCase()]=t,c.rawHeaders.push(e,t)}),o.writableStream){var l=new WritableStream({write:function(t){return new Promise(function(e,n){c._destroyed?n():c.push(new i(t))?e():c._resumeFetch=e})},close:function(){r.clearTimeout(h),c._destroyed||c.push(null)},abort:function(t){c._destroyed||c.emit(\"error\",t)}});try{return void n.body.pipeTo(l).catch(function(t){r.clearTimeout(h),c._destroyed||c.emit(\"error\",t)})}catch(t){}}var u=n.body.getReader();!function t(){u.read().then(function(e){if(!c._destroyed){if(e.done)return r.clearTimeout(h),void c.push(null);c.push(new i(e.value)),t()}}).catch(function(t){r.clearTimeout(h),c._destroyed||c.emit(\"error\",t)})}()}else{if(c._xhr=e,c._pos=0,c.url=e.responseURL,c.statusCode=e.status,c.statusMessage=e.statusText,e.getAllResponseHeaders().split(/\\r?\\n/).forEach(function(t){var e=t.match(/^([^:]+):\\s*(.*)/);if(e){var n=e[1].toLowerCase();\"set-cookie\"===n?(void 0===c.headers[n]&&(c.headers[n]=[]),c.headers[n].push(e[2])):void 0!==c.headers[n]?c.headers[n]+=\", \"+e[2]:c.headers[n]=e[2],c.rawHeaders.push(e[1],e[2])}}),c._charset=\"x-user-defined\",!o.overrideMimeType){var p=c.rawHeaders[\"mime-type\"];if(p){var f=p.match(/;\\s*charset=([^;])(;|$)/);f&&(c._charset=f[1].toLowerCase())}c._charset||(c._charset=\"utf-8\")}}};s(c,a.Readable),c.prototype._read=function(){var t=this._resumeFetch;t&&(this._resumeFetch=null,t())},c.prototype._onXHRProgress=function(){var t=this,e=t._xhr,n=null;switch(t._mode){case\"text:vbarray\":if(e.readyState!==h.DONE)break;try{n=new r.VBArray(e.responseBody).toArray()}catch(t){}if(null!==n){t.push(new i(n));break}case\"text\":try{n=e.responseText}catch(e){t._mode=\"text:vbarray\";break}if(n.length>t._pos){var o=n.substr(t._pos);if(\"x-user-defined\"===t._charset){for(var s=new i(o.length),a=0;a<o.length;a++)s[a]=255&o.charCodeAt(a);t.push(s)}else t.push(o,t._charset);t._pos=n.length}break;case\"arraybuffer\":if(e.readyState!==h.DONE||!e.response)break;n=e.response,t.push(new i(new Uint8Array(n)));break;case\"moz-chunked-arraybuffer\":if(n=e.response,e.readyState!==h.LOADING||!n)break;t.push(new i(new Uint8Array(n)));break;case\"ms-stream\":if(n=e.response,e.readyState!==h.LOADING)break;var c=new r.MSStreamReader;c.onprogress=function(){c.result.byteLength>t._pos&&(t.push(new i(new Uint8Array(c.result.slice(t._pos)))),t._pos=c.result.byteLength)},c.onload=function(){t.push(null)},c.readAsArrayBuffer(n)}t._xhr.readyState===h.DONE&&\"ms-stream\"!==t._mode&&t.push(null)}}).call(this,n(2),n(3).Buffer,n(0))},function(t,e,n){(e=t.exports=n(37)).Stream=e,e.Readable=e,e.Writable=n(41),e.Duplex=n(7),e.Transform=n(43),e.PassThrough=n(98)},function(t,e,n){\"use strict\";(function(e,i){var r=n(14);t.exports=b;var o,s=n(91);b.ReadableState=g;n(38).EventEmitter;var a=function(t,e){return t.listeners(e).length},h=n(39),c=n(15).Buffer,l=e.Uint8Array||function(){};var u=n(9);u.inherits=n(4);var p=n(92),f=void 0;f=p&&p.debuglog?p.debuglog(\"stream\"):function(){};var d,y=n(93),v=n(40);u.inherits(b,h);var m=[\"error\",\"close\",\"destroy\",\"pause\",\"resume\"];function g(t,e){t=t||{};var i=e instanceof(o=o||n(7));this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var r=t.highWaterMark,s=t.readableHighWaterMark,a=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(s||0===s)?s:a,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||\"utf8\",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=n(42).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function b(t){if(o=o||n(7),!(this instanceof b))return new b(t);this._readableState=new g(t,this),this.readable=!0,t&&(\"function\"==typeof t.read&&(this._read=t.read),\"function\"==typeof t.destroy&&(this._destroy=t.destroy)),h.call(this)}function w(t,e,n,i,r){var o,s=t._readableState;null===e?(s.reading=!1,function(t,e){if(e.ended)return;if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,S(t)}(t,s)):(r||(o=function(t,e){var n;i=e,c.isBuffer(i)||i instanceof l||\"string\"==typeof e||void 0===e||t.objectMode||(n=new TypeError(\"Invalid non-string/buffer chunk\"));var i;return n}(s,e)),o?t.emit(\"error\",o):s.objectMode||e&&e.length>0?(\"string\"==typeof e||s.objectMode||Object.getPrototypeOf(e)===c.prototype||(e=function(t){return c.from(t)}(e)),i?s.endEmitted?t.emit(\"error\",new Error(\"stream.unshift() after end event\")):x(t,s,e,!0):s.ended?t.emit(\"error\",new Error(\"stream.push() after EOF\")):(s.reading=!1,s.decoder&&!n?(e=s.decoder.write(e),s.objectMode||0!==e.length?x(t,s,e,!1):A(t,s)):x(t,s,e,!1))):i||(s.reading=!1));return function(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(s)}function x(t,e,n,i){e.flowing&&0===e.length&&!e.sync?(t.emit(\"data\",n),t.read(0)):(e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&S(t)),A(t,e)}Object.defineProperty(b.prototype,\"destroyed\",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),b.prototype.destroy=v.destroy,b.prototype._undestroy=v.undestroy,b.prototype._destroy=function(t,e){this.push(null),e(t)},b.prototype.push=function(t,e){var n,i=this._readableState;return i.objectMode?n=!0:\"string\"==typeof t&&((e=e||i.defaultEncoding)!==i.encoding&&(t=c.from(t,e),e=\"\"),n=!0),w(this,t,e,!1,n)},b.prototype.unshift=function(t){return w(this,t,null,!0,!1)},b.prototype.isPaused=function(){return!1===this._readableState.flowing},b.prototype.setEncoding=function(t){return d||(d=n(42).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var E=8388608;function C(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function(t){return t>=E?t=E:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function S(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f(\"emitReadable\",e.flowing),e.emittedReadable=!0,e.sync?r.nextTick(T,t):T(t))}function T(t){f(\"emit readable\"),t.emit(\"readable\"),P(t)}function A(t,e){e.readingMore||(e.readingMore=!0,r.nextTick(B,t,e))}function B(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f(\"maybeReadMore read 0\"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function R(t){f(\"readable nexttick read 0\"),t.read(0)}function _(t,e){e.reading||(f(\"resume read 0\"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit(\"resume\"),P(t),e.flowing&&!e.reading&&t.read(0)}function P(t){var e=t._readableState;for(f(\"flow\",e.flowing);e.flowing&&null!==t.read(););}function F(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(\"\"):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function(t,e,n){var i;t<e.head.data.length?(i=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):i=t===e.head.data.length?e.shift():n?function(t,e){var n=e.head,i=1,r=n.data;t-=r.length;for(;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(s===o.length?r+=o:r+=o.slice(0,t),0===(t-=s)){s===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++i}return e.length-=i,r}(t,e):function(t,e){var n=c.allocUnsafe(t),i=e.head,r=1;i.data.copy(n),t-=i.data.length;for(;i=i.next;){var o=i.data,s=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,s),0===(t-=s)){s===o.length?(++r,i.next?e.head=i.next:e.head=e.tail=null):(e.head=i,i.data=o.slice(s));break}++r}return e.length-=r,n}(t,e);return i}(t,e.buffer,e.decoder),n);var n}function I(t){var e=t._readableState;if(e.length>0)throw new Error('\"endReadable()\" called on non-empty stream');e.endEmitted||(e.ended=!0,r.nextTick(k,e,t))}function k(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit(\"end\"))}function M(t,e){for(var n=0,i=t.length;n<i;n++)if(t[n]===e)return n;return-1}b.prototype.read=function(t){f(\"read\",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f(\"read: emitReadable\",e.length,e.ended),0===e.length&&e.ended?I(this):S(this),null;if(0===(t=C(t,e))&&e.ended)return 0===e.length&&I(this),null;var i,r=e.needReadable;return f(\"need readable\",r),(0===e.length||e.length-t<e.highWaterMark)&&f(\"length less than watermark\",r=!0),e.ended||e.reading?f(\"reading or ended\",r=!1):r&&(f(\"do read\"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=C(n,e))),null===(i=t>0?F(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&I(this)),null!==i&&this.emit(\"data\",i),i},b.prototype._read=function(t){this.emit(\"error\",new Error(\"_read() is not implemented\"))},b.prototype.pipe=function(t,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,f(\"pipe count=%d opts=%j\",o.pipesCount,e);var h=(!e||!1!==e.end)&&t!==i.stdout&&t!==i.stderr?l:b;function c(e,i){f(\"onunpipe\"),e===n&&i&&!1===i.hasUnpiped&&(i.hasUnpiped=!0,f(\"cleanup\"),t.removeListener(\"close\",m),t.removeListener(\"finish\",g),t.removeListener(\"drain\",u),t.removeListener(\"error\",v),t.removeListener(\"unpipe\",c),n.removeListener(\"end\",l),n.removeListener(\"end\",b),n.removeListener(\"data\",y),p=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||u())}function l(){f(\"onend\"),t.end()}o.endEmitted?r.nextTick(h):n.once(\"end\",h),t.on(\"unpipe\",c);var u=function(t){return function(){var e=t._readableState;f(\"pipeOnDrain\",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&a(t,\"data\")&&(e.flowing=!0,P(t))}}(n);t.on(\"drain\",u);var p=!1;var d=!1;function y(e){f(\"ondata\"),d=!1,!1!==t.write(e)||d||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==M(o.pipes,t))&&!p&&(f(\"false write response, pause\",n._readableState.awaitDrain),n._readableState.awaitDrain++,d=!0),n.pause())}function v(e){f(\"onerror\",e),b(),t.removeListener(\"error\",v),0===a(t,\"error\")&&t.emit(\"error\",e)}function m(){t.removeListener(\"finish\",g),b()}function g(){f(\"onfinish\"),t.removeListener(\"close\",m),b()}function b(){f(\"unpipe\"),n.unpipe(t)}return n.on(\"data\",y),function(t,e,n){if(\"function\"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?s(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,\"error\",v),t.once(\"close\",m),t.once(\"finish\",g),t.emit(\"pipe\",n),o.flowing||(f(\"pipe resume\"),n.resume()),t},b.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit(\"unpipe\",this,n),this);if(!t){var i=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<r;o++)i[o].emit(\"unpipe\",this,n);return this}var s=M(e.pipes,t);return-1===s?this:(e.pipes.splice(s,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit(\"unpipe\",this,n),this)},b.prototype.on=function(t,e){var n=h.prototype.on.call(this,t,e);if(\"data\"===t)!1!==this._readableState.flowing&&this.resume();else if(\"readable\"===t){var i=this._readableState;i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.emittedReadable=!1,i.reading?i.length&&S(this):r.nextTick(R,this))}return n},b.prototype.addListener=b.prototype.on,b.prototype.resume=function(){var t=this._readableState;return t.flowing||(f(\"resume\"),t.flowing=!0,function(t,e){e.resumeScheduled||(e.resumeScheduled=!0,r.nextTick(_,t,e))}(this,t)),this},b.prototype.pause=function(){return f(\"call pause flowing=%j\",this._readableState.flowing),!1!==this._readableState.flowing&&(f(\"pause\"),this._readableState.flowing=!1,this.emit(\"pause\")),this},b.prototype.wrap=function(t){var e=this,n=this._readableState,i=!1;for(var r in t.on(\"end\",function(){if(f(\"wrapped end\"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on(\"data\",function(r){(f(\"wrapped data\"),n.decoder&&(r=n.decoder.write(r)),n.objectMode&&null==r)||(n.objectMode||r&&r.length)&&(e.push(r)||(i=!0,t.pause()))}),t)void 0===this[r]&&\"function\"==typeof t[r]&&(this[r]=function(e){return function(){return t[e].apply(t,arguments)}}(r));for(var o=0;o<m.length;o++)t.on(m[o],this.emit.bind(this,m[o]));return this._read=function(e){f(\"wrapped _read\",e),i&&(i=!1,t.resume())},this},Object.defineProperty(b.prototype,\"readableHighWaterMark\",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),b._fromList=F}).call(this,n(0),n(2))},function(t,e,n){\"use strict\";var i,r=\"object\"==typeof Reflect?Reflect:null,o=r&&\"function\"==typeof r.apply?r.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};i=r&&\"function\"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function a(){a.init.call(this)}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var h=10;function c(t){return void 0===t._maxListeners?a.defaultMaxListeners:t._maxListeners}function l(t,e,n,i){var r,o,s,a;if(\"function\"!=typeof n)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof n);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit(\"newListener\",e,n.listener?n.listener:n),o=t._events),s=o[e]),void 0===s)s=o[e]=n,++t._eventsCount;else if(\"function\"==typeof s?s=o[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=c(t))>0&&s.length>r&&!s.warned){s.warned=!0;var h=new Error(\"Possible EventEmitter memory leak detected. \"+s.length+\" \"+String(e)+\" listeners added. Use emitter.setMaxListeners() to increase limit\");h.name=\"MaxListenersExceededWarning\",h.emitter=t,h.type=e,h.count=s.length,a=h,console&&console.warn&&console.warn(a)}return t}function u(t,e,n){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},r=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}.bind(i);return r.listener=n,i.wrapFn=r,r}function p(t,e,n){var i=t._events;if(void 0===i)return[];var r=i[e];return void 0===r?[]:\"function\"==typeof r?n?[r.listener||r]:[r]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(r):d(r,r.length)}function f(t){var e=this._events;if(void 0!==e){var n=e[t];if(\"function\"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(t,e){for(var n=new Array(e),i=0;i<e;++i)n[i]=t[i];return n}Object.defineProperty(a,\"defaultMaxListeners\",{enumerable:!0,get:function(){return h},set:function(t){if(\"number\"!=typeof t||t<0||s(t))throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received '+t+\".\");h=t}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(t){if(\"number\"!=typeof t||t<0||s(t))throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received '+t+\".\");return this._maxListeners=t,this},a.prototype.getMaxListeners=function(){return c(this)},a.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i=\"error\"===t,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error(\"Unhandled error.\"+(s?\" (\"+s.message+\")\":\"\"));throw a.context=s,a}var h=r[t];if(void 0===h)return!1;if(\"function\"==typeof h)o(h,this,e);else{var c=h.length,l=d(h,c);for(n=0;n<c;++n)o(l[n],this,e)}return!0},a.prototype.addListener=function(t,e){return l(this,t,e,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(t,e){return l(this,t,e,!0)},a.prototype.once=function(t,e){if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e);return this.on(t,u(this,t,e)),this},a.prototype.prependOnceListener=function(t,e){if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,u(this,t,e)),this},a.prototype.removeListener=function(t,e){var n,i,r,o,s;if(\"function\"!=typeof e)throw new TypeError('The \"listener\" argument must be of type Function. Received type '+typeof e);if(void 0===(i=this._events))return this;if(void 0===(n=i[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit(\"removeListener\",t,n.listener||e));else if(\"function\"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,r),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit(\"removeListener\",t,s||e)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(t){var e,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)\"removeListener\"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners(\"removeListener\"),this._events=Object.create(null),this._eventsCount=0,this}if(\"function\"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(i=e.length-1;i>=0;i--)this.removeListener(t,e[i]);return this},a.prototype.listeners=function(t){return p(this,t,!0)},a.prototype.rawListeners=function(t){return p(this,t,!1)},a.listenerCount=function(t,e){return\"function\"==typeof t.listenerCount?t.listenerCount(e):f.call(t,e)},a.prototype.listenerCount=f,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(t,e,n){t.exports=n(38).EventEmitter},function(t,e,n){\"use strict\";var i=n(14);function r(t,e){t.emit(\"error\",e)}t.exports={destroy:function(t,e){var n=this,o=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return o||s?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||i.nextTick(r,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(i.nextTick(r,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){\"use strict\";(function(e,i,r){var o=n(14);function s(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function(t,e,n){var i=t.entry;t.entry=null;for(;i;){var r=i.callback;e.pendingcb--,r(n),i=i.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=g;var a,h=!e.browser&&[\"v0.10\",\"v0.9.\"].indexOf(e.version.slice(0,5))>-1?i:o.nextTick;g.WritableState=m;var c=n(9);c.inherits=n(4);var l={deprecate:n(97)},u=n(39),p=n(15).Buffer,f=r.Uint8Array||function(){};var d,y=n(40);function v(){}function m(t,e){a=a||n(7),t=t||{};var i=e instanceof a;this.objectMode=!!t.objectMode,i&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var r=t.highWaterMark,c=t.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:i&&(c||0===c)?c:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var u=!1===t.decodeStrings;this.decodeStrings=!u,this.defaultEncoding=t.defaultEncoding||\"utf8\",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function(t,e){var n=t._writableState,i=n.sync,r=n.writecb;if(function(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function(t,e,n,i,r){--e.pendingcb,n?(o.nextTick(r,i),o.nextTick(S,t,e),t._writableState.errorEmitted=!0,t.emit(\"error\",i)):(r(i),t._writableState.errorEmitted=!0,t.emit(\"error\",i),S(t,e))}(t,n,i,e,r);else{var s=E(n);s||n.corked||n.bufferProcessing||!n.bufferedRequest||x(t,n),i?h(w,t,n,s,r):w(t,n,s,r)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new s(this)}function g(t){if(a=a||n(7),!(d.call(g,this)||this instanceof a))return new g(t);this._writableState=new m(t,this),this.writable=!0,t&&(\"function\"==typeof t.write&&(this._write=t.write),\"function\"==typeof t.writev&&(this._writev=t.writev),\"function\"==typeof t.destroy&&(this._destroy=t.destroy),\"function\"==typeof t.final&&(this._final=t.final)),u.call(this)}function b(t,e,n,i,r,o,s){e.writelen=i,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(r,e.onwrite):t._write(r,o,e.onwrite),e.sync=!1}function w(t,e,n,i){n||function(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit(\"drain\"))}(t,e),e.pendingcb--,i(),S(t,e)}function x(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var i=e.bufferedRequestCount,r=new Array(i),o=e.corkedRequestsFree;o.entry=n;for(var a=0,h=!0;n;)r[a]=n,n.isBuf||(h=!1),n=n.next,a+=1;r.allBuffers=h,b(t,e,!0,e.length,r,\"\",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new s(e),e.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,l=n.encoding,u=n.callback;if(b(t,e,!1,e.objectMode?1:c.length,c,l,u),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function E(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function C(t,e){t._final(function(n){e.pendingcb--,n&&t.emit(\"error\",n),e.prefinished=!0,t.emit(\"prefinish\"),S(t,e)})}function S(t,e){var n=E(e);return n&&(!function(t,e){e.prefinished||e.finalCalled||(\"function\"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(C,t,e)):(e.prefinished=!0,t.emit(\"prefinish\")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit(\"finish\"))),n}c.inherits(g,u),m.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(m.prototype,\"buffer\",{get:l.deprecate(function(){return this.getBuffer()},\"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.\",\"DEP0003\")})}catch(t){}}(),\"function\"==typeof Symbol&&Symbol.hasInstance&&\"function\"==typeof Function.prototype[Symbol.hasInstance]?(d=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(t){return!!d.call(this,t)||this===g&&(t&&t._writableState instanceof m)}})):d=function(t){return t instanceof this},g.prototype.pipe=function(){this.emit(\"error\",new Error(\"Cannot pipe, not readable\"))},g.prototype.write=function(t,e,n){var i,r=this._writableState,s=!1,a=!r.objectMode&&(i=t,p.isBuffer(i)||i instanceof f);return a&&!p.isBuffer(t)&&(t=function(t){return p.from(t)}(t)),\"function\"==typeof e&&(n=e,e=null),a?e=\"buffer\":e||(e=r.defaultEncoding),\"function\"!=typeof n&&(n=v),r.ended?function(t,e){var n=new Error(\"write after end\");t.emit(\"error\",n),o.nextTick(e,n)}(this,n):(a||function(t,e,n,i){var r=!0,s=!1;return null===n?s=new TypeError(\"May not write null values to stream\"):\"string\"==typeof n||void 0===n||e.objectMode||(s=new TypeError(\"Invalid non-string/buffer chunk\")),s&&(t.emit(\"error\",s),o.nextTick(i,s),r=!1),r}(this,r,t,n))&&(r.pendingcb++,s=function(t,e,n,i,r,o){if(!n){var s=function(t,e,n){t.objectMode||!1===t.decodeStrings||\"string\"!=typeof e||(e=p.from(e,n));return e}(e,i,r);i!==s&&(n=!0,r=\"buffer\",i=s)}var a=e.objectMode?1:i.length;e.length+=a;var h=e.length<e.highWaterMark;h||(e.needDrain=!0);if(e.writing||e.corked){var c=e.lastBufferedRequest;e.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},c?c.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else b(t,e,!1,a,i,r,o);return h}(this,r,a,t,e,n)),s},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||x(this,t))},g.prototype.setDefaultEncoding=function(t){if(\"string\"==typeof t&&(t=t.toLowerCase()),!([\"hex\",\"utf8\",\"utf-8\",\"ascii\",\"binary\",\"base64\",\"ucs2\",\"ucs-2\",\"utf16le\",\"utf-16le\",\"raw\"].indexOf((t+\"\").toLowerCase())>-1))throw new TypeError(\"Unknown encoding: \"+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(g.prototype,\"writableHighWaterMark\",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(t,e,n){n(new Error(\"_write() is not implemented\"))},g.prototype._writev=null,g.prototype.end=function(t,e,n){var i=this._writableState;\"function\"==typeof t?(n=t,t=null,e=null):\"function\"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),i.corked&&(i.corked=1,this.uncork()),i.ending||i.finished||function(t,e,n){e.ending=!0,S(t,e),n&&(e.finished?o.nextTick(n):t.once(\"finish\",n));e.ended=!0,t.writable=!1}(this,i,n)},Object.defineProperty(g.prototype,\"destroyed\",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),g.prototype.destroy=y.destroy,g.prototype._undestroy=y.undestroy,g.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,n(2),n(95).setImmediate,n(0))},function(t,e,n){\"use strict\";var i=n(15).Buffer,r=i.isEncoding||function(t){switch((t=\"\"+t)&&t.toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"binary\":case\"base64\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":case\"raw\":return!0;default:return!1}};function o(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return\"utf8\";for(var e;;)switch(t){case\"utf8\":case\"utf-8\":return\"utf8\";case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return\"utf16le\";case\"latin1\":case\"binary\":return\"latin1\";case\"base64\":case\"ascii\":case\"hex\":return t;default:if(e)return;t=(\"\"+t).toLowerCase(),e=!0}}(t);if(\"string\"!=typeof e&&(i.isEncoding===r||!r(t)))throw new Error(\"Unknown encoding: \"+t);return e||t}(t),this.encoding){case\"utf16le\":this.text=h,this.end=c,e=4;break;case\"utf8\":this.fillLast=a,e=4;break;case\"base64\":this.text=l,this.end=u,e=3;break;default:return this.write=p,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(e)}function s(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function a(t){var e=this.lastTotal-this.lastNeed,n=function(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,\"�\";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,\"�\";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,\"�\"}}(this,t);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function h(t,e){if((t.length-e)%2==0){var n=t.toString(\"utf16le\",e);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString(\"utf16le\",e,t.length-1)}function c(t){var e=t&&t.length?this.write(t):\"\";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString(\"utf16le\",0,n)}return e}function l(t,e){var n=(t.length-e)%3;return 0===n?t.toString(\"base64\",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString(\"base64\",e,t.length-n))}function u(t){var e=t&&t.length?this.write(t):\"\";return this.lastNeed?e+this.lastChar.toString(\"base64\",0,3-this.lastNeed):e}function p(t){return t.toString(this.encoding)}function f(t){return t&&t.length?this.write(t):\"\"}e.StringDecoder=o,o.prototype.write=function(t){if(0===t.length)return\"\";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return\"\";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||\"\"},o.prototype.end=function(t){var e=t&&t.length?this.write(t):\"\";return this.lastNeed?e+\"�\":e},o.prototype.text=function(t,e){var n=function(t,e,n){var i=e.length-1;if(i<n)return 0;var r=s(e[i]);if(r>=0)return r>0&&(t.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=s(e[i]))>=0)return r>0&&(t.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=s(e[i]))>=0)return r>0&&(2===r?r=0:t.lastNeed=r-3),r;return 0}(this,t,e);if(!this.lastNeed)return t.toString(\"utf8\",e);this.lastTotal=n;var i=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,i),t.toString(\"utf8\",e,i)},o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){\"use strict\";t.exports=s;var i=n(7),r=n(9);function o(t,e){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(!i)return this.emit(\"error\",new Error(\"write callback called multiple times\"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),i(t);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function s(t){if(!(this instanceof s))return new s(t);i.call(this,t),this._transformState={afterTransform:o.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&(\"function\"==typeof t.transform&&(this._transform=t.transform),\"function\"==typeof t.flush&&(this._flush=t.flush)),this.on(\"prefinish\",a)}function a(){var t=this;\"function\"==typeof this._flush?this._flush(function(e,n){h(t,e,n)}):h(this,null,null)}function h(t,e,n){if(e)return t.emit(\"error\",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error(\"Calling transform done when ws.length != 0\");if(t._transformState.transforming)throw new Error(\"Calling transform done when still transforming\");return t.push(null)}r.inherits=n(4),r.inherits(s,i),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,i.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,n){throw new Error(\"_transform() is not implemented\")},s.prototype._write=function(t,e,n){var i=this._transformState;if(i.writecb=n,i.writechunk=t,i.writeencoding=e,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var n=this;i.prototype._destroy.call(this,t,function(t){e(t),n.emit(\"close\")})}},function(t,e,n){\"use strict\";(function(t){var i=n(21),r=n(8),o=n.n(r),s=n(45),a=n(22);e.a=class{constructor(e){const n=\"undefined\"==typeof window;(n?t:window).LANCE={gameEngine:this};const r={GameWorld:i.a,traceLevel:a.a.TRACE_NONE};n||(r.clientIDSpace=1e6),this.options=Object.assign(r,e),this.playerId=NaN;let s=new o.a;this.on=s.on,this.once=s.once,this.removeListener=s.off,this.off=s.off,this.emit=s.emit,this.trace=new a.a({traceLevel:this.options.traceLevel})}findLocalShadow(t){for(let e of Object.keys(this.world.objects)){if(Number(e)<this.options.clientIDSpace)continue;let n=this.world.objects[e];if(n.hasOwnProperty(\"inputId\")&&n.inputId===t.inputId)return n}return null}initWorld(t){this.world=new i.a,this.options.clientIDSpace&&(this.world.idCount=this.options.clientIDSpace),this.worldSettings=Object.assign({},t)}start(){this.trace.info(()=>\"========== game engine started ==========\"),this.initWorld(),this.timer=new s.a,this.timer.play(),this.on(\"postStep\",(t,e)=>{e||this.timer.tick()}),this.emit(\"start\",{timestamp:(new Date).getTime()})}step(t,e,n,i){if(i)return n&&(n/=1e3),void this.physicsEngine.step(n,s);if(void 0===t)throw new Error(\"game engine does not forward argument isReenact to super class\");t=Boolean(t);let r=++this.world.stepCount,o=this.options.clientIDSpace;function s(e){return!t||e.id<o}this.emit(\"preStep\",{step:r,isReenact:t,dt:n}),this.physicsEngine&&!this.ignorePhysics&&(n&&(n/=1e3),this.physicsEngine.step(n,s)),this.world.forEachObject((e,n)=>{\"function\"==typeof n.refreshFromPhysics&&n.refreshFromPhysics(),this.trace.trace(()=>`object[${e}] after ${t?\"reenact\":\"step\"} : ${n.toString()}`)}),this.emit(\"postStep\",{step:r,isReenact:t})}addObjectToWorld(t){if(Number(t.id)>=this.options.clientIDSpace){let e=!1;if(this.world.forEachObject((n,i)=>{if(i.hasOwnProperty(\"inputId\")&&i.inputId===t.inputId)return e=!0,!1}),e)return this.trace.info(()=>`========== shadow object NOT added ${t.toString()} ==========`),null}return this.world.addObject(t),\"function\"==typeof t.onAddToWorld&&t.onAddToWorld(this),this.emit(\"objectAdded\",t),this.trace.info(()=>`========== object added ${t.toString()} ==========`),t}processInput(t,e,n){this.trace.info(()=>`game engine processing input[${t.messageIndex}] <${t.input}> from playerId ${e}`)}removeObjectFromWorld(t){\"object\"==typeof t&&(t=t.id);let e=this.world.objects[t];if(!e)throw new Error(`Game attempted to remove a game object which doesn't (or never did) exist, id=${t}`);this.trace.info(()=>`========== destroying object ${e.toString()} ==========`),\"function\"==typeof e.onRemoveFromWorld&&e.onRemoveFromWorld(this),this.emit(\"objectDestroyed\",e),this.world.removeObject(t)}isOwnedByPlayer(t){return t.playerId==this.playerId}registerClasses(t){}getPlayerGameOverResult(){return null}}}).call(this,n(0))},function(t,e,n){\"use strict\";n.d(e,\"a\",function(){return i});class i{constructor(){this.currentTime=0,this.isActive=!1,this.idCounter=0,this.events={}}play(){this.isActive=!0}tick(){let t,e;if(this.isActive)for(e in this.currentTime++,this.events)(t=this.events[e])&&(\"repeat\"==t.type&&(this.currentTime-t.startOffset)%t.time==0&&t.callback.apply(t.thisContext,t.args),\"single\"==t.type&&(this.currentTime-t.startOffset)%t.time==0&&(t.callback.apply(t.thisContext,t.args),t.destroy()))}destroyEvent(t){delete this.events[t]}loop(t,e){let n=new r(this,r.TYPES.repeat,t,e);return this.events[n.id]=n,n}add(t,e,n,i){let o=new r(this,r.TYPES.single,t,e,n,i);return this.events[o.id]=o,o}destroy(t){delete this.events[t]}}class r{constructor(t,e,n,i,r,o){this.id=++t.idCounter,this.timer=t,this.type=e,this.time=n,this.callback=i,this.startOffset=t.currentTime,this.thisContext=r,this.args=o,this.destroy=function(){this.timer.destroy(this.id)}}}r.TYPES={repeat:\"repeat\",single:\"single\"}},function(t,e,n){var i=n(63),r=n(17),o=n(25),s=n(10)(\"socket.io-client\");t.exports=e=h;var a=e.managers={};function h(t,e){\"object\"==typeof t&&(e=t,t=void 0),e=e||{};var n,r=i(t),h=r.source,c=r.id,l=r.path,u=a[c]&&l in a[c].nsps;return e.forceNew||e[\"force new connection\"]||!1===e.multiplex||u?(s(\"ignoring socket cache for %s\",h),n=o(h,e)):(a[c]||(s(\"new io instance for %s\",h),a[c]=o(h,e)),n=a[c]),r.query&&!e.query&&(e.query=r.query),n.socket(r.path,e)}e.protocol=r.protocol,e.connect=h,e.Manager=n(25),e.Socket=n(31)},function(t,e,n){(function(t){var i=n(90),r=n(35),o=n(100),s=n(101),a=n(102),h=e;h.request=function(e,n){e=\"string\"==typeof e?a.parse(e):o(e);var r=-1===t.location.protocol.search(/^https?:$/)?\"http:\":\"\",s=e.protocol||r,h=e.hostname||e.host,c=e.port,l=e.path||\"/\";h&&-1!==h.indexOf(\":\")&&(h=\"[\"+h+\"]\"),e.url=(h?s+\"//\"+h:\"\")+(c?\":\"+c:\"\")+l,e.method=(e.method||\"GET\").toUpperCase(),e.headers=e.headers||{};var u=new i(e);return n&&u.on(\"response\",n),u},h.get=function(t,e){var n=h.request(t,e);return n.end(),n},h.ClientRequest=i,h.IncomingMessage=r.IncomingMessage,h.Agent=function(){},h.Agent.defaultMaxSockets=4,h.globalAgent=new h.Agent,h.STATUS_CODES=s,h.METHODS=[\"CHECKOUT\",\"CONNECT\",\"COPY\",\"DELETE\",\"GET\",\"HEAD\",\"LOCK\",\"M-SEARCH\",\"MERGE\",\"MKACTIVITY\",\"MKCOL\",\"MOVE\",\"NOTIFY\",\"OPTIONS\",\"PATCH\",\"POST\",\"PROPFIND\",\"PROPPATCH\",\"PURGE\",\"PUT\",\"REPORT\",\"SEARCH\",\"SUBSCRIBE\",\"TRACE\",\"UNLOCK\",\"UNSUBSCRIBE\"]}).call(this,n(0))},function(t,e,n){\"use strict\";var i=n(49),r=n(57),o=n(58),s=n(59);(t.exports=function(t,e){var n,o,a,h,c;return arguments.length<2||\"string\"!=typeof t?(h=e,e=t,t=null):h=arguments[2],null==t?(n=a=!0,o=!1):(n=s.call(t,\"c\"),o=s.call(t,\"e\"),a=s.call(t,\"w\")),c={value:e,configurable:n,enumerable:o,writable:a},h?i(r(h),c):c}).gs=function(t,e,n){var a,h,c,l;return\"string\"!=typeof t?(c=n,n=e,e=t,t=null):c=arguments[3],null==e?e=void 0:o(e)?null==n?n=void 0:o(n)||(c=n,n=void 0):(c=e,e=n=void 0),null==t?(a=!0,h=!1):(a=s.call(t,\"c\"),h=s.call(t,\"e\")),l={get:e,set:n,configurable:a,enumerable:h},c?i(r(c),l):l}},function(t,e,n){\"use strict\";t.exports=n(50)()?Object.assign:n(51)},function(t,e,n){\"use strict\";t.exports=function(){var t,e=Object.assign;return\"function\"==typeof e&&(e(t={foo:\"raz\"},{bar:\"dwa\"},{trzy:\"trzy\"}),t.foo+t.bar+t.trzy===\"razdwatrzy\")}},function(t,e,n){\"use strict\";var i=n(52),r=n(56),o=Math.max;t.exports=function(t,e){var n,s,a,h=o(arguments.length,2);for(t=Object(r(t)),a=function(i){try{t[i]=e[i]}catch(t){n||(n=t)}},s=1;s<h;++s)e=arguments[s],i(e).forEach(a);if(void 0!==n)throw n;return t}},function(t,e,n){\"use strict\";t.exports=n(53)()?Object.keys:n(54)},function(t,e,n){\"use strict\";t.exports=function(){try{return Object.keys(\"primitive\"),!0}catch(t){return!1}}},function(t,e,n){\"use strict\";var i=n(16),r=Object.keys;t.exports=function(t){return r(i(t)?Object(t):t)}},function(t,e,n){\"use strict\";t.exports=function(){}},function(t,e,n){\"use strict\";var i=n(16);t.exports=function(t){if(!i(t))throw new TypeError(\"Cannot use null or undefined\");return t}},function(t,e,n){\"use strict\";var i=n(16),r=Array.prototype.forEach,o=Object.create;t.exports=function(t){var e=o(null);return r.call(arguments,function(t){i(t)&&function(t,e){var n;for(n in t)e[n]=t[n]}(Object(t),e)}),e}},function(t,e,n){\"use strict\";t.exports=function(t){return\"function\"==typeof t}},function(t,e,n){\"use strict\";t.exports=n(60)()?String.prototype.contains:n(61)},function(t,e,n){\"use strict\";var i=\"razdwatrzy\";t.exports=function(){return\"function\"==typeof i.contains&&(!0===i.contains(\"dwa\")&&!1===i.contains(\"foo\"))}},function(t,e,n){\"use strict\";var i=String.prototype.indexOf;t.exports=function(t){return i.call(this,t,arguments[1])>-1}},function(t,e,n){\"use strict\";t.exports=function(t){if(\"function\"!=typeof t)throw new TypeError(t+\" is not a function\");return t}},function(t,e,n){var i=n(23),r=n(10)(\"socket.io-client:url\");t.exports=function(t,e){var n=t;e=e||\"undefined\"!=typeof location&&location,null==t&&(t=e.protocol+\"//\"+e.host);\"string\"==typeof t&&(\"/\"===t.charAt(0)&&(t=\"/\"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\\/\\//.test(t)||(r(\"protocol-less url %s\",t),t=void 0!==e?e.protocol+\"//\"+t:\"https://\"+t),r(\"parse %s\",t),n=i(t));n.port||(/^(http|ws)$/.test(n.protocol)?n.port=\"80\":/^(http|ws)s$/.test(n.protocol)&&(n.port=\"443\"));n.path=n.path||\"/\";var o=-1!==n.host.indexOf(\":\")?\"[\"+n.host+\"]\":n.host;return n.id=n.protocol+\"://\"+o+\":\"+n.port,n.href=n.protocol+\"://\"+o+(e&&e.port===n.port?\"\":\":\"+n.port),n}},function(t,e,n){function i(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,o=r-(n||r);t.diff=o,t.prev=n,t.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),\"string\"!=typeof s[0]&&s.unshift(\"%O\");var h=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,i){if(\"%%\"===n)return n;h++;var r=e.formatters[i];if(\"function\"==typeof r){var o=s[h];n=r.call(t,o),s.splice(h,1),h--}return n}),e.formatArgs.call(t,s),(i.log||e.log||console.log.bind(console)).apply(t,s)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,i=0;for(n in t)i=(i<<5)-i+t.charCodeAt(n),i|=0;return e.colors[Math.abs(i)%e.colors.length]}(t),i.destroy=r,\"function\"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable(\"\")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var i=(\"string\"==typeof t?t:\"\").split(/[\\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&(\"-\"===(t=i[n].replace(/\\*/g,\".*?\"))[0]?e.skips.push(new RegExp(\"^\"+t.substr(1)+\"$\")):e.names.push(new RegExp(\"^\"+t+\"$\")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if(\"*\"===t[t.length-1])return!0;var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(65),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,i=60*n,r=60*i,o=24*r,s=365.25*o;function a(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+\" \"+n:Math.ceil(t/e)+\" \"+n+\"s\"}t.exports=function(t,e){e=e||{};var h,c=typeof t;if(\"string\"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return a*s;case\"days\":case\"day\":case\"d\":return a*o;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return a*r;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return a*i;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return a*n;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return a;default:return}}(t);if(\"number\"===c&&!1===isNaN(t))return e.long?a(h=t,o,\"day\")||a(h,r,\"hour\")||a(h,i,\"minute\")||a(h,n,\"second\")||h+\" ms\":function(t){if(t>=o)return Math.round(t/o)+\"d\";if(t>=r)return Math.round(t/r)+\"h\";if(t>=i)return Math.round(t/i)+\"m\";if(t>=n)return Math.round(t/n)+\"s\";return t+\"ms\"}(t);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(t))}},function(t,e,n){(function(i){function r(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&\"env\"in i&&(t=i.env.DEBUG),t}(e=t.exports=n(67)).log=function(){return\"object\"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var n=this.useColors;if(t[0]=(n?\"%c\":\"\")+this.namespace+(n?\" %c\":\" \")+t[0]+(n?\"%c \":\" \")+\"+\"+e.humanize(this.diff),!n)return;var i=\"color: \"+this.color;t.splice(1,0,i,\"color: inherit\");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(t){\"%%\"!==t&&(r++,\"%c\"===t&&(o=r))}),t.splice(o,0,i)},e.save=function(t){try{null==t?e.storage.removeItem(\"debug\"):e.storage.debug=t}catch(t){}},e.load=r,e.useColors=function(){if(\"undefined\"!=typeof window&&window.process&&\"renderer\"===window.process.type)return!0;if(\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/))return!1;return\"undefined\"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||\"undefined\"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/)&&parseInt(RegExp.$1,10)>=31||\"undefined\"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/)},e.storage=\"undefined\"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=[\"#0000CC\",\"#0000FF\",\"#0033CC\",\"#0033FF\",\"#0066CC\",\"#0066FF\",\"#0099CC\",\"#0099FF\",\"#00CC00\",\"#00CC33\",\"#00CC66\",\"#00CC99\",\"#00CCCC\",\"#00CCFF\",\"#3300CC\",\"#3300FF\",\"#3333CC\",\"#3333FF\",\"#3366CC\",\"#3366FF\",\"#3399CC\",\"#3399FF\",\"#33CC00\",\"#33CC33\",\"#33CC66\",\"#33CC99\",\"#33CCCC\",\"#33CCFF\",\"#6600CC\",\"#6600FF\",\"#6633CC\",\"#6633FF\",\"#66CC00\",\"#66CC33\",\"#9900CC\",\"#9900FF\",\"#9933CC\",\"#9933FF\",\"#99CC00\",\"#99CC33\",\"#CC0000\",\"#CC0033\",\"#CC0066\",\"#CC0099\",\"#CC00CC\",\"#CC00FF\",\"#CC3300\",\"#CC3333\",\"#CC3366\",\"#CC3399\",\"#CC33CC\",\"#CC33FF\",\"#CC6600\",\"#CC6633\",\"#CC9900\",\"#CC9933\",\"#CCCC00\",\"#CCCC33\",\"#FF0000\",\"#FF0033\",\"#FF0066\",\"#FF0099\",\"#FF00CC\",\"#FF00FF\",\"#FF3300\",\"#FF3333\",\"#FF3366\",\"#FF3399\",\"#FF33CC\",\"#FF33FF\",\"#FF6600\",\"#FF6633\",\"#FF9900\",\"#FF9933\",\"#FFCC00\",\"#FFCC33\"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return\"[UnexpectedJSONParseError]: \"+t.message}},e.enable(r())}).call(this,n(2))},function(t,e,n){function i(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,o=r-(n||r);t.diff=o,t.prev=n,t.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),\"string\"!=typeof s[0]&&s.unshift(\"%O\");var h=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,i){if(\"%%\"===n)return n;h++;var r=e.formatters[i];if(\"function\"==typeof r){var o=s[h];n=r.call(t,o),s.splice(h,1),h--}return n}),e.formatArgs.call(t,s),(i.log||e.log||console.log.bind(console)).apply(t,s)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,i=0;for(n in t)i=(i<<5)-i+t.charCodeAt(n),i|=0;return e.colors[Math.abs(i)%e.colors.length]}(t),i.destroy=r,\"function\"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable(\"\")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var i=(\"string\"==typeof t?t:\"\").split(/[\\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&(\"-\"===(t=i[n].replace(/\\*/g,\".*?\"))[0]?e.skips.push(new RegExp(\"^\"+t.substr(1)+\"$\")):e.names.push(new RegExp(\"^\"+t+\"$\")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if(\"*\"===t[t.length-1])return!0;var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(68),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,i=60*n,r=60*i,o=24*r,s=365.25*o;function a(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+\" \"+n:Math.ceil(t/e)+\" \"+n+\"s\"}t.exports=function(t,e){e=e||{};var h,c=typeof t;if(\"string\"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return a*s;case\"days\":case\"day\":case\"d\":return a*o;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return a*r;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return a*i;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return a*n;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return a;default:return}}(t);if(\"number\"===c&&!1===isNaN(t))return e.long?a(h=t,o,\"day\")||a(h,r,\"hour\")||a(h,i,\"minute\")||a(h,n,\"second\")||h+\" ms\":function(t){if(t>=o)return Math.round(t/o)+\"d\";if(t>=r)return Math.round(t/r)+\"h\";if(t>=i)return Math.round(t/i)+\"m\";if(t>=n)return Math.round(t/n)+\"s\";return t+\"ms\"}(t);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(t))}},function(t,e,n){var i=n(18),r=n(24),o=Object.prototype.toString,s=\"function\"==typeof Blob||\"undefined\"!=typeof Blob&&\"[object BlobConstructor]\"===o.call(Blob),a=\"function\"==typeof File||\"undefined\"!=typeof File&&\"[object FileConstructor]\"===o.call(File);e.deconstructPacket=function(t){var e=[],n=t.data,o=t;return o.data=function t(e,n){if(!e)return e;if(r(e)){var o={_placeholder:!0,num:n.length};return n.push(e),o}if(i(e)){for(var s=new Array(e.length),a=0;a<e.length;a++)s[a]=t(e[a],n);return s}if(\"object\"==typeof e&&!(e instanceof Date)){var s={};for(var h in e)s[h]=t(e[h],n);return s}return e}(n,e),o.attachments=e.length,{packet:o,buffers:e}},e.reconstructPacket=function(t,e){return t.data=function t(e,n){if(!e)return e;if(e&&e._placeholder)return n[e.num];if(i(e))for(var r=0;r<e.length;r++)e[r]=t(e[r],n);else if(\"object\"==typeof e)for(var o in e)e[o]=t(e[o],n);return e}(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var n=0,o=t;!function t(h,c,l){if(!h)return h;if(s&&h instanceof Blob||a&&h instanceof File){n++;var u=new FileReader;u.onload=function(){l?l[c]=this.result:o=this.result,--n||e(o)},u.readAsArrayBuffer(h)}else if(i(h))for(var p=0;p<h.length;p++)t(h[p],p,h);else if(\"object\"==typeof h&&!r(h))for(var f in h)t(h[f],f,h)}(o),n||e(o)}},function(t,e,n){\"use strict\";e.byteLength=function(t){var e=c(t),n=e[0],i=e[1];return 3*(n+i)/4-i},e.toByteArray=function(t){for(var e,n=c(t),i=n[0],s=n[1],a=new o(function(t,e,n){return 3*(e+n)/4-n}(0,i,s)),h=0,l=s>0?i-4:i,u=0;u<l;u+=4)e=r[t.charCodeAt(u)]<<18|r[t.charCodeAt(u+1)]<<12|r[t.charCodeAt(u+2)]<<6|r[t.charCodeAt(u+3)],a[h++]=e>>16&255,a[h++]=e>>8&255,a[h++]=255&e;2===s&&(e=r[t.charCodeAt(u)]<<2|r[t.charCodeAt(u+1)]>>4,a[h++]=255&e);1===s&&(e=r[t.charCodeAt(u)]<<10|r[t.charCodeAt(u+1)]<<4|r[t.charCodeAt(u+2)]>>2,a[h++]=e>>8&255,a[h++]=255&e);return a},e.fromByteArray=function(t){for(var e,n=t.length,r=n%3,o=[],s=0,a=n-r;s<a;s+=16383)o.push(l(t,s,s+16383>a?a:s+16383));1===r?(e=t[n-1],o.push(i[e>>2]+i[e<<4&63]+\"==\")):2===r&&(e=(t[n-2]<<8)+t[n-1],o.push(i[e>>10]+i[e>>4&63]+i[e<<2&63]+\"=\"));return o.join(\"\")};for(var i=[],r=[],o=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,s=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",a=0,h=s.length;a<h;++a)i[a]=s[a],r[s.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw new Error(\"Invalid string. Length must be a multiple of 4\");var n=t.indexOf(\"=\");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t,e,n){for(var r,o,s=[],a=e;a<n;a+=3)r=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(i[(o=r)>>18&63]+i[o>>12&63]+i[o>>6&63]+i[63&o]);return s.join(\"\")}r[\"-\".charCodeAt(0)]=62,r[\"_\".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,i,r){var o,s,a=8*r-i-1,h=(1<<a)-1,c=h>>1,l=-7,u=n?r-1:0,p=n?-1:1,f=t[e+u];for(u+=p,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+t[e+u],u+=p,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+t[e+u],u+=p,l-=8);if(0===o)o=1-c;else{if(o===h)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=c}return(f?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,n,i,r,o){var s,a,h,c=8*o-r-1,l=(1<<c)-1,u=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-s))<1&&(s--,h*=2),(e+=s+u>=1?p/h:p*Math.pow(2,1-u))*h>=2&&(s++,h/=2),s+u>=l?(a=0,s=l):s+u>=1?(a=(e*h-1)*Math.pow(2,r),s+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),s=0));r>=8;t[n+f]=255&a,f+=d,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;t[n+f]=255&s,f+=d,s/=256,c-=8);t[n+f-d]|=128*y}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return\"[object Array]\"==n.call(t)}},function(t,e,n){t.exports=n(74),t.exports.parser=n(6)},function(t,e,n){var i=n(26),r=n(5),o=n(13)(\"engine.io-client:socket\"),s=n(30),a=n(6),h=n(23),c=n(11);function l(t,e){if(!(this instanceof l))return new l(t,e);e=e||{},t&&\"object\"==typeof t&&(e=t,t=null),t?(t=h(t),e.hostname=t.host,e.secure=\"https\"===t.protocol||\"wss\"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=h(e.host).host),this.secure=null!=e.secure?e.secure:\"undefined\"!=typeof location&&\"https:\"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?\"443\":\"80\"),this.agent=e.agent||!1,this.hostname=e.hostname||(\"undefined\"!=typeof location?location.hostname:\"localhost\"),this.port=e.port||(\"undefined\"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},\"string\"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||\"/engine.io\").replace(/\\/$/,\"\")+\"/\",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||\"t\",this.timestampRequests=e.timestampRequests,this.transports=e.transports||[\"polling\",\"websocket\"],this.transportOptions=e.transportOptions||{},this.readyState=\"\",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative=\"undefined\"!=typeof navigator&&\"string\"==typeof navigator.product&&\"reactnative\"===navigator.product.toLowerCase(),(\"undefined\"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}t.exports=l,l.priorWebsocketSuccess=!1,r(l.prototype),l.protocol=a.protocol,l.Socket=l,l.Transport=n(20),l.transports=n(26),l.parser=n(6),l.prototype.createTransport=function(t){o('creating transport \"%s\"',t);var e=function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}(this.query);e.EIO=a.protocol,e.transport=t;var n=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new i[t]({query:e,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},l.prototype.open=function(){var t;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf(\"websocket\"))t=\"websocket\";else{if(0===this.transports.length){var e=this;return void setTimeout(function(){e.emit(\"error\",\"No transports available\")},0)}t=this.transports[0]}this.readyState=\"opening\";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},l.prototype.setTransport=function(t){o(\"setting transport %s\",t.name);var e=this;this.transport&&(o(\"clearing existing transport %s\",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on(\"drain\",function(){e.onDrain()}).on(\"packet\",function(t){e.onPacket(t)}).on(\"error\",function(t){e.onError(t)}).on(\"close\",function(){e.onClose(\"transport close\")})},l.prototype.probe=function(t){o('probing transport \"%s\"',t);var e=this.createTransport(t,{probe:1}),n=!1,i=this;function r(){if(i.onlyBinaryUpgrades){var r=!this.supportsBinary&&i.transport.supportsBinary;n=n||r}n||(o('probe transport \"%s\" opened',t),e.send([{type:\"ping\",data:\"probe\"}]),e.once(\"packet\",function(r){if(!n)if(\"pong\"===r.type&&\"probe\"===r.data){if(o('probe transport \"%s\" pong',t),i.upgrading=!0,i.emit(\"upgrading\",e),!e)return;l.priorWebsocketSuccess=\"websocket\"===e.name,o('pausing current transport \"%s\"',i.transport.name),i.transport.pause(function(){n||\"closed\"!==i.readyState&&(o(\"changing transport and sending upgrade packet\"),p(),i.setTransport(e),e.send([{type:\"upgrade\"}]),i.emit(\"upgrade\",e),e=null,i.upgrading=!1,i.flush())})}else{o('probe transport \"%s\" failed',t);var s=new Error(\"probe error\");s.transport=e.name,i.emit(\"upgradeError\",s)}}))}function s(){n||(n=!0,p(),e.close(),e=null)}function a(n){var r=new Error(\"probe error: \"+n);r.transport=e.name,s(),o('probe transport \"%s\" failed because of error: %s',t,n),i.emit(\"upgradeError\",r)}function h(){a(\"transport closed\")}function c(){a(\"socket closed\")}function u(t){e&&t.name!==e.name&&(o('\"%s\" works - aborting \"%s\"',t.name,e.name),s())}function p(){e.removeListener(\"open\",r),e.removeListener(\"error\",a),e.removeListener(\"close\",h),i.removeListener(\"close\",c),i.removeListener(\"upgrading\",u)}l.priorWebsocketSuccess=!1,e.once(\"open\",r),e.once(\"error\",a),e.once(\"close\",h),this.once(\"close\",c),this.once(\"upgrading\",u),e.open()},l.prototype.onOpen=function(){if(o(\"socket open\"),this.readyState=\"open\",l.priorWebsocketSuccess=\"websocket\"===this.transport.name,this.emit(\"open\"),this.flush(),\"open\"===this.readyState&&this.upgrade&&this.transport.pause){o(\"starting upgrade probes\");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},l.prototype.onPacket=function(t){if(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState)switch(o('socket receive: type \"%s\", data \"%s\"',t.type,t.data),this.emit(\"packet\",t),this.emit(\"heartbeat\"),t.type){case\"open\":this.onHandshake(JSON.parse(t.data));break;case\"pong\":this.setPing(),this.emit(\"pong\");break;case\"error\":var e=new Error(\"server error\");e.code=t.data,this.onError(e);break;case\"message\":this.emit(\"data\",t.data),this.emit(\"message\",t.data)}else o('packet received with socket readyState \"%s\"',this.readyState)},l.prototype.onHandshake=function(t){this.emit(\"handshake\",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),\"closed\"!==this.readyState&&(this.setPing(),this.removeListener(\"heartbeat\",this.onHeartbeat),this.on(\"heartbeat\",this.onHeartbeat))},l.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){\"closed\"!==e.readyState&&e.onClose(\"ping timeout\")},t||e.pingInterval+e.pingTimeout)},l.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){o(\"writing ping packet - expecting pong within %sms\",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},l.prototype.ping=function(){var t=this;this.sendPacket(\"ping\",function(){t.emit(\"ping\")})},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit(\"drain\"):this.flush()},l.prototype.flush=function(){\"closed\"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o(\"flushing %d packets in socket\",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit(\"flush\"))},l.prototype.write=l.prototype.send=function(t,e,n){return this.sendPacket(\"message\",t,e,n),this},l.prototype.sendPacket=function(t,e,n,i){if(\"function\"==typeof e&&(i=e,e=void 0),\"function\"==typeof n&&(i=n,n=null),\"closing\"!==this.readyState&&\"closed\"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:t,data:e,options:n};this.emit(\"packetCreate\",r),this.writeBuffer.push(r),i&&this.once(\"flush\",i),this.flush()}},l.prototype.close=function(){if(\"opening\"===this.readyState||\"open\"===this.readyState){this.readyState=\"closing\";var t=this;this.writeBuffer.length?this.once(\"drain\",function(){this.upgrading?i():e()}):this.upgrading?i():e()}function e(){t.onClose(\"forced close\"),o(\"socket closing - telling transport to close\"),t.transport.close()}function n(){t.removeListener(\"upgrade\",n),t.removeListener(\"upgradeError\",n),e()}function i(){t.once(\"upgrade\",n),t.once(\"upgradeError\",n)}return this},l.prototype.onError=function(t){o(\"socket error %j\",t),l.priorWebsocketSuccess=!1,this.emit(\"error\",t),this.onClose(\"transport error\",t)},l.prototype.onClose=function(t,e){if(\"opening\"===this.readyState||\"open\"===this.readyState||\"closing\"===this.readyState){o('socket close with reason: \"%s\"',t);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners(\"close\"),this.transport.close(),this.transport.removeAllListeners(),this.readyState=\"closed\",this.id=null,this.emit(\"close\",t,e),this.writeBuffer=[],this.prevBufferLen=0}},l.prototype.filterUpgrades=function(t){for(var e=[],n=0,i=t.length;n<i;n++)~s(this.transports,t[n])&&e.push(t[n]);return e}},function(t,e){try{t.exports=\"undefined\"!=typeof XMLHttpRequest&&\"withCredentials\"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,n){var i=n(19),r=n(27),o=n(5),s=n(12),a=n(13)(\"engine.io-client:polling-xhr\");function h(){}function c(t){if(r.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,\"undefined\"!=typeof location){var e=\"https:\"===location.protocol,n=location.port;n||(n=e?443:80),this.xd=\"undefined\"!=typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}}function l(t){this.method=t.method||\"GET\",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}if(t.exports=c,t.exports.Request=l,s(c,r),c.prototype.supportsBinary=!0,c.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new l(t)},c.prototype.doWrite=function(t,e){var n=\"string\"!=typeof t&&void 0!==t,i=this.request({method:\"POST\",data:t,isBinary:n}),r=this;i.on(\"success\",e),i.on(\"error\",function(t){r.onError(\"xhr post error\",t)}),this.sendXhr=i},c.prototype.doPoll=function(){a(\"xhr poll\");var t=this.request(),e=this;t.on(\"data\",function(t){e.onData(t)}),t.on(\"error\",function(t){e.onError(\"xhr poll error\",t)}),this.pollXhr=t},o(l.prototype),l.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new i(t),n=this;try{a(\"xhr open %s: %s\",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&e.setRequestHeader(r,this.extraHeaders[r])}catch(t){}if(\"POST\"===this.method)try{this.isBinary?e.setRequestHeader(\"Content-type\",\"application/octet-stream\"):e.setRequestHeader(\"Content-type\",\"text/plain;charset=UTF-8\")}catch(t){}try{e.setRequestHeader(\"Accept\",\"*/*\")}catch(t){}\"withCredentials\"in e&&(e.withCredentials=!0),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){n.onLoad()},e.onerror=function(){n.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader(\"Content-Type\");n.supportsBinary&&\"application/octet-stream\"===t&&(e.responseType=\"arraybuffer\")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?n.onLoad():setTimeout(function(){n.onError(e.status)},0))},a(\"xhr data %s\",this.data),e.send(this.data)}catch(t){return void setTimeout(function(){n.onError(t)},0)}\"undefined\"!=typeof document&&(this.index=l.requestsCount++,l.requests[this.index]=this)},l.prototype.onSuccess=function(){this.emit(\"success\"),this.cleanup()},l.prototype.onData=function(t){this.emit(\"data\",t),this.onSuccess()},l.prototype.onError=function(t){this.emit(\"error\",t),this.cleanup(!0)},l.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=h:this.xhr.onreadystatechange=h,t)try{this.xhr.abort()}catch(t){}\"undefined\"!=typeof document&&delete l.requests[this.index],this.xhr=null}},l.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader(\"Content-Type\")}catch(t){}t=\"application/octet-stream\"===e&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},l.prototype.hasXDR=function(){return\"undefined\"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},l.prototype.abort=function(){this.cleanup()},l.requestsCount=0,l.requests={},\"undefined\"!=typeof document)if(\"function\"==typeof attachEvent)attachEvent(\"onunload\",p);else if(\"function\"==typeof addEventListener){var u=\"onpagehide\"in self?\"pagehide\":\"unload\";addEventListener(u,p,!1)}function p(){for(var t in l.requests)l.requests.hasOwnProperty(t)&&l.requests[t].abort()}},function(t,e){t.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var i in t)n.call(t,i)&&e.push(i);return e}},function(t,e){t.exports=function(t,e,n){var i=t.byteLength;if(e=e||0,n=n||i,t.slice)return t.slice(e,n);if(e<0&&(e+=i),n<0&&(n+=i),n>i&&(n=i),e>=i||e>=n||0===i)return new ArrayBuffer(0);for(var r=new Uint8Array(t),o=new Uint8Array(n-e),s=e,a=0;s<n;s++,a++)o[a]=r[s];return o.buffer}},function(t,e){function n(){}t.exports=function(t,e,i){var r=!1;return i=i||n,o.count=t,0===t?e():o;function o(t,n){if(o.count<=0)throw new Error(\"after called too many times\");--o.count,t?(r=!0,e(t),e=i):0!==o.count||r||e(null,n)}}},function(t,e){\n/*! https://mths.be/utf8js v2.1.2 by @mathias */\nvar n,i,r,o=String.fromCharCode;function s(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function a(t,e){if(t>=55296&&t<=57343){if(e)throw Error(\"Lone surrogate U+\"+t.toString(16).toUpperCase()+\" is not a scalar value\");return!1}return!0}function h(t,e){return o(t>>e&63|128)}function c(t,e){if(0==(4294967168&t))return o(t);var n=\"\";return 0==(4294965248&t)?n=o(t>>6&31|192):0==(4294901760&t)?(a(t,e)||(t=65533),n=o(t>>12&15|224),n+=h(t,6)):0==(4292870144&t)&&(n=o(t>>18&7|240),n+=h(t,12),n+=h(t,6)),n+=o(63&t|128)}function l(){if(r>=i)throw Error(\"Invalid byte index\");var t=255&n[r];if(r++,128==(192&t))return 63&t;throw Error(\"Invalid continuation byte\")}function u(t){var e,o;if(r>i)throw Error(\"Invalid byte index\");if(r==i)return!1;if(e=255&n[r],r++,0==(128&e))return e;if(192==(224&e)){if((o=(31&e)<<6|l())>=128)return o;throw Error(\"Invalid continuation byte\")}if(224==(240&e)){if((o=(15&e)<<12|l()<<6|l())>=2048)return a(o,t)?o:65533;throw Error(\"Invalid continuation byte\")}if(240==(248&e)&&(o=(7&e)<<18|l()<<12|l()<<6|l())>=65536&&o<=1114111)return o;throw Error(\"Invalid UTF-8 detected\")}t.exports={version:\"2.1.2\",encode:function(t,e){for(var n=!1!==(e=e||{}).strict,i=s(t),r=i.length,o=-1,a=\"\";++o<r;)a+=c(i[o],n);return a},decode:function(t,e){var a=!1!==(e=e||{}).strict;n=s(t),i=n.length,r=0;for(var h,c=[];!1!==(h=u(a));)c.push(h);return function(t){for(var e,n=t.length,i=-1,r=\"\";++i<n;)(e=t[i])>65535&&(r+=o((e-=65536)>>>10&1023|55296),e=56320|1023&e),r+=o(e);return r}(c)}}},function(t,e){!function(){\"use strict\";for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",n=new Uint8Array(256),i=0;i<t.length;i++)n[t.charCodeAt(i)]=i;e.encode=function(e){var n,i=new Uint8Array(e),r=i.length,o=\"\";for(n=0;n<r;n+=3)o+=t[i[n]>>2],o+=t[(3&i[n])<<4|i[n+1]>>4],o+=t[(15&i[n+1])<<2|i[n+2]>>6],o+=t[63&i[n+2]];return r%3==2?o=o.substring(0,o.length-1)+\"=\":r%3==1&&(o=o.substring(0,o.length-2)+\"==\"),o},e.decode=function(t){var e,i,r,o,s,a=.75*t.length,h=t.length,c=0;\"=\"===t[t.length-1]&&(a--,\"=\"===t[t.length-2]&&a--);var l=new ArrayBuffer(a),u=new Uint8Array(l);for(e=0;e<h;e+=4)i=n[t.charCodeAt(e)],r=n[t.charCodeAt(e+1)],o=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],u[c++]=i<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&s;return l}}()},function(t,e){var n=void 0!==n?n:\"undefined\"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:\"undefined\"!=typeof MSBlobBuilder?MSBlobBuilder:\"undefined\"!=typeof MozBlobBuilder&&MozBlobBuilder,i=function(){try{return 2===new Blob([\"hi\"]).size}catch(t){return!1}}(),r=i&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),o=n&&n.prototype.append&&n.prototype.getBlob;function s(t){return t.map(function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var n=new Uint8Array(t.byteLength);n.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=n.buffer}return e}return t})}function a(t,e){e=e||{};var i=new n;return s(t).forEach(function(t){i.append(t)}),e.type?i.getBlob(e.type):i.getBlob()}function h(t,e){return new Blob(s(t),e||{})}\"undefined\"!=typeof Blob&&(a.prototype=Blob.prototype,h.prototype=Blob.prototype),t.exports=i?r?Blob:h:o?a:void 0},function(t,e,n){function i(t){var n;function i(){if(i.enabled){var t=i,r=+new Date,o=r-(n||r);t.diff=o,t.prev=n,t.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=e.coerce(s[0]),\"string\"!=typeof s[0]&&s.unshift(\"%O\");var h=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,function(n,i){if(\"%%\"===n)return n;h++;var r=e.formatters[i];if(\"function\"==typeof r){var o=s[h];n=r.call(t,o),s.splice(h,1),h--}return n}),e.formatArgs.call(t,s),(i.log||e.log||console.log.bind(console)).apply(t,s)}}return i.namespace=t,i.enabled=e.enabled(t),i.useColors=e.useColors(),i.color=function(t){var n,i=0;for(n in t)i=(i<<5)-i+t.charCodeAt(n),i|=0;return e.colors[Math.abs(i)%e.colors.length]}(t),i.destroy=r,\"function\"==typeof e.init&&e.init(i),e.instances.push(i),i}function r(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable(\"\")},e.enable=function(t){var n;e.save(t),e.names=[],e.skips=[];var i=(\"string\"==typeof t?t:\"\").split(/[\\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&(\"-\"===(t=i[n].replace(/\\*/g,\".*?\"))[0]?e.skips.push(new RegExp(\"^\"+t.substr(1)+\"$\")):e.names.push(new RegExp(\"^\"+t+\"$\")));for(n=0;n<e.instances.length;n++){var o=e.instances[n];o.enabled=e.enabled(o.namespace)}},e.enabled=function(t){if(\"*\"===t[t.length-1])return!0;var n,i;for(n=0,i=e.skips.length;n<i;n++)if(e.skips[n].test(t))return!1;for(n=0,i=e.names.length;n<i;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(84),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){var n=1e3,i=60*n,r=60*i,o=24*r,s=365.25*o;function a(t,e,n){if(!(t<e))return t<1.5*e?Math.floor(t/e)+\" \"+n:Math.ceil(t/e)+\" \"+n+\"s\"}t.exports=function(t,e){e=e||{};var h,c=typeof t;if(\"string\"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(!e)return;var a=parseFloat(e[1]);switch((e[2]||\"ms\").toLowerCase()){case\"years\":case\"year\":case\"yrs\":case\"yr\":case\"y\":return a*s;case\"days\":case\"day\":case\"d\":return a*o;case\"hours\":case\"hour\":case\"hrs\":case\"hr\":case\"h\":return a*r;case\"minutes\":case\"minute\":case\"mins\":case\"min\":case\"m\":return a*i;case\"seconds\":case\"second\":case\"secs\":case\"sec\":case\"s\":return a*n;case\"milliseconds\":case\"millisecond\":case\"msecs\":case\"msec\":case\"ms\":return a;default:return}}(t);if(\"number\"===c&&!1===isNaN(t))return e.long?a(h=t,o,\"day\")||a(h,r,\"hour\")||a(h,i,\"minute\")||a(h,n,\"second\")||h+\" ms\":function(t){if(t>=o)return Math.round(t/o)+\"d\";if(t>=r)return Math.round(t/r)+\"h\";if(t>=i)return Math.round(t/i)+\"m\";if(t>=n)return Math.round(t/n)+\"s\";return t+\"ms\"}(t);throw new Error(\"val is not a non-empty string or a valid number. val=\"+JSON.stringify(t))}},function(t,e,n){(function(e){var i=n(27),r=n(12);t.exports=l;var o,s=/\\n/g,a=/\\\\n/g;function h(){}function c(){return\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:void 0!==e?e:{}}function l(t){if(i.call(this,t),this.query=this.query||{},!o){var e=c();o=e.___eio=e.___eio||[]}this.index=o.length;var n=this;o.push(function(t){n.onData(t)}),this.query.j=this.index,\"function\"==typeof addEventListener&&addEventListener(\"beforeunload\",function(){n.script&&(n.script.onerror=h)},!1)}r(l,i),l.prototype.supportsBinary=!1,l.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},l.prototype.doPoll=function(){var t=this,e=document.createElement(\"script\");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError(\"jsonp poll error\",e)};var n=document.getElementsByTagName(\"script\")[0];n?n.parentNode.insertBefore(e,n):(document.head||document.body).appendChild(e),this.script=e,\"undefined\"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var t=document.createElement(\"iframe\");document.body.appendChild(t),document.body.removeChild(t)},100)},l.prototype.doWrite=function(t,e){var n=this;if(!this.form){var i,r=document.createElement(\"form\"),o=document.createElement(\"textarea\"),h=this.iframeId=\"eio_iframe_\"+this.index;r.className=\"socketio\",r.style.position=\"absolute\",r.style.top=\"-1000px\",r.style.left=\"-1000px\",r.target=h,r.method=\"POST\",r.setAttribute(\"accept-charset\",\"utf-8\"),o.name=\"d\",r.appendChild(o),document.body.appendChild(r),this.form=r,this.area=o}function c(){l(),e()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError(\"jsonp polling iframe removal error\",t)}try{var t='<iframe src=\"javascript:0\" name=\"'+n.iframeId+'\">';i=document.createElement(t)}catch(t){(i=document.createElement(\"iframe\")).name=n.iframeId,i.src=\"javascript:0\"}i.id=n.iframeId,n.form.appendChild(i),n.iframe=i}this.form.action=this.uri(),l(),t=t.replace(a,\"\\\\\\n\"),this.area.value=t.replace(s,\"\\\\n\");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){\"complete\"===n.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,n(0))},function(t,e,n){(function(e){var i,r,o=n(20),s=n(6),a=n(11),h=n(12),c=n(29),l=n(13)(\"engine.io-client:websocket\");if(\"undefined\"!=typeof WebSocket)i=WebSocket;else if(\"undefined\"!=typeof self)i=self.WebSocket||self.MozWebSocket;else try{r=n(87)}catch(t){}var u=i||r;function p(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=i&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(u=r),o.call(this,t)}t.exports=p,h(p,o),p.prototype.name=\"websocket\",p.prototype.supportsBinary=!0,p.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new u(t,e):new u(t):new u(t,e,n)}catch(t){return this.emit(\"error\",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType=\"nodebuffer\"):this.ws.binaryType=\"arraybuffer\",this.addEventListeners()}},p.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError(\"websocket error\",e)}},p.prototype.write=function(t){var n=this;this.writable=!1;for(var i=t.length,r=0,o=i;r<o;r++)!function(t){s.encodePacket(t,n.supportsBinary,function(r){if(!n.usingBrowserWebSocket){var o={};if(t.options&&(o.compress=t.options.compress),n.perMessageDeflate)(\"string\"==typeof r?e.byteLength(r):r.length)<n.perMessageDeflate.threshold&&(o.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(r):n.ws.send(r,o)}catch(t){l(\"websocket closed before onclose event\")}--i||a()})}(t[r]);function a(){n.emit(\"flush\"),setTimeout(function(){n.writable=!0,n.emit(\"drain\")},0)}},p.prototype.onClose=function(){o.prototype.onClose.call(this)},p.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},p.prototype.uri=function(){var t=this.query||{},e=this.secure?\"wss\":\"ws\",n=\"\";return this.port&&(\"wss\"===e&&443!==Number(this.port)||\"ws\"===e&&80!==Number(this.port))&&(n=\":\"+this.port),this.timestampRequests&&(t[this.timestampParam]=c()),this.supportsBinary||(t.b64=1),(t=a.encode(t)).length&&(t=\"?\"+t),e+\"://\"+(-1!==this.hostname.indexOf(\":\")?\"[\"+this.hostname+\"]\":this.hostname)+n+this.path+t},p.prototype.check=function(){return!(!u||\"__initialize\"in u&&this.name===p.prototype.name)}}).call(this,n(3).Buffer)},function(t,e){},function(t,e){t.exports=function(t,e){for(var n=[],i=(e=e||0)||0;i<t.length;i++)n[i-e]=t[i];return n}},function(t,e){function n(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=n,n.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(t){this.ms=t},n.prototype.setMax=function(t){this.max=t},n.prototype.setJitter=function(t){this.jitter=t}},function(t,e,n){(function(e,i,r){var o=n(34),s=n(4),a=n(35),h=n(36),c=n(99),l=a.IncomingMessage,u=a.readyStates;var p=t.exports=function(t){var n,i=this;h.Writable.call(i),i._opts=t,i._body=[],i._headers={},t.auth&&i.setHeader(\"Authorization\",\"Basic \"+new e(t.auth).toString(\"base64\")),Object.keys(t.headers).forEach(function(e){i.setHeader(e,t.headers[e])});var r=!0;if(\"disable-fetch\"===t.mode||\"requestTimeout\"in t&&!o.abortController)r=!1,n=!0;else if(\"prefer-streaming\"===t.mode)n=!1;else if(\"allow-wrong-content-type\"===t.mode)n=!o.overrideMimeType;else{if(t.mode&&\"default\"!==t.mode&&\"prefer-fast\"!==t.mode)throw new Error(\"Invalid value for opts.mode\");n=!0}i._mode=function(t,e){return o.fetch&&e?\"fetch\":o.mozchunkedarraybuffer?\"moz-chunked-arraybuffer\":o.msstream?\"ms-stream\":o.arraybuffer&&t?\"arraybuffer\":o.vbArray&&t?\"text:vbarray\":\"text\"}(n,r),i._fetchTimer=null,i.on(\"finish\",function(){i._onFinish()})};s(p,h.Writable),p.prototype.setHeader=function(t,e){var n=t.toLowerCase();-1===f.indexOf(n)&&(this._headers[n]={name:t,value:e})},p.prototype.getHeader=function(t){var e=this._headers[t.toLowerCase()];return e?e.value:null},p.prototype.removeHeader=function(t){delete this._headers[t.toLowerCase()]},p.prototype._onFinish=function(){var t=this;if(!t._destroyed){var n=t._opts,s=t._headers,a=null;\"GET\"!==n.method&&\"HEAD\"!==n.method&&(a=o.arraybuffer?c(e.concat(t._body)):o.blobConstructor?new i.Blob(t._body.map(function(t){return c(t)}),{type:(s[\"content-type\"]||{}).value||\"\"}):e.concat(t._body).toString());var h=[];if(Object.keys(s).forEach(function(t){var e=s[t].name,n=s[t].value;Array.isArray(n)?n.forEach(function(t){h.push([e,t])}):h.push([e,n])}),\"fetch\"===t._mode){var l=null;if(o.abortController){var p=new AbortController;l=p.signal,t._fetchAbortController=p,\"requestTimeout\"in n&&0!==n.requestTimeout&&(t._fetchTimer=i.setTimeout(function(){t.emit(\"requestTimeout\"),t._fetchAbortController&&t._fetchAbortController.abort()},n.requestTimeout))}i.fetch(t._opts.url,{method:t._opts.method,headers:h,body:a||void 0,mode:\"cors\",credentials:n.withCredentials?\"include\":\"same-origin\",signal:l}).then(function(e){t._fetchResponse=e,t._connect()},function(e){i.clearTimeout(t._fetchTimer),t._destroyed||t.emit(\"error\",e)})}else{var f=t._xhr=new i.XMLHttpRequest;try{f.open(t._opts.method,t._opts.url,!0)}catch(e){return void r.nextTick(function(){t.emit(\"error\",e)})}\"responseType\"in f&&(f.responseType=t._mode.split(\":\")[0]),\"withCredentials\"in f&&(f.withCredentials=!!n.withCredentials),\"text\"===t._mode&&\"overrideMimeType\"in f&&f.overrideMimeType(\"text/plain; charset=x-user-defined\"),\"requestTimeout\"in n&&(f.timeout=n.requestTimeout,f.ontimeout=function(){t.emit(\"requestTimeout\")}),h.forEach(function(t){f.setRequestHeader(t[0],t[1])}),t._response=null,f.onreadystatechange=function(){switch(f.readyState){case u.LOADING:case u.DONE:t._onXHRProgress()}},\"moz-chunked-arraybuffer\"===t._mode&&(f.onprogress=function(){t._onXHRProgress()}),f.onerror=function(){t._destroyed||t.emit(\"error\",new Error(\"XHR error\"))};try{f.send(a)}catch(e){return void r.nextTick(function(){t.emit(\"error\",e)})}}}},p.prototype._onXHRProgress=function(){(function(t){try{var e=t.status;return null!==e&&0!==e}catch(t){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},p.prototype._connect=function(){var t=this;t._destroyed||(t._response=new l(t._xhr,t._fetchResponse,t._mode,t._fetchTimer),t._response.on(\"error\",function(e){t.emit(\"error\",e)}),t.emit(\"response\",t._response))},p.prototype._write=function(t,e,n){this._body.push(t),n()},p.prototype.abort=p.prototype.destroy=function(){this._destroyed=!0,i.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},p.prototype.end=function(t,e,n){\"function\"==typeof t&&(n=t,t=void 0),h.Writable.prototype.end.call(this,t,e,n)},p.prototype.flushHeaders=function(){},p.prototype.setTimeout=function(){},p.prototype.setNoDelay=function(){},p.prototype.setSocketKeepAlive=function(){};var f=[\"accept-charset\",\"accept-encoding\",\"access-control-request-headers\",\"access-control-request-method\",\"connection\",\"content-length\",\"cookie\",\"cookie2\",\"date\",\"dnt\",\"expect\",\"host\",\"keep-alive\",\"origin\",\"referer\",\"te\",\"trailer\",\"transfer-encoding\",\"upgrade\",\"via\"]}).call(this,n(3).Buffer,n(0),n(2))},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return\"[object Array]\"==n.call(t)}},function(t,e){},function(t,e,n){\"use strict\";var i=n(15).Buffer,r=n(94);t.exports=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.head=null,this.tail=null,this.length=0}return t.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},t.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},t.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},t.prototype.clear=function(){this.head=this.tail=null,this.length=0},t.prototype.join=function(t){if(0===this.length)return\"\";for(var e=this.head,n=\"\"+e.data;e=e.next;)n+=t+e.data;return n},t.prototype.concat=function(t){if(0===this.length)return i.alloc(0);if(1===this.length)return this.head.data;for(var e,n,r,o=i.allocUnsafe(t>>>0),s=this.head,a=0;s;)e=s.data,n=o,r=a,e.copy(n,r),a+=s.data.length,s=s.next;return o},t}(),r&&r.inspect&&r.inspect.custom&&(t.exports.prototype[r.inspect.custom]=function(){var t=r.inspect({length:this.length});return this.constructor.name+\" \"+t})},function(t,e){},function(t,e,n){(function(t){var i=void 0!==t&&t||\"undefined\"!=typeof self&&self||window,r=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(r.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new o(r.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(96),e.setImmediate=\"undefined\"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate=\"undefined\"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(0))},function(t,e,n){(function(t,e){!function(t,n){\"use strict\";if(!t.setImmediate){var i,r,o,s,a,h=1,c={},l=!1,u=t.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(t);p=p&&p.setTimeout?p:t,\"[object process]\"==={}.toString.call(t.process)?i=function(t){e.nextTick(function(){d(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage(\"\",\"*\"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){d(t.data)},i=function(t){o.port2.postMessage(t)}):u&&\"onreadystatechange\"in u.createElement(\"script\")?(r=u.documentElement,i=function(t){var e=u.createElement(\"script\");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,r.removeChild(e),e=null},r.appendChild(e)}):i=function(t){setTimeout(d,0,t)}:(s=\"setImmediate$\"+Math.random()+\"$\",a=function(e){e.source===t&&\"string\"==typeof e.data&&0===e.data.indexOf(s)&&d(+e.data.slice(s.length))},t.addEventListener?t.addEventListener(\"message\",a,!1):t.attachEvent(\"onmessage\",a),i=function(e){t.postMessage(s+e,\"*\")}),p.setImmediate=function(t){\"function\"!=typeof t&&(t=new Function(\"\"+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return c[h]=r,i(h),h++},p.clearImmediate=f}function f(t){delete c[t]}function d(t){if(l)setTimeout(d,0,t);else{var e=c[t];if(e){l=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(n,i)}}(e)}finally{f(t),l=!1}}}}}(\"undefined\"==typeof self?void 0===t?this:t:self)}).call(this,n(0),n(2))},function(t,e,n){(function(e){function n(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&\"true\"===String(n).toLowerCase()}t.exports=function(t,e){if(n(\"noDeprecation\"))return t;var i=!1;return function(){if(!i){if(n(\"throwDeprecation\"))throw new Error(e);n(\"traceDeprecation\")?console.trace(e):console.warn(e),i=!0}return t.apply(this,arguments)}}}).call(this,n(0))},function(t,e,n){\"use strict\";t.exports=o;var i=n(43),r=n(9);function o(t){if(!(this instanceof o))return new o(t);i.call(this,t)}r.inherits=n(4),r.inherits(o,i),o.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){var i=n(3).Buffer;t.exports=function(t){if(t instanceof Uint8Array){if(0===t.byteOffset&&t.byteLength===t.buffer.byteLength)return t.buffer;if(\"function\"==typeof t.buffer.slice)return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}if(i.isBuffer(t)){for(var e=new Uint8Array(t.length),n=t.length,r=0;r<n;r++)e[r]=t[r];return e.buffer}throw new Error(\"Argument must be a Buffer\")}},function(t,e){t.exports=function(){for(var t={},e=0;e<arguments.length;e++){var i=arguments[e];for(var r in i)n.call(i,r)&&(t[r]=i[r])}return t};var n=Object.prototype.hasOwnProperty},function(t,e){t.exports={100:\"Continue\",101:\"Switching Protocols\",102:\"Processing\",200:\"OK\",201:\"Created\",202:\"Accepted\",203:\"Non-Authoritative Information\",204:\"No Content\",205:\"Reset Content\",206:\"Partial Content\",207:\"Multi-Status\",208:\"Already Reported\",226:\"IM Used\",300:\"Multiple Choices\",301:\"Moved Permanently\",302:\"Found\",303:\"See Other\",304:\"Not Modified\",305:\"Use Proxy\",307:\"Temporary Redirect\",308:\"Permanent Redirect\",400:\"Bad Request\",401:\"Unauthorized\",402:\"Payment Required\",403:\"Forbidden\",404:\"Not Found\",405:\"Method Not Allowed\",406:\"Not Acceptable\",407:\"Proxy Authentication Required\",408:\"Request Timeout\",409:\"Conflict\",410:\"Gone\",411:\"Length Required\",412:\"Precondition Failed\",413:\"Payload Too Large\",414:\"URI Too Long\",415:\"Unsupported Media Type\",416:\"Range Not Satisfiable\",417:\"Expectation Failed\",418:\"I'm a teapot\",421:\"Misdirected Request\",422:\"Unprocessable Entity\",423:\"Locked\",424:\"Failed Dependency\",425:\"Unordered Collection\",426:\"Upgrade Required\",428:\"Precondition Required\",429:\"Too Many Requests\",431:\"Request Header Fields Too Large\",451:\"Unavailable For Legal Reasons\",500:\"Internal Server Error\",501:\"Not Implemented\",502:\"Bad Gateway\",503:\"Service Unavailable\",504:\"Gateway Timeout\",505:\"HTTP Version Not Supported\",506:\"Variant Also Negotiates\",507:\"Insufficient Storage\",508:\"Loop Detected\",509:\"Bandwidth Limit Exceeded\",510:\"Not Extended\",511:\"Network Authentication Required\"}},function(t,e,n){\"use strict\";var i=n(103),r=n(105);function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.parse=b,e.resolve=function(t,e){return b(t,!1,!0).resolve(e)},e.resolveObject=function(t,e){return t?b(t,!1,!0).resolveObject(e):e},e.format=function(t){r.isString(t)&&(t=b(t));return t instanceof o?t.format():o.prototype.format.call(t)},e.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,h=/^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,c=[\"{\",\"}\",\"|\",\"\\\\\",\"^\",\"`\"].concat([\"<\",\">\",'\"',\"`\",\" \",\"\\r\",\"\\n\",\"\\t\"]),l=[\"'\"].concat(c),u=[\"%\",\"/\",\"?\",\";\",\"#\"].concat(l),p=[\"/\",\"?\",\"#\"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,y={javascript:!0,\"javascript:\":!0},v={javascript:!0,\"javascript:\":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,\"http:\":!0,\"https:\":!0,\"ftp:\":!0,\"gopher:\":!0,\"file:\":!0},g=n(106);function b(t,e,n){if(t&&r.isObject(t)&&t instanceof o)return t;var i=new o;return i.parse(t,e,n),i}o.prototype.parse=function(t,e,n){if(!r.isString(t))throw new TypeError(\"Parameter 'url' must be a string, not \"+typeof t);var o=t.indexOf(\"?\"),a=-1!==o&&o<t.indexOf(\"#\")?\"?\":\"#\",c=t.split(a);c[0]=c[0].replace(/\\\\/g,\"/\");var b=t=c.join(a);if(b=b.trim(),!n&&1===t.split(\"#\").length){var w=h.exec(b);if(w)return this.path=b,this.href=b,this.pathname=w[1],w[2]?(this.search=w[2],this.query=e?g.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search=\"\",this.query={}),this}var x=s.exec(b);if(x){var E=(x=x[0]).toLowerCase();this.protocol=E,b=b.substr(x.length)}if(n||x||b.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)){var C=\"//\"===b.substr(0,2);!C||x&&v[x]||(b=b.substr(2),this.slashes=!0)}if(!v[x]&&(C||x&&!m[x])){for(var S,T,A=-1,B=0;B<p.length;B++){-1!==(R=b.indexOf(p[B]))&&(-1===A||R<A)&&(A=R)}-1!==(T=-1===A?b.lastIndexOf(\"@\"):b.lastIndexOf(\"@\",A))&&(S=b.slice(0,T),b=b.slice(T+1),this.auth=decodeURIComponent(S)),A=-1;for(B=0;B<u.length;B++){var R;-1!==(R=b.indexOf(u[B]))&&(-1===A||R<A)&&(A=R)}-1===A&&(A=b.length),this.host=b.slice(0,A),b=b.slice(A),this.parseHost(),this.hostname=this.hostname||\"\";var _=\"[\"===this.hostname[0]&&\"]\"===this.hostname[this.hostname.length-1];if(!_)for(var P=this.hostname.split(/\\./),F=(B=0,P.length);B<F;B++){var I=P[B];if(I&&!I.match(f)){for(var k=\"\",M=0,j=I.length;M<j;M++)I.charCodeAt(M)>127?k+=\"x\":k+=I[M];if(!k.match(f)){var N=P.slice(0,B),O=P.slice(B+1),L=I.match(d);L&&(N.push(L[1]),O.unshift(L[2])),O.length&&(b=\"/\"+O.join(\".\")+b),this.hostname=N.join(\".\");break}}}this.hostname.length>255?this.hostname=\"\":this.hostname=this.hostname.toLowerCase(),_||(this.hostname=i.toASCII(this.hostname));var q=this.port?\":\"+this.port:\"\",z=this.hostname||\"\";this.host=z+q,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),\"/\"!==b[0]&&(b=\"/\"+b))}if(!y[E])for(B=0,F=l.length;B<F;B++){var U=l[B];if(-1!==b.indexOf(U)){var D=encodeURIComponent(U);D===U&&(D=escape(U)),b=b.split(U).join(D)}}var W=b.indexOf(\"#\");-1!==W&&(this.hash=b.substr(W),b=b.slice(0,W));var V=b.indexOf(\"?\");if(-1!==V?(this.search=b.substr(V),this.query=b.substr(V+1),e&&(this.query=g.parse(this.query)),b=b.slice(0,V)):e&&(this.search=\"\",this.query={}),b&&(this.pathname=b),m[E]&&this.hostname&&!this.pathname&&(this.pathname=\"/\"),this.pathname||this.search){q=this.pathname||\"\";var Y=this.search||\"\";this.path=q+Y}return this.href=this.format(),this},o.prototype.format=function(){var t=this.auth||\"\";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,\":\"),t+=\"@\");var e=this.protocol||\"\",n=this.pathname||\"\",i=this.hash||\"\",o=!1,s=\"\";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(\":\")?this.hostname:\"[\"+this.hostname+\"]\"),this.port&&(o+=\":\"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(s=g.stringify(this.query));var a=this.search||s&&\"?\"+s||\"\";return e&&\":\"!==e.substr(-1)&&(e+=\":\"),this.slashes||(!e||m[e])&&!1!==o?(o=\"//\"+(o||\"\"),n&&\"/\"!==n.charAt(0)&&(n=\"/\"+n)):o||(o=\"\"),i&&\"#\"!==i.charAt(0)&&(i=\"#\"+i),a&&\"?\"!==a.charAt(0)&&(a=\"?\"+a),e+o+(n=n.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(a=a.replace(\"#\",\"%23\"))+i},o.prototype.resolve=function(t){return this.resolveObject(b(t,!1,!0)).format()},o.prototype.resolveObject=function(t){if(r.isString(t)){var e=new o;e.parse(t,!1,!0),t=e}for(var n=new o,i=Object.keys(this),s=0;s<i.length;s++){var a=i[s];n[a]=this[a]}if(n.hash=t.hash,\"\"===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),c=0;c<h.length;c++){var l=h[c];\"protocol\"!==l&&(n[l]=t[l])}return m[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname=\"/\"),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!m[t.protocol]){for(var u=Object.keys(t),p=0;p<u.length;p++){var f=u[p];n[f]=t[f]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||v[t.protocol])n.pathname=t.pathname;else{for(var d=(t.pathname||\"\").split(\"/\");d.length&&!(t.host=d.shift()););t.host||(t.host=\"\"),t.hostname||(t.hostname=\"\"),\"\"!==d[0]&&d.unshift(\"\"),d.length<2&&d.unshift(\"\"),n.pathname=d.join(\"/\")}if(n.search=t.search,n.query=t.query,n.host=t.host||\"\",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var y=n.pathname||\"\",g=n.search||\"\";n.path=y+g}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var b=n.pathname&&\"/\"===n.pathname.charAt(0),w=t.host||t.pathname&&\"/\"===t.pathname.charAt(0),x=w||b||n.host&&t.pathname,E=x,C=n.pathname&&n.pathname.split(\"/\")||[],S=(d=t.pathname&&t.pathname.split(\"/\")||[],n.protocol&&!m[n.protocol]);if(S&&(n.hostname=\"\",n.port=null,n.host&&(\"\"===C[0]?C[0]=n.host:C.unshift(n.host)),n.host=\"\",t.protocol&&(t.hostname=null,t.port=null,t.host&&(\"\"===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),x=x&&(\"\"===d[0]||\"\"===C[0])),w)n.host=t.host||\"\"===t.host?t.host:n.host,n.hostname=t.hostname||\"\"===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,C=d;else if(d.length)C||(C=[]),C.pop(),C=C.concat(d),n.search=t.search,n.query=t.query;else if(!r.isNullOrUndefined(t.search)){if(S)n.hostname=n.host=C.shift(),(_=!!(n.host&&n.host.indexOf(\"@\")>0)&&n.host.split(\"@\"))&&(n.auth=_.shift(),n.host=n.hostname=_.shift());return n.search=t.search,n.query=t.query,r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:\"\")+(n.search?n.search:\"\")),n.href=n.format(),n}if(!C.length)return n.pathname=null,n.search?n.path=\"/\"+n.search:n.path=null,n.href=n.format(),n;for(var T=C.slice(-1)[0],A=(n.host||t.host||C.length>1)&&(\".\"===T||\"..\"===T)||\"\"===T,B=0,R=C.length;R>=0;R--)\".\"===(T=C[R])?C.splice(R,1):\"..\"===T?(C.splice(R,1),B++):B&&(C.splice(R,1),B--);if(!x&&!E)for(;B--;B)C.unshift(\"..\");!x||\"\"===C[0]||C[0]&&\"/\"===C[0].charAt(0)||C.unshift(\"\"),A&&\"/\"!==C.join(\"/\").substr(-1)&&C.push(\"\");var _,P=\"\"===C[0]||C[0]&&\"/\"===C[0].charAt(0);S&&(n.hostname=n.host=P?\"\":C.length?C.shift():\"\",(_=!!(n.host&&n.host.indexOf(\"@\")>0)&&n.host.split(\"@\"))&&(n.auth=_.shift(),n.host=n.hostname=_.shift()));return(x=x||n.host&&C.length)&&!P&&C.unshift(\"\"),C.length?n.pathname=C.join(\"/\"):(n.pathname=null,n.path=null),r.isNull(n.pathname)&&r.isNull(n.search)||(n.path=(n.pathname?n.pathname:\"\")+(n.search?n.search:\"\")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var t=this.host,e=a.exec(t);e&&(\":\"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},function(t,e,n){(function(t,i){var r;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(o){e&&e.nodeType,t&&t.nodeType;var s=\"object\"==typeof i&&i;s.global!==s&&s.window!==s&&s.self;var a,h=2147483647,c=36,l=1,u=26,p=38,f=700,d=72,y=128,v=\"-\",m=/^xn--/,g=/[^\\x20-\\x7E]/,b=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,w={overflow:\"Overflow: input needs wider integers to process\",\"not-basic\":\"Illegal input >= 0x80 (not a basic code point)\",\"invalid-input\":\"Invalid input\"},x=c-l,E=Math.floor,C=String.fromCharCode;function S(t){throw new RangeError(w[t])}function T(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function A(t,e){var n=t.split(\"@\"),i=\"\";return n.length>1&&(i=n[0]+\"@\",t=n[1]),i+T((t=t.replace(b,\".\")).split(\".\"),e).join(\".\")}function B(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function R(t){return T(t,function(t){var e=\"\";return t>65535&&(e+=C((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=C(t)}).join(\"\")}function _(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function P(t,e,n){var i=0;for(t=n?E(t/f):t>>1,t+=E(t/e);t>x*u>>1;i+=c)t=E(t/x);return E(i+(x+1)*t/(t+p))}function F(t){var e,n,i,r,o,s,a,p,f,m,g,b=[],w=t.length,x=0,C=y,T=d;for((n=t.lastIndexOf(v))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&S(\"not-basic\"),b.push(t.charCodeAt(i));for(r=n>0?n+1:0;r<w;){for(o=x,s=1,a=c;r>=w&&S(\"invalid-input\"),((p=(g=t.charCodeAt(r++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:c)>=c||p>E((h-x)/s))&&S(\"overflow\"),x+=p*s,!(p<(f=a<=T?l:a>=T+u?u:a-T));a+=c)s>E(h/(m=c-f))&&S(\"overflow\"),s*=m;T=P(x-o,e=b.length+1,0==o),E(x/e)>h-C&&S(\"overflow\"),C+=E(x/e),x%=e,b.splice(x++,0,C)}return R(b)}function I(t){var e,n,i,r,o,s,a,p,f,m,g,b,w,x,T,A=[];for(b=(t=B(t)).length,e=y,n=0,o=d,s=0;s<b;++s)(g=t[s])<128&&A.push(C(g));for(i=r=A.length,r&&A.push(v);i<b;){for(a=h,s=0;s<b;++s)(g=t[s])>=e&&g<a&&(a=g);for(a-e>E((h-n)/(w=i+1))&&S(\"overflow\"),n+=(a-e)*w,e=a,s=0;s<b;++s)if((g=t[s])<e&&++n>h&&S(\"overflow\"),g==e){for(p=n,f=c;!(p<(m=f<=o?l:f>=o+u?u:f-o));f+=c)T=p-m,x=c-m,A.push(C(_(m+T%x,0))),p=E(T/x);A.push(C(_(p,0))),o=P(n,w,i==r),n=0,++i}++n,++e}return A.join(\"\")}a={version:\"1.4.1\",ucs2:{decode:B,encode:R},decode:F,encode:I,toASCII:function(t){return A(t,function(t){return g.test(t)?\"xn--\"+I(t):t})},toUnicode:function(t){return A(t,function(t){return m.test(t)?F(t.slice(4).toLowerCase()):t})}},void 0===(r=function(){return a}.call(e,n,e,t))||(t.exports=r)}()}).call(this,n(104)(t),n(0))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,\"loaded\",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,\"id\",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e,n){\"use strict\";t.exports={isString:function(t){return\"string\"==typeof t},isObject:function(t){return\"object\"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}},function(t,e,n){\"use strict\";e.decode=e.parse=n(107),e.encode=e.stringify=n(108)},function(t,e,n){\"use strict\";function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,n,o){e=e||\"&\",n=n||\"=\";var s={};if(\"string\"!=typeof t||0===t.length)return s;var a=/\\+/g;t=t.split(e);var h=1e3;o&&\"number\"==typeof o.maxKeys&&(h=o.maxKeys);var c=t.length;h>0&&c>h&&(c=h);for(var l=0;l<c;++l){var u,p,f,d,y=t[l].replace(a,\"%20\"),v=y.indexOf(n);v>=0?(u=y.substr(0,v),p=y.substr(v+1)):(u=y,p=\"\"),f=decodeURIComponent(u),d=decodeURIComponent(p),i(s,f)?r(s[f])?s[f].push(d):s[f]=[s[f],d]:s[f]=d}return s};var r=Array.isArray||function(t){return\"[object Array]\"===Object.prototype.toString.call(t)}},function(t,e,n){\"use strict\";var i=function(t){switch(typeof t){case\"string\":return t;case\"boolean\":return t?\"true\":\"false\";case\"number\":return isFinite(t)?t:\"\";default:return\"\"}};t.exports=function(t,e,n,a){return e=e||\"&\",n=n||\"=\",null===t&&(t=void 0),\"object\"==typeof t?o(s(t),function(s){var a=encodeURIComponent(i(s))+n;return r(t[s])?o(t[s],function(t){return a+encodeURIComponent(i(t))}).join(e):a+encodeURIComponent(i(t[s]))}).join(e):a?encodeURIComponent(i(a))+n+encodeURIComponent(i(t)):\"\"};var r=Array.isArray||function(t){return\"[object Array]\"===Object.prototype.toString.call(t)};function o(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i++)n.push(e(t[i],i));return n}var s=Object.keys||function(t){var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e}},function(t,e,n){\"use strict\";n.r(e);class i{static hashStr(t,e){let n=5381,i=t.length;for(e=e||8;i;)n=33*n^t.charCodeAt(--i);return n>>>=0,n%=Math.pow(2,e)-1}static arrayBuffersEqual(t,e){if(t.byteLength!==e.byteLength)return!1;let n=new Int8Array(t),i=new Int8Array(e);for(let e=0;e!==t.byteLength;e++)if(n[e]!==i[e])return!1;return!0}static httpGetPromise(t){return new Promise((e,n)=>{let i=new XMLHttpRequest;i.open(\"GET\",t,!0),i.onload=(()=>{i.status>=200&&i.status<400?e(JSON.parse(i.responseText)):n()}),i.onerror=(()=>{}),i.send()})}}class r{}r.TYPES={FLOAT32:\"FLOAT32\",INT32:\"INT32\",INT16:\"INT16\",INT8:\"INT8\",UINT8:\"UINT8\",STRING:\"STRING\",CLASSINSTANCE:\"CLASSINSTANCE\",LIST:\"LIST\"};var o=r;var s=class{serialize(t,e){let n,r,s,a=0,h=(e=Object.assign({bufferOffset:0},e)).bufferOffset,c=0;if(a=this.classId?this.classId:i.hashStr(this.constructor.name),this.netScheme?n=this.netScheme:this.constructor.netScheme?n=this.constructor.netScheme:console.warn(\"no netScheme defined! This will result in awful performance\"),null==e.dataBuffer&&1!=e.dry){let e=this.serialize(t,{dry:!0}).bufferOffset;r=new ArrayBuffer(e)}else r=e.dataBuffer;if(1!=e.dry&&(s=new DataView(r)).setUint8(h+c,a),c+=Uint8Array.BYTES_PER_ELEMENT,n)for(let i of Object.keys(n).sort())if(1!=e.dry&&t.writeDataView(s,this[i],h+c,n[i]),n[i].type===o.TYPES.STRING)c+=Uint16Array.BYTES_PER_ELEMENT,null!==this[i]&&void 0!==this[i]&&(c+=this[i].length*Uint16Array.BYTES_PER_ELEMENT);else if(n[i].type===o.TYPES.CLASSINSTANCE)c+=this[i].serialize(t,{dry:!0}).bufferOffset;else if(n[i].type===o.TYPES.LIST){c+=Uint16Array.BYTES_PER_ELEMENT;for(let e of this[i])n[i].itemType===o.TYPES.CLASSINSTANCE?c+=e.serialize(t,{dry:!0}).bufferOffset:n[i].itemType===o.TYPES.STRING?c+=Uint16Array.BYTES_PER_ELEMENT*(1+e.length):c+=t.getTypeByteSize(n[i].itemType)}else c+=t.getTypeByteSize(n[i].type);return{dataBuffer:r,bufferOffset:c}}prunedStringsClone(t,e){if(!e)return this;e=t.deserialize(e).obj;let n=this.constructor.netScheme,i=Object.keys(n).filter(t=>n[t].type===o.TYPES.STRING).filter(t=>e[t]!==this[t]);if(0==i.length)return this;let r=new this.constructor(null,{id:null});for(let t of Object.keys(n))r[t]=i.indexOf(t)<0?this[t]:null;return r}syncTo(t){let e=this.constructor.netScheme;for(let n of Object.keys(e))e[n].type!==o.TYPES.LIST&&e[n].type!==o.TYPES.CLASSINSTANCE&&(e[n].type!==o.TYPES.STRING?this[n]=t[n]:\"string\"==typeof t[n]&&(this[n]=t[n]))}};class a extends s{static get netScheme(){return{x:{type:o.TYPES.FLOAT32},y:{type:o.TYPES.FLOAT32}}}constructor(t,e){return super(),this.x=t,this.y=e,this}toString(){function t(t){return Math.round(1e3*t)/1e3}return`[${t(this.x)}, ${t(this.y)}]`}set(t,e){return this.x=t,this.y=e,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){return this.multiplyScalar(1/this.length()),this}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return new a(this.x,this.y)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}getBendingDelta(t,e){let n=t.clone();return n.subtract(this),n.multiplyScalar(e.percent),\"number\"==typeof e.max&&n.length()>e.max||\"number\"==typeof e.min&&n.length()<e.min?new a(0,0):(n.multiplyScalar(1/e.increments),n)}}var h=a;var c=class extends s{static get netScheme(){return{id:{type:o.TYPES.INT32}}}constructor(t,e){super(),this.gameEngine=t,this.id=null,e&&\"id\"in e?this.id=e.id:this.gameEngine&&(this.id=this.gameEngine.world.getNewId()),this.components={}}onAddToWorld(t){}onRemoveFromWorld(t){}toString(){return`game-object[${this.id}]`}bendingToString(){return\"no bending\"}saveState(t){this.savedCopy=new this.constructor(this.gameEngine,{id:null}),this.savedCopy.syncTo(t||this)}get bending(){return{position:{percent:1,min:0},velocity:{percent:0,min:0},angularVelocity:{percent:0},angleLocal:{percent:1}}}bendToCurrentState(t,e,n,i){this.savedCopy&&this.bendToCurrent(this.savedCopy,t,e,n,i),this.savedCopy=null}bendToCurrent(t,e,n,i,r){}syncTo(t){super.syncTo(t)}refreshToPhysics(){}refreshFromPhysics(){}applyIncrementalBending(){}destroy(){}addComponent(t){t.parentObject=this,this.components[t.constructor.name]=t,this.gameEngine&&this.gameEngine.emit(\"componentAdded\",this,t)}removeComponent(t){delete this.components[t],this.gameEngine&&this.gameEngine.emit(\"componentRemoved\",this,t)}hasComponent(t){return t.name in this.components}getComponent(t){return this.components[t.name]}};class l{static interpolate(t,e,n){return(e-t)*n+t}static interpolateDelta(t,e,n){return(e-t)*n}static interpolateDeltaWithWrapping(t,e,n,i,r){let o=r-i;return t-e>o/2?e+=o:e-t>o/2&&(t+=o),Math.abs(t-e)>o/3&&console.log(\"wrap interpolation is close to limit.  Not sure which edge to wrap to.\"),(e-t)*n}static interpolateWithWrapping(t,e,n,i,r){let o=t+this.interpolateDeltaWithWrapping(t,e,n,i,r),s=r-i;return o>=s&&(o-=s),o<0&&(o+=s),o}}var u=class extends c{static get netScheme(){return Object.assign({playerId:{type:o.TYPES.INT16},position:{type:o.TYPES.CLASSINSTANCE},width:{type:o.TYPES.INT16},height:{type:o.TYPES.INT16},isStatic:{type:o.TYPES.UINT8},velocity:{type:o.TYPES.CLASSINSTANCE},angle:{type:o.TYPES.FLOAT32}},super.netScheme)}constructor(t,e,n){super(t,e),this.playerId=n&&n.playerId?n.playerId:0,this.bendingIncrements=0,this.position=new h(0,0),this.velocity=new h(0,0),this.width=n&&n.width?n.width:1,this.height=n&&n.height?n.height:1,this.isStatic=n&&n.isStatic?n.isStatic:0,this.friction=new h(1,1),n&&n.playerId&&(this.playerId=n.playerId),n&&n.position&&this.position.copy(n.position),n&&n.velocity&&this.velocity.copy(n.velocity),this.angle=90,this.isRotatingLeft=!1,this.isRotatingRight=!1,this.isAccelerating=!1,this.rotationSpeed=2.5,this.acceleration=.1,this.deceleration=.99}get x(){return this.position.x}get y(){return this.position.y}toString(){return`${this.constructor.name}[${this.id}] player${this.playerId} Pos=${this.position} Vel=${this.velocity} angle${t=this.angle,Math.round(1e3*t)/1e3}`;var t}get bending(){return{}}turnRight(t){return this.angle+=t,this.angle>=360&&(this.angle-=360),this.angle<0&&(this.angle+=360),this}turnLeft(t){return this.turnRight(-t)}accelerate(t){let e=this.angle*(Math.PI/180),n=new h(Math.cos(e),Math.sin(e));return n.multiplyScalar(t),this.velocity.add(n),this}bendingToString(){return this.bendingIncrements?`ΔPos=${this.bendingPositionDelta} ΔVel=${this.bendingVelocityDelta} ΔAngle=${this.bendingAngleDelta} increments=${this.bendingIncrements}`:\"no bending\"}get maxSpeed(){return null}syncTo(t){super.syncTo(t),this.position.copy(t.position),this.velocity.copy(t.velocity),this.width=t.width,this.height=t.height,this.bendingAngle=t.bendingAngle,this.rotationSpeed=t.rotationSpeed,this.acceleration=t.acceleration,this.deceleration=t.deceleration}bendToCurrent(t,e,n,i,r){let o={increments:r,percent:e},s=Object.assign({},o,this.bending.position),a=Object.assign({},o,this.bending.velocity),h=Object.assign({},o,this.bending.angle);i&&(Object.assign(s,this.bending.positionLocal),Object.assign(a,this.bending.velocityLocal),Object.assign(h,this.bending.angleLocal)),this.incrementScale=e/r,this.bendingPositionDelta=t.position.getBendingDelta(this.position,s),this.bendingVelocityDelta=t.velocity.getBendingDelta(this.velocity,a),this.bendingAngleDelta=l.interpolateDeltaWithWrapping(t.angle,this.angle,h.percent,0,360)/r,this.bendingTarget=new this.constructor,this.bendingTarget.syncTo(this),this.position.copy(t.position),this.velocity.copy(t.velocity),this.angle=t.angle,this.bendingIncrements=r,this.bendingOptions=o}applyIncrementalBending(t){if(0===this.bendingIncrements)return;let e=1;t&&t.dt&&(e=t.dt/(1e3/60));const n=this.bendingPositionDelta.clone().multiplyScalar(e),i=this.bendingVelocityDelta.clone().multiplyScalar(e);this.position.add(n),this.velocity.add(i),this.angle+=this.bendingAngleDelta*e,this.bendingIncrements--}getAABB(){return{min:[this.x-this.width/2,this.y-this.height/2],max:[this.x+this.width/2,this.y+this.height/2]}}collidesWith(t){return!0}};class p extends u{constructor(t,e,n){super(t,e,n),console.log(\"observable object has been created\")}}var f=n(44);class d{constructor(t){this.options=t,this.gameEngine=t.gameEngine,t.gameEngine||console.warn(\"Physics engine initialized without gameEngine!\")}step(t,e){}}var y=n(1);var v=class extends d{constructor(t){super(t),this.options.dt=this.options.dt||1/60;let e=this.world=new y.World;e.quatNormalizeSkip=0,e.quatNormalizeFast=!1,e.gravity.set(0,-10,0),e.broadphase=new y.NaiveBroadphase,this.CANNON=y}step(t,e){this.world.step(t||this.options.dt)}addSphere(t,e){let n=new y.Sphere(t),i=new y.Body({mass:e,shape:n});return i.position.set(0,0,0),this.world.addBody(i),i}addBox(t,e,n,i,r){let o={mass:i,shape:new y.Box(new y.Vec3(t,e,n))};void 0!==r&&(o.material=new y.Material({friction:r}));let s=new y.Body(o);return s.position.set(0,0,0),this.world.addBody(s),s}addCylinder(t,e,n,i,r){let o=new y.Cylinder(t,e,n,i),s=new y.Body({mass:r,shape:o});return this.world.addBody(s),s}removeObject(t){this.world.removeBody(t)}};var m=n(46),g=n.n(m),b=n(8),w=n.n(b);const x=1e3/60,E=.3,C=10;class S{constructor(t){this.options=Object.assign({tick:null,period:x,delay:x/3},t),this.nextExecTime=null,this.requestedDelay=0,this.delayCounter=0;let e=new w.a;this.on=e.on,this.once=e.once,this.removeListener=e.removeListener,this.emit=e.emit}nextTickChecker(){let t=(new Date).getTime();t>this.nextExecTime&&(this.delayCounter++,this.callTick(),this.nextExecTime=t+this.options.stepPeriod),window.requestAnimationFrame(this.nextTickChecker.bind(this))}nextTick(){let t=(new Date).getTime();t>this.nextExecTime+this.options.period*E?this.delayCounter++:this.delayCounter=0,this.callTick(),this.nextExecTime=t+this.options.period+this.requestedDelay,this.requestedDelay=0,setTimeout(this.nextTick.bind(this),this.nextExecTime-(new Date).getTime())}callTick(){this.delayCounter>=C&&(this.emit(\"loopRunningSlow\"),this.delayCounter=0),this.options.tick()}start(){return setTimeout(this.nextTick.bind(this)),\"object\"==typeof window&&\"function\"==typeof window.requestAnimationFrame&&window.requestAnimationFrame(this.nextTickChecker.bind(this)),this}delayTick(){this.requestedDelay+=this.options.delay}hurryTick(){this.requestedDelay-=this.options.delay}}class T{constructor(t,e){this.clientEngine=t,this.gameEngine=t.gameEngine,this.options=Object.assign({},e),this.gameEngine.on(\"client__postStep\",this.syncStep.bind(this)),this.gameEngine.on(\"client__syncReceived\",this.collectSync.bind(this)),this.requiredSyncs=[],this.SYNC_APPLIED=\"SYNC_APPLIED\",this.STEP_DRIFT_THRESHOLDS={onServerSync:{MAX_LEAD:1,MAX_LAG:3},onEveryStep:{MAX_LEAD:7,MAX_LAG:8},clientReset:20}}collectSync(t){if(this.needFirstSync){if(!t.fullUpdate)return}else if(this.lastSync&&this.lastSync.stepCount&&this.lastSync.stepCount>t.stepCount)return;this.lastSync&&this.lastSync.required&&this.requiredSyncs.push(this.lastSync);let e=this.lastSync={stepCount:t.stepCount,fullUpdate:t.fullUpdate,syncObjects:{},syncSteps:{}};t.syncEvents.forEach(t=>{if(t.objectInstance){let n=t.objectInstance.id;e.syncObjects[n]||(e.syncObjects[n]=[]),e.syncObjects[n].push(t)}let n=t.stepCount,i=t.eventName;\"objectDestroy\"!==i&&\"objectCreate\"!==i||(e.required=!0),e.syncSteps[n]||(e.syncSteps[n]={}),e.syncSteps[n][i]||(e.syncSteps[n][i]=[]),e.syncSteps[n][i].push(t)});let n=t.syncEvents.length,i=Object.keys(e.syncObjects).length,r=Object.keys(e.syncSteps).length;this.gameEngine.trace.debug(()=>`sync contains ${i} objects ${n} events ${r} steps`)}addNewObject(t,e,n){let i=new e.constructor(this.gameEngine,{id:t});if(!i.__proto__.hasOwnProperty(\"syncTo\"))throw`GameObject of type ${i.class} does not implement the syncTo() method, which must copy the netscheme`;return i.syncTo(e),this.gameEngine.addObjectToWorld(i),this.clientEngine.options.verbose&&console.log(`adding new object ${i}`),i}syncStep(t){for(this.gameEngine.world.forEachObject((e,n)=>{\"function\"==typeof n.applyIncrementalBending&&(n.applyIncrementalBending(t),n.refreshToPhysics())});this.requiredSyncs.length;){let t=this.requiredSyncs[0].stepCount;if(t>this.gameEngine.world.stepCount)return;this.gameEngine.trace.trace(()=>`applying a required sync ${t}`),this.applySync(this.requiredSyncs.shift(),!0)}if(this.lastSync){this.applySync(this.lastSync,!1)===this.SYNC_APPLIED&&(this.lastSync=null)}}}const A={clientStepHold:6,localObjBending:1,remoteObjBending:1,bendingIncrements:6,reflect:!1};const B={syncsBufferLength:5,maxReEnactSteps:60,RTTEstimate:2,extrapolate:2,localObjBending:.1,remoteObjBending:.6,bendingIncrements:10};const R={worldBufferLength:60,clientStepLag:0};const _={extrapolate:class extends T{constructor(t,e){super(t,Object.assign({},B,e)),this.lastSync=null,this.needFirstSync=!0,this.recentInputs={},this.gameEngine.on(\"client__processInput\",this.clientInputSave.bind(this)),this.STEP_DRIFT_THRESHOLDS={onServerSync:{MAX_LEAD:2,MAX_LAG:3},onEveryStep:{MAX_LEAD:7,MAX_LAG:4},clientReset:40}}clientInputSave(t){this.recentInputs[t.input.step]||(this.recentInputs[t.input.step]=[]),this.recentInputs[t.input.step].push(t.input)}cleanRecentInputs(t){for(let e of Object.keys(this.recentInputs))this.recentInputs[e][0].step<=t&&delete this.recentInputs[e]}applySync(t,e){if(!e&&t.stepCount>this.gameEngine.world.stepCount)return null;this.gameEngine.trace.debug(()=>\"extrapolate applying sync\"),this.needFirstSync=!1;let n=this.gameEngine.world,i=t.stepCount;for(let e of Object.keys(t.syncObjects)){let i=t.syncObjects[e][0],r=n.objects[i.objectInstance.id],o=this.gameEngine.findLocalShadow(i.objectInstance);o?(this.gameEngine.trace.debug(()=>`object ${i.objectInstance.id} replacing local shadow ${o.id}`),n.objects.hasOwnProperty(i.objectInstance.id)||this.addNewObject(i.objectInstance.id,i.objectInstance,{visible:!1}).saveState(o),this.gameEngine.removeObjectFromWorld(o.id)):r?(this.gameEngine.trace.trace(()=>`object before syncTo: ${r.toString()}`),r.saveState(),r.syncTo(i.objectInstance),this.gameEngine.trace.trace(()=>`object after syncTo: ${r.toString()} synced to step[${i.stepCount}]`)):this.addNewObject(i.objectInstance.id,i.objectInstance)}this.gameEngine.trace.debug(()=>`extrapolate re-enacting steps from [${i}] to [${n.stepCount}]`),i<n.stepCount-this.options.maxReEnactSteps&&(i=n.stepCount-this.options.maxReEnactSteps,this.gameEngine.trace.info(()=>`too many steps to re-enact.  Starting from [${i}] to [${n.stepCount}]`));let r=n.stepCount;for(n.stepCount=i;n.stepCount<r;)this.recentInputs[n.stepCount]&&this.recentInputs[n.stepCount].forEach(t=>{t.options&&t.options.movement&&(this.gameEngine.trace.trace(()=>`extrapolate re-enacting movement input[${t.messageIndex}]: ${t.input}`),this.gameEngine.processInput(t,this.gameEngine.playerId))}),this.gameEngine.step(!0);this.cleanRecentInputs(i);for(let t of Object.keys(n.objects)){if(t>=this.gameEngine.options.clientIDSpace)continue;let e=n.objects[t],i=e.playerId==this.gameEngine.playerId,r=i?this.options.localObjBending:this.options.remoteObjBending;e.bendToCurrentState(r,this.gameEngine.worldSettings,i,this.options.bendingIncrements),\"function\"==typeof e.refreshRenderObject&&e.refreshRenderObject(),this.gameEngine.trace.trace(()=>`object[${t}] ${e.bendingToString()}`)}for(let t of Object.keys(n.objects))this.gameEngine.trace.trace(()=>`object after extrapolate replay: ${n.objects[t].toString()}`);for(let e of Object.keys(n.objects)){let n=t.syncObjects[e];t.fullUpdate&&!n&&e<this.gameEngine.options.clientIDSpace?this.gameEngine.removeObjectFromWorld(e):!n||e>=this.gameEngine.options.clientIDSpace||n.forEach(t=>{\"objectDestroy\"===t.eventName&&this.gameEngine.removeObjectFromWorld(e)})}return this.SYNC_APPLIED}},interpolate:class extends T{constructor(t,e){super(t,Object.assign({},A,e)),this.gameEngine.ignoreInputs=!0,this.gameEngine.ignorePhysics=!0,this.STEP_DRIFT_THRESHOLDS={onServerSync:{MAX_LEAD:-8,MAX_LAG:16},onEveryStep:{MAX_LEAD:-4,MAX_LAG:24},clientReset:40}}applySync(t,e){if(!e&&t.stepCount<=this.gameEngine.world.stepCount)return this.SYNC_APPLIED;this.gameEngine.trace.debug(()=>\"interpolate applying sync\"),this.needFirstSync=!1;let n=this.gameEngine.world;for(let e of Object.keys(t.syncObjects)){let i=t.syncObjects[e][0],r=n.objects[i.objectInstance.id];r?(this.gameEngine.trace.trace(()=>`object before syncTo: ${r.toString()}`),r.saveState(),r.syncTo(i.objectInstance),this.gameEngine.trace.trace(()=>`object after syncTo: ${r.toString()} synced to step[${i.stepCount}]`)):this.addNewObject(i.objectInstance.id,i.objectInstance)}for(let t of Object.keys(n.objects)){let e=n.objects[t],i=e.playerId==this.gameEngine.playerId,r=i?this.options.localObjBending:this.options.remoteObjBending;e.bendToCurrentState(r,this.gameEngine.worldSettings,i,this.options.bendingIncrements),\"function\"==typeof e.refreshRenderObject&&e.refreshRenderObject(),this.gameEngine.trace.trace(()=>`object[${t}] ${e.bendingToString()}`)}for(let e of Object.keys(n.objects)){let n=t.syncObjects[e];t.fullUpdate&&!n&&e<this.gameEngine.options.clientIDSpace?this.gameEngine.removeObjectFromWorld(e):!n||e>=this.gameEngine.options.clientIDSpace||n.forEach(t=>{\"objectDestroy\"===t.eventName&&this.gameEngine.removeObjectFromWorld(e)})}return this.SYNC_APPLIED}},frameSync:class extends T{constructor(t,e){super(t,e),this.options=Object.assign(R,e),this.gameEngine=this.clientEngine.gameEngine,this.gameEngine.on(\"postStep\",this.frameSync.bind(this)),this.gameEngine.on(\"client__syncReceived\",this.keepSnapshot.bind(this))}keepSnapshot(t){(!this.latestSnapshot||t.snapshot.stepCount>this.latestSnapshot.stepCount)&&(this.latestSnapshot=t.snapshot)}frameSync(){let t=this.gameEngine.world,e=this.latestSnapshot;if(e)for(let n in e.objects)if(e.objects.hasOwnProperty(n)){let i=null,r=e.objects[n];t.objects.hasOwnProperty(n)?(i=t.objects[n]).copy(r):((i=new r.constructor).copyFrom(r),t.objects[n]=i,i.init({velX:r.velX,velY:r.velY,velZ:r.velZ}),i.initRenderObject(this.gameEngine.renderer),this.gameEngine.physicsEngine&&i.initPhysicsObject(this.gameEngine.physicsEngine)),i.updateRenderObject()}}}};class P{constructor(t,e){if(this.clientEngine=t,this.options=e||{},!_.hasOwnProperty(this.options.sync))throw new Error(`ERROR: unknown synchronzation strategy ${this.options.sync}`);this.syncStrategy=new _[this.options.sync](this.clientEngine,this.options)}}class F extends s{static get netScheme(){return{x:{type:o.TYPES.FLOAT32},y:{type:o.TYPES.FLOAT32},z:{type:o.TYPES.FLOAT32}}}constructor(t,e,n){return super(),this.x=t,this.y=e,this.z=n,this}toString(){function t(t){return Math.round(1e3*t)/1e3}return`[${t(this.x)}, ${t(this.y)}, ${t(this.z)}]`}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}subtract(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}normalize(){return this.multiplyScalar(1/this.length()),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}set(t,e,n){return this.x=t,this.y=e,this.z=n,this}clone(){return new F(this.x,this.y,this.z)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}getBendingDelta(t,e){let n=t.clone();return n.subtract(this),n.multiplyScalar(e.percent),e.max&&n.length()>e.max||e.max&&n.length()<e.min?new F(0,0,0):(n.multiplyScalar(1/e.increments),n)}}var I=F;const k=!0,M=.2;var j=class extends s{static get netScheme(){return{w:{type:o.TYPES.FLOAT32},x:{type:o.TYPES.FLOAT32},y:{type:o.TYPES.FLOAT32},z:{type:o.TYPES.FLOAT32}}}constructor(t,e,n,i){return super(),this.w=t,this.x=e,this.y=n,this.z=i,this}toString(){function t(t){return Math.round(1e3*t)/1e3}if(k){let e=this.toAxisAngle();return`[${t(e.angle)},${e.axis.toString()}]`}return`[${t(this.w)}, ${t(this.x)}, ${t(this.y)}, ${t(this.z)}]`}copy(t){return this.set(t.w,t.x,t.y,t.z),this}set(t,e,n,i){return this.w=t,this.x=e,this.y=n,this.z=i,this}toAxisAngle(){let t=new I(1,0,0);this.normalize();let e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);if(n>.001){let e=1/n;t.x=this.x*e,t.y=this.y*e,t.z=this.z*e}return n>Math.PI&&(n-=2*Math.PI),{axis:t,angle:e}}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this}setFromAxisAngle(t,e){e<0&&(e+=2*Math.PI);let n=.5*e,i=Math.sin(n);return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this.w=Math.cos(n),this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}multiply(t){let e=this.w,n=this.x,i=this.y,r=this.z,o=t.w,s=t.x,a=t.y,h=t.z;return this.x=n*o+e*s+i*h-r*a,this.y=i*o+e*a+r*s-n*h,this.z=r*o+e*h+n*a-i*s,this.w=e*o-n*s-i*a-r*h,this}slerp(t,e){if(e<=0)return this;if(e>=1)return this.copy(t);let n=this.w,i=this.x,r=this.y,o=this.z,s=t.w,a=t.x,h=t.y,c=t.z,l=n*s+i*a+r*h+o*c;if(l<0?(this.set(-s,-a,-h,-c),l=-l):this.copy(t),l>=1)return this.set(n,i,r,o),this;let u=1-l*l;if(u<Number.EPSILON){let t=1-e;return this.set(t*n+e*this.w,t*i+e*this.x,t*r+e*this.y,t*o+e*this.z),this.normalize()}let p=Math.sqrt(u),f=Math.atan2(p,l),d=e*f;Math.abs(d)>M&&(d=M*Math.sign(d));let y=Math.sin(f-d)/p,v=Math.sin(d)/p;return this.set(n*y+this.w*v,i*y+this.x*v,r*y+this.y*v,o*y+this.z*v),this}};const N=65535;var O=class{constructor(){this.registeredClasses={},this.customTypes={},this.registerClass(h),this.registerClass(I),this.registerClass(j)}addCustomType(t){this.customTypes[t.type]=t}static typeCanAssign(t){return t!==o.TYPES.CLASSINSTANCE&&t!==o.TYPES.LIST}registerClass(t,e){e=e||i.hashStr(t.name),this.registeredClasses[e]&&console.error(`Serializer: accidental override of classId ${e} when registering class`,t),this.registeredClasses[e]=t}deserialize(t,e){e=e||0;let n=0,i=new DataView(t),r=i.getUint8(e+n),o=this.registeredClasses[r];null==o&&console.error(\"Serializer: Found a class which was not registered.  Please use serializer.registerClass() to register all serialized classes.\"),n+=Uint8Array.BYTES_PER_ELEMENT;let s=new o(null,{id:null});for(let t of Object.keys(o.netScheme).sort()){let r=this.readDataView(i,e+n,o.netScheme[t]);s[t]=r.data,n+=r.bufferSize}return{obj:s,byteOffset:n}}writeDataView(t,e,n,i){if(i.type===o.TYPES.FLOAT32)t.setFloat32(n,e);else if(i.type===o.TYPES.INT32)t.setInt32(n,e);else if(i.type===o.TYPES.INT16)t.setInt16(n,e);else if(i.type===o.TYPES.INT8)t.setInt8(n,e);else if(i.type===o.TYPES.UINT8)t.setUint8(n,e);else if(i.type===o.TYPES.STRING)if(null===e)t.setUint16(n,N);else{let i=e.length;t.setUint16(n,i);let r=2;for(let o=0;o<i;o++)t.setUint16(n+r+2*o,e.charCodeAt(o))}else if(i.type===o.TYPES.CLASSINSTANCE)e.serialize(this,{dataBuffer:t.buffer,bufferOffset:n});else if(i.type===o.TYPES.LIST){let r=0;t.setUint16(n+r,e.length),r+=Uint16Array.BYTES_PER_ELEMENT;for(let s of e)if(i.itemType===o.TYPES.CLASSINSTANCE)r+=s.serialize(this,{dataBuffer:t.buffer,bufferOffset:n+r}).bufferOffset;else if(i.itemType===o.TYPES.STRING)if(null===s)t.setUint16(n+r,N),r+=Uint16Array.BYTES_PER_ELEMENT;else{let e=s.length;t.setUint16(n+r,e),r+=Uint16Array.BYTES_PER_ELEMENT;for(let i=0;i<e;i++)t.setUint16(n+r+2*i,s.charCodeAt(i));r+=Uint16Array.BYTES_PER_ELEMENT*e}else this.writeDataView(t,s,n+r,{type:i.itemType}),r+=this.getTypeByteSize(i.itemType)}else this.customTypes[i.type]?this.customTypes[i.type].writeDataView(t,e,n):console.error(`No custom property ${i.type} found!`)}readDataView(t,e,n){let i,r;if(n.type===o.TYPES.FLOAT32)i=t.getFloat32(e),r=this.getTypeByteSize(n.type);else if(n.type===o.TYPES.INT32)i=t.getInt32(e),r=this.getTypeByteSize(n.type);else if(n.type===o.TYPES.INT16)i=t.getInt16(e),r=this.getTypeByteSize(n.type);else if(n.type===o.TYPES.INT8)i=t.getInt8(e),r=this.getTypeByteSize(n.type);else if(n.type===o.TYPES.UINT8)i=t.getUint8(e),r=this.getTypeByteSize(n.type);else if(n.type===o.TYPES.STRING){let n=t.getUint16(e),o=Uint16Array.BYTES_PER_ELEMENT;if(r=o,n===N)i=null;else{let s=[];for(let i=0;i<n;i++)s[i]=t.getUint16(e+o+2*i);i=String.fromCharCode.apply(null,s),r+=n*Uint16Array.BYTES_PER_ELEMENT}}else if(n.type===o.TYPES.CLASSINSTANCE){var s=this.deserialize(t.buffer,e);i=s.obj,r=s.byteOffset}else if(n.type===o.TYPES.LIST){let o=0,s=[],a=t.getUint16(e+o);o+=Uint16Array.BYTES_PER_ELEMENT;for(let i=0;i<a;i++){let i=this.readDataView(t,e+o,{type:n.itemType});s.push(i.data),o+=i.bufferSize}i=s,r=o}else null!=this.customTypes[n.type]?i=this.customTypes[n.type].readDataView(t,e):console.error(`No custom property ${n.type} found!`);return{data:i,bufferSize:r}}getTypeByteSize(t){switch(t){case o.TYPES.FLOAT32:return Float32Array.BYTES_PER_ELEMENT;case o.TYPES.INT32:return Int32Array.BYTES_PER_ELEMENT;case o.TYPES.INT16:return Int16Array.BYTES_PER_ELEMENT;case o.TYPES.INT8:return Int8Array.BYTES_PER_ELEMENT;case o.TYPES.UINT8:return Uint8Array.BYTES_PER_ELEMENT;default:if(void 0===t)throw\"netScheme property declared without type attribute!\";if(null===this.customTypes[t])throw`netScheme property ${t} undefined! Did you forget to add it to the serializer?`;return this.customTypes[t].BYTES_PER_ELEMENT}}},L=n(47),q=n.n(L);class z{constructor(t){t&&(this.server=t,this.gameName=Object.getPrototypeOf(t.gameEngine).constructor.name);let e=new w.a;this.on=e.on,this.once=e.once,this.removeListener=e.removeListener,this.emit=e.emit}registerClient(t){this.queryIdCounter=0,this.RTTQueries={},this.movingRTTAverage=0,this.movingRTTAverageFrame=[],this.movingFPSAverageSize=t.options.healthCheckRTTSample,this.clientEngine=t,t.socket.on(\"RTTResponse\",this.onReceivedRTTQuery.bind(this)),setInterval(this.sendRTTQuery.bind(this),t.options.healthCheckInterval)}sendRTTQuery(){this.RTTQueries[this.queryIdCounter]=(new Date).getTime(),this.clientEngine.socket.emit(\"RTTQuery\",this.queryIdCounter),this.queryIdCounter++}onReceivedRTTQuery(t){let e=(new Date).getTime()-this.RTTQueries[t];this.movingRTTAverageFrame.push(e),this.movingRTTAverageFrame.length>this.movingFPSAverageSize&&this.movingRTTAverageFrame.shift(),this.movingRTTAverage=this.movingRTTAverageFrame.reduce((t,e)=>t+e)/this.movingRTTAverageFrame.length,this.emit(\"RTTUpdate\",{RTT:e,RTTAverage:this.movingRTTAverage})}registerPlayerOnServer(t){t.on(\"RTTQuery\",this.respondToRTTQuery.bind(this,t)),this.server&&this.server.options.countConnections&&q.a.get(`http://ping.games-eu.lance.gg:2000/${this.gameName}`).on(\"error\",()=>{})}respondToRTTQuery(t,e){t.emit(\"RTTResponse\",e)}}class U{constructor(t,e,n){n=Object.assign({},n),this.seriazlier=t,this.options=n,this.eventName=e,this.netScheme=n.netScheme}create(t){let e=new s;if(e.classId=i.hashStr(this.eventName),this.netScheme){e.netScheme=Object.assign({},this.netScheme);for(let n of Object.keys(this.netScheme))e[n]=t[n]}return e}}class D extends s{static get netScheme(){return{events:{type:o.TYPES.LIST,itemType:o.TYPES.CLASSINSTANCE}}}constructor(t){super(),this.events=t||[]}}class W{constructor(t){this.serializer=t,this.registeredEvents=[],this.serializer.registerClass(D),this.registerNetworkedEventFactory(\"objectUpdate\",{netScheme:{stepCount:{type:o.TYPES.INT32},objectInstance:{type:o.TYPES.CLASSINSTANCE}}}),this.registerNetworkedEventFactory(\"objectCreate\",{netScheme:{stepCount:{type:o.TYPES.INT32},objectInstance:{type:o.TYPES.CLASSINSTANCE}}}),this.registerNetworkedEventFactory(\"objectDestroy\",{netScheme:{stepCount:{type:o.TYPES.INT32},objectInstance:{type:o.TYPES.CLASSINSTANCE}}}),this.registerNetworkedEventFactory(\"syncHeader\",{netScheme:{stepCount:{type:o.TYPES.INT32},fullUpdate:{type:o.TYPES.UINT8}}}),this.networkedEventCollection=new D}registerNetworkedEventFactory(t,e){e=Object.assign({},e);let n=i.hashStr(t),r=function(){};r.prototype.classId=n,r.prototype.eventName=t,r.netScheme=e.netScheme,this.serializer.registerClass(r,n),this.registeredEvents[t]=new U(this.serializer,t,e)}addNetworkedEvent(t,e){if(!this.registeredEvents[t])return console.error(`NetworkTransmitter: no such event ${t}`),null;let n=this.registeredEvents[t].create(e);return this.networkedEventCollection.events.push(n),n}serializePayload(){if(0===this.networkedEventCollection.events.length)return null;return this.networkedEventCollection.serialize(this.serializer)}deserializePayload(t){return this.serializer.deserialize(t.dataBuffer).obj}clearPayload(){this.networkedEventCollection.events=[]}}const V=60,Y=12,H=8;var X=class{constructor(t,e,n){if(this.options=Object.assign({autoConnect:!0,healthCheckInterval:1e3,healthCheckRTTSample:10,stepPeriod:1e3/V,scheduler:\"render-schedule\",serverURL:null},e),this.serializer=new O,this.gameEngine=t,this.gameEngine.registerClasses(this.serializer),this.networkTransmitter=new W(this.serializer),this.networkMonitor=new z,this.inboundMessages=[],this.outboundMessages=[],this.renderer=this.gameEngine.renderer=new n(t,this),this.scheduler=null,this.lastStepTime=0,this.correction=0,!0!==this.options.standaloneMode&&this.configureSynchronization(),e&&e.delayInputCount){this.delayedInputs=[];for(let t=0;t<e.delayInputCount;t++)this.delayedInputs[t]=[]}this.gameEngine.emit(\"client__init\")}configureSynchronization(){let t=this.options.syncOptions;\"reflect\"===t.sync&&(t.sync=\"interpolate\",t.reflect=!0),this.synchronizer=new P(this,t)}connect(t={}){let e=Promise.resolve({serverURL:this.options.serverURL,status:\"ok\"});return this.options.matchmaker&&(e=i.httpGetPromise(this.options.matchmaker)),e.then(e=>new Promise((n,i)=>{\"ok\"!==e.status&&i(\"matchMaker failed status: \"+e.status),this.options.verbose&&console.log(`connecting to game server ${e.serverURL}`),this.socket=g()(e.serverURL,t),this.networkMonitor.registerClient(this),this.socket.once(\"connect\",()=>{this.options.verbose&&console.log(\"connection made\"),n()}),this.socket.once(\"error\",t=>{i(t)}),this.socket.on(\"playerJoined\",t=>{this.gameEngine.playerId=t.playerId,this.messageIndex=1e4*Number(this.gameEngine.playerId)}),this.socket.on(\"worldUpdate\",t=>{this.inboundMessages.push(t)}),this.socket.on(\"roomUpdate\",t=>{this.gameEngine.emit(\"client__roomUpdate\",t)})}))}start(){this.stopped=!1,this.resolved=!1,this.renderer||alert(\"ERROR: game has not defined a renderer\");let t=e=>{this.stopped?this.renderer.stop():(this.lastTimestamp=this.lastTimestamp||e,this.renderer.draw(e,e-this.lastTimestamp),this.lastTimestamp=e,window.requestAnimationFrame(t))};return this.renderer.init().then(()=>{if(this.gameEngine.start(),\"fixed\"===this.options.scheduler&&(this.scheduler=new S({period:this.options.stepPeriod,tick:this.step.bind(this),delay:Y}),this.scheduler.start()),\"undefined\"!=typeof window&&window.requestAnimationFrame(t),this.options.autoConnect&&!0!==this.options.standaloneMode)return this.connect().catch(t=>{throw this.stopped=!0,t})}).then(()=>new Promise((t,e)=>{this.resolveGame=t,this.socket&&this.socket.on(\"disconnect\",()=>{this.resolved||this.stopped||(this.options.verbose&&console.log(\"disconnected by server...\"),this.stopped=!0,e())})}))}disconnect(){this.stopped||(this.socket.disconnect(),this.stopped=!0)}checkDrift(t){if(!this.gameEngine.highestServerStep)return;let e=this.synchronizer.syncStrategy.STEP_DRIFT_THRESHOLDS,n=e[t].MAX_LEAD,i=e[t].MAX_LAG,r=this.gameEngine.world.stepCount,o=this.gameEngine.highestServerStep;r>o+n?(this.gameEngine.trace.warn(()=>`step drift ${t}. [${r} > ${o} + ${n}] Client is ahead of server.  Delaying next step.`),this.scheduler&&this.scheduler.delayTick(),this.lastStepTime+=Y,this.correction+=Y):o>r+i&&(this.gameEngine.trace.warn(()=>`step drift ${t}. [${o} > ${r} + ${i}] Client is behind server.  Hurrying next step.`),this.scheduler&&this.scheduler.hurryTick(),this.lastStepTime-=H,this.correction-=H)}step(t,e,n){if(!this.resolved){const t=this.gameEngine.getPlayerGameOverResult();t&&(this.resolved=!0,this.resolveGame(t))}if(n)this.gameEngine.step(!1,t,e,n);else if(this.gameEngine.trace.setStep(this.gameEngine.world.stepCount+1),!0!==this.skipOneStep){for(this.gameEngine.emit(\"client__preStep\");this.inboundMessages.length>0;)this.handleInboundMessage(this.inboundMessages.pop()),this.checkDrift(\"onServerSync\");this.checkDrift(\"onEveryStep\"),!0!==this.options.standaloneMode&&this.handleOutboundInput(),this.applyDelayedInputs(),this.gameEngine.step(!1,t,e),this.gameEngine.emit(\"client__postStep\",{dt:e}),!0!==this.options.standaloneMode&&this.gameEngine.trace.length&&this.socket&&this.socket.emit(\"trace\",JSON.stringify(this.gameEngine.trace.rotate()))}else this.skipOneStep=!1}doInputLocal(t){if(this.gameEngine.ignoreInputs)return;const e={input:t.data,playerId:this.gameEngine.playerId};this.gameEngine.emit(\"client__processInput\",e),this.gameEngine.emit(\"processInput\",e),this.gameEngine.processInput(t.data,this.gameEngine.playerId,!1)}applyDelayedInputs(){if(!this.delayedInputs)return;let t=this,e=this.delayedInputs.shift();e&&e.length&&e.forEach(t.doInputLocal.bind(t)),this.delayedInputs.push([])}sendInput(t,e){let n={command:\"move\",data:{messageIndex:this.messageIndex,step:this.gameEngine.world.stepCount,input:t,options:e}};this.gameEngine.trace.info(()=>`USER INPUT[${this.messageIndex}]: ${t} ${e?JSON.stringify(e):\"{}\"}`),this.delayedInputs?this.delayedInputs[this.delayedInputs.length-1].push(n):this.doInputLocal(n),!0!==this.options.standaloneMode&&this.outboundMessages.push(n),this.messageIndex++}handleInboundMessage(t){let e=this.networkTransmitter.deserializePayload(t).events,n=e.find(t=>\"syncHeader\"===t.eventName);(!this.gameEngine.highestServerStep||n.stepCount>this.gameEngine.highestServerStep)&&(this.gameEngine.highestServerStep=n.stepCount),this.gameEngine.emit(\"client__syncReceived\",{syncEvents:e,stepCount:n.stepCount,fullUpdate:n.fullUpdate}),this.gameEngine.trace.info(()=>`========== inbound world update ${n.stepCount} ==========`),n.stepCount>this.gameEngine.world.stepCount+this.synchronizer.syncStrategy.STEP_DRIFT_THRESHOLDS.clientReset&&(this.gameEngine.trace.info(()=>`========== world step count updated from ${this.gameEngine.world.stepCount} to  ${n.stepCount} ==========`),this.gameEngine.emit(\"client__stepReset\",{oldStep:this.gameEngine.world.stepCount,newStep:n.stepCount}),this.gameEngine.world.stepCount=n.stepCount)}handleOutboundInput(){for(var t=0;t<this.outboundMessages.length;t++)this.socket.emit(this.outboundMessages[t].command,this.outboundMessages[t].data);this.outboundMessages=[]}};let $=null;const G=100;var Q=class{static getInstance(){return $}constructor(t,e){this.gameEngine=t,this.clientEngine=e,this.gameEngine.on(\"client__stepReset\",()=>{this.doReset=!0}),t.on(\"objectAdded\",this.addObject.bind(this)),t.on(\"objectDestroyed\",this.removeObject.bind(this)),$=this}init(){return\"undefined\"!=typeof window&&document||console.log(\"renderer invoked on server side.\"),this.gameEngine.emit(\"client__rendererReady\"),Promise.resolve()}reportSlowFrameRate(){this.gameEngine.emit(\"client__slowFrameRate\")}draw(t,e){this.gameEngine.emit(\"client__draw\"),\"render-schedule\"===this.clientEngine.options.scheduler&&this.runClientStep(t)}runClientStep(t){let e=this.clientEngine.options.stepPeriod,n=0;for((this.doReset||t>this.clientEngine.lastStepTime+G)&&(this.doReset=!1,this.clientEngine.lastStepTime=t-e/2,this.clientEngine.correction=e/2);t>this.clientEngine.lastStepTime+e;)this.clientEngine.step(this.clientEngine.lastStepTime+e,e+this.clientEngine.correction),this.clientEngine.lastStepTime+=e,this.clientEngine.correction=0;if(t<this.clientEngine.lastStepTime)return(n=t-this.clientEngine.lastStepTime+this.clientEngine.correction)<0&&(n=0),this.clientEngine.correction=this.clientEngine.lastStepTime-t,void this.clientEngine.step(t,n,!0);n=t-this.clientEngine.lastStepTime+this.clientEngine.correction,this.clientEngine.lastStepTime+=e,this.clientEngine.correction=this.clientEngine.lastStepTime-t,this.clientEngine.step(t,n)}addObject(t){}removeObject(t){}stop(){}};console.log(Q);var Z=new class extends X{constructor(t,e,n){super(t,e,n),console.log(\"demonio porco\"),console.log(\"hi there\")}start(){super.start(),console.log(\"client has been started\")}}(new class extends f.a{constructor(t){super(t),this.physicalEngine=new v({gameEngine:this,dt:500,collisions:{type:\"brute\"}}),this.on(\"postStep\",this.configurationLogic.bind(this)),this.on(\"server__init\",this.serverInit.bind(this))}configurationLogic(){console.log(\"no?\")}serverInit(){console.log(\"server was initialized\")}registerClasses(t){t.registerClass(p)}}({traceLevel:4,delayInputCount:2}),{verbose:!0,scheduler:\"render-schedule\",syncOptions:{sync:\"extrapolate\"},autoConnect:!0},class extends Q{constructor(t,e){super(t,e),console.log(\"yo man, whats uup?\")}});console.log(\"hi\"),Z.start()}]);","extractedComments":[]}